const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/iwyz70ptbfcin3ga.js","assets/hgyrt6j47bbfyjrt.js","assets/lip667d8t42poxum.js","assets/root-nsehtib5.css","assets/bek4a02po1hapmml.js","assets/conversation-small-k5k9c71c.css","assets/g1k10sykivgpvvsx.js","assets/jlt66buw1zajk9of.js","assets/crcig06q8v34tlbt.js","assets/kweqtgafphozzl00.js","assets/lt5u077njj9ud9u7.js","assets/onc52ija8qy6u5wt.js","assets/gy64pge8qevmvg7e.js","assets/e7mjpuh29aogn86e.js","assets/dcjog7s9l4t4gioj.js","assets/iju6lgsvrm2mvqle.js","assets/jix9nwzk33czn3ea.js","assets/pe6688p8las5fhaz.js","assets/lap0mux5alyheeav.js"])))=>i.map(i=>d[i]);
import{j as e,r as l,M as U,g as st,ap as On,an as Hn,ak as As,a5 as H,d as Vn,a6 as ve,f as Ae,R as Gn,p as zn}from"./lip667d8t42poxum.js";import{e as tt,fp as Wn,l2 as We,er as $n,jo as Yn,jr as Kn,qj as Xn,v as nt,qk as Fs,ql as Qn,qm as Jn,qn as we,qo as Zn,az as at,qp as ea,hX as sa,hY as ta,a0 as fe,fA as ot,W as na,b_ as aa,kR as rt,qq as oa,qr as ra,dD as ia,qs as it,fT as la,fU as ca,fX as da,fV as ua,qt as ma,a$ as lt,X as ct,qu as dt,eH as ga,eu as K,aF as ha,qv as pa,an as fa,qw as xa,qx as va,og as ts,bG as ut,qy as ba,qz as ya,ne as _a,qA as Sa,qB as Ta,qC as ja,qD as Me,kK as Ca,qE as ka,qF as mt,bm as wa,d6 as Ma,qG as Ia,i2 as xe,bw as gt,U as ht,br as Ea,ax as pt,bs as Na,aw as ft,qH as Ra,qI as Aa,ei as Fa,hN as Pa,n2 as La,qJ as Da,bd as xt,be as vt,cQ as bt,d as Ua,qK as Ba,mz as qa,cV as Oa,y as yt,dW as Ha,qL as Va,pd as _t,e1 as Ga,hH as za,mR as Wa,O as $a,d8 as St,qM as Ya,hW as Ka,qN as Xa,cS as Qa,qO as Ja,iO as Za,aG as eo,qP as so,qQ as to,qR as no,n1 as ao,jB as oo,cU as ro,qS as io,qT as lo,qU as co,mS as uo,qV as mo,qW as go,nE as $e,qX as ho,nF as Ne,qY as Ye,qZ as po,q_ as fo,q$ as xo,cv as vo,jD as bo,n6 as yo,m_ as _o,r0 as So,r1 as To,r2 as jo,ik as Co,R as ko,pj as wo,r3 as Mo,r4 as Io,r5 as Eo,r6 as No,r7 as Ro,r8 as Ao,r9 as Fo,ra as Po,b$ as Lo,H as Do,pB as Uo,mg as Bo,mh as qo}from"./bek4a02po1hapmml.js";import{c as L,X as me,_ as he,F as ae,aX as Re,bL as F,dQ as ns,ag as P,aa as z,gN as Tt,ec as Oo,af as se,aY as de,cA as as,b9 as ge,fV as Ho,ce as jt,aI as Ke,b as Ct,d as kt,B as wt,y as Ps,at as Xe,aj as B,c0 as Q,ao as os,aJ as ne,fp as Mt,ae as ue,g8 as Vo,bQ as Go,dh as zo,di as Wo,aO as X,bX as $o,he as Yo,g as It,m as Et,dH as Ko,dO as Xo,d$ as Nt,cP as Qo,bC as Rt,hf as Jo,v as Zo,W as er,dj as rs,as as At,aL as Qe,d9 as sr,ey as tr,fg as nr,g7 as Oe,ci as ar,dg as or,cv as rr,bb as He,gT as ir,gU as lr,dX as cr,e6 as Ls,dY as dr,gH as ur,ah as mr,eH as gr,dR as hr}from"./hgyrt6j47bbfyjrt.js";import"./ltfattuf7qy8hfqt.js";import{M as pr,O as fr}from"./nfdnm3mrc4aegs7e.js";import{d as xr,b as vr}from"./j5maet6kh5o0bu61.js";import{a as br,G as yr}from"./iamkd7uovamzrioo.js";import{C as Je,F as _r}from"./e5qbxqli4yfx49qs.js";import{b as Ft}from"./jy5dxk25zw6hpymq.js";import{u as Pt}from"./j4mmgxghl8b1mh10.js";import{u as Sr}from"./bszrilswpsf8hziz.js";import{a as Lt}from"./gzhfufyiohn83kuo.js";const Tr="bg-token-main-surface-primary text-token-text-primary",jr="openai",Ds=["bg-blue-300 text-white"];function Cr(t){return Ds[(t?.charCodeAt(0)??0)%Ds.length]}const Ie=({children:t})=>e.jsx("div",{className:"pt-0",children:e.jsx("div",{className:L(l.isValidElement(t)&&t.type===We?"gizmo-bot-avatar":"gizmo-shadow-stroke","flex h-8 w-8 items-center justify-center overflow-hidden rounded-full"),children:t})});function Ze(t){const{messages:n,isUserTurn:a,avatarClassName:s,gizmo:o}=t,r="medium",d=n[0]?.metadata?.shared_conversation_id,i=d!=null,m=tt(),{gizmoEditorData:u,mode:p}=Wn();let v=e.jsx(Ie,{children:e.jsx(We,{className:s??Tr,iconName:jr,size:r})});return o?v=e.jsx(Ie,{children:e.jsx(br,{gizmoId:o.gizmo.id,className:"h-full w-full"})}):u!=null&&p==="test"&&(v=e.jsx(yr,{isFirstParty:!1,src:u.profilePictureUrl,className:"h-8 w-8 first:pt-[3px]"})),e.jsx("div",{className:void 0,children:a?i?e.jsx(Ie,{children:e.jsx(We,{className:Cr(d),iconName:"user",size:r})}):e.jsx(Ie,{children:e.jsx($n,{user:m,size:r})}):v})}const Us=me(()=>he(()=>import("./iwyz70ptbfcin3ga.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(t=>t.MemoryActionResult));function Bs(t,n,a){de(t,s=>{as.updateTree(s,o=>{o.updateNodeMetadata(n,{inlineComparisonRating:a})})})}const qs=({messages:t})=>{for(const{metadata:n}of t){const{paragen_display_label:a}=n??{};if(a)return a;const{augmented_paragen_prompt_label:s}=n??{};if(s)return s}};function kr(t){const n=l.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),a=l.useRef({left:null,right:null});return t.variantIds.length<2?e.jsx(Dt,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a,...t}):e.jsx(wr,{...t,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a})}function wr(t){const{clientThreadId:n,variantIds:a,turnIndex:s,firstVisibleTokenTimestampsRef:o}=t;if(a.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const r=is(),c=Tt(),d=Oo(),[i,m]=a,u=l.useMemo(()=>nt(i+m)()>=.5,[i,m]),[p,v]=u?[m,i]:[i,m],[y,g,T]=se(n,h=>{const I=Ps(h).tree.getLeafFromNode(p).id,k=Ps(h).tree.getLeafFromNode(v).id,f=P.getConversationTurns(h,I),E=P.getConversationTurns(h,k),R=s<f.length?f[s]:null,j=s<E.length?E[s]:null;return R||Xe.addError(`Paragen Left turn index ${s} out of bounds`,{turnIndex:s,turnCount:f.length,lastTurnRole:F(f)?.role,lastMessageAuthor:F(F(f)?.messages)?.author,lastMessageContentType:F(F(f)?.messages)?.content.content_type,lastMessageMetadata:F(F(f)?.messages)?.metadata,altTurnCount:E.length,altLastTurnRole:F(E)?.role,altLastMessageRole:F(F(E)?.messages)?.author.role}),j||Xe.addError(`Paragen Right turn index ${s} out of bounds`,{turnIndex:s,turnCount:E.length,lastTurnRole:F(E)?.role,lastMessageAuthor:F(F(E)?.messages)?.author,lastMessageContentType:F(F(E)?.messages)?.content.content_type,lastMessageMetadata:F(F(E)?.messages)?.metadata,altTurnCount:f.length,altLastTurnRole:F(f)?.role,altLastMessageRole:F(F(f)?.messages)?.author.role}),[I,R,j]}),[M,C]=u?[T,g]:[g,T],A=r?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";l.useEffect(()=>(Fs.setState({displayingSideBySideFeedback:!0}),()=>{Fs.setState({displayingSideBySideFeedback:!1})}),[]);const D=l.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),b=l.useCallback((h,{shouldSubmitParagenFeedback:I=!0}={})=>{if(!g||!T||!M||!C)throw new Error("Expected both turns to exist");de(n,N=>{as.setCurrentBranch(N,h)});const k=h===p,f=h===i;M.messages.length>0&&Bs(n,M.messages[M.messages.length-1].id,f?"original":"new"),C.messages.length>0&&Bs(n,C.messages[C.messages.length-1].id,f?"original":"new");const E=ge(n),R=[g,T].map((N,W)=>({messageId:N.messages[N.messages.length-1].id,loadFirstTokenTime:W===0?o.current.left:o.current.right,loadEndTime:F(N.messages)?.clientMetadata?.completionSampleFinishTime})),j=k?R[0].messageId:R[1].messageId,x=P.getParentPromptNode(Re(n),y);if(!x)throw new Error("Expected prompt for side by side feedback");const w={},S=x.message.clientMetadata?.variantsInStreamInfo==null&&x.message.metadata?.paragen_variants_info!=null;for(const N of R)w[N.messageId]=S?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:N.loadFirstTokenTime,load_end_time:N.loadEndTime};I&&Ws({params:{conversation_id:E,displayed_message_ids:R.map(N=>N.messageId),message_metadatas:w,rating:"selected",selected_message_id:j,source_timestamp:Date.now(),ui_variant:r?2:1,user_prompt_message_id:x.message.id}})},[n,p,i,M,C,g,T,y,o,t.conversationTurnMountTime,r]);return l.useEffect(()=>Ho(jt,{requestCompletion:h=>{const I=ge(n),k=P.getParentPromptNode(Re(n),y);if(!k)throw new Error("Expected prompt for side by side feedback");if(!g||!T)throw new Error("Expected both turns to exist");const f=[g,T].map((x,w)=>({messageId:x.messages[x.messages.length-1].id,loadFirstTokenTime:w===0?o.current.left:o.current.right,loadEndTime:F(x.messages)?.clientMetadata?.completionSampleFinishTime})),E={},R=k.message.clientMetadata?.variantsInStreamInfo==null&&k.message.metadata?.paragen_variants_info!=null;for(const x of f)E[x.messageId]=R?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:x.loadFirstTokenTime,load_end_time:x.loadEndTime};const j=h.isForSkippingParagen;Ws({params:{conversation_id:I,displayed_message_ids:f.map(x=>x.messageId),message_metadatas:E,rating:j?"explicit_skipped":"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:j?3:r?2:1,user_prompt_message_id:k.message.id}}),j&&b(p,{shouldSubmitParagenFeedback:!1})}}),[g,T,y,n,t.conversationTurnMountTime,A,M?.messages,C?.messages,d,r,o,b,p]),e.jsx(Dt,{...t,setPreferredFeedback:b,leftVariantId:p,rightVariantId:v,leftTurn:g,rightTurn:T,hasActiveRequest:c,originalTurn:M,visibilityStateRef:D})}function Dt({setPreferredFeedback:t,leftVariantId:n,rightVariantId:a,leftTurn:s,rightTurn:o,hasActiveRequest:r,originalTurn:c,visibilityStateRef:d,...i}){const m=(s&&qs(s))??null,u=(o&&qs(o))??null,p=l.useMemo(()=>s?.messages??[],[s?.messages]),v=l.useMemo(()=>o?.messages??[],[o?.messages]),{avatarClassName:y,firstVisibleTokenTimestampsRef:g}=i,T=l.useMemo(()=>s?.messageGroups??[],[s?.messageGroups]),M=l.useMemo(()=>o?.messageGroups??[],[o?.messageGroups]),C=Yn(),A=Re(i.clientThreadId),D=F(s?.messages),b=F(o?.messages),h=ns(P.getRequestId(A,D?.id??b?.id)),I=h&&!D?.end_turn,k=h&&!b?.end_turn,f=s?.role===z.User,E=o?.role===z.User,R=l.useRef(null),j=l.useRef(null),x=l.useRef(null),w=s!=null,S=o!=null;!w&&g.current.left==null&&(g.current.left=Date.now()),!S&&g.current.right==null&&(g.current.right=Date.now()),l.useEffect(()=>{if(R.current&&j.current&&x.current){const V=Array(11).fill(0).map((be,J)=>J/10),oe=new IntersectionObserver(be=>be.forEach(J=>{J.target===j.current?(d.current.left_visibility_initial==null&&(d.current.left_visibility_initial=J.intersectionRatio),d.current.left_visibility_max=Math.max(d.current.left_visibility_max??0,J.intersectionRatio)):J.target===x.current&&(d.current.right_visibility_initial==null&&(d.current.right_visibility_initial=J.intersectionRatio),d.current.right_visibility_max=Math.max(d.current.right_visibility_max??0,J.intersectionRatio))}),{root:R.current,threshold:V});return oe.observe(j.current),oe.observe(x.current),()=>oe.disconnect()}},[d]);const{data:N}=Kn(void 0,!1,C),W=is(),te=e.jsx("div",{className:"text-token-text-secondary px-(--thread-content-margin) pt-1 pb-5 text-center text-sm text-pretty",children:e.jsx(U,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})});return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:L("bg-token-main-surface-primary sticky top-[-1px] z-1 px-(--thread-content-margin) text-center text-lg text-pretty",W?"md:top-header-height":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(U,{id:"KKeSJV",defaultMessage:"You're giving feedback on a new version of ChatGPT."}),W?te:null]}),W?null:te,e.jsx("div",{className:L(Xn,"horzScrollShadows relative -mb-2 snap-x snap-mandatory overflow-x-auto overflow-y-clip pb-4"),ref:R,children:e.jsxs("div",{className:L("mx-auto box-content max-w-[calc(2*var(--thread-content-max-width))] min-w-min px-(--thread-content-margin)","flex items-start",W&&"divide-token-border-medium dark:divide-token-border-heavy divide-x",!W&&"gap-4 sm:gap-6"),children:[e.jsxs(Os,{horizontalScrollContainerRef:R,rootElementRef:j,onClick:()=>{t(n)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:w,children:[e.jsxs(Gs,{children:[e.jsx(Ze,{messages:p,isUserTurn:f,avatarClassName:y}),e.jsx(Vs,{children:e.jsx(U,{...$s.responseNumber,values:{responseIndex:1,display_label:m}})})]}),W&&w?e.jsx(Hs,{}):e.jsxs(e.Fragment,{children:[N!=null&&!f&&e.jsx(Us,{clientThreadId:i.clientThreadId,messages:p,isParagen:!0}),e.jsx(Je,{...i,allMessages:p,groupedMessagesToRender:T,allGroupedMessages:T,isUserTurn:f,isFinalUserTurn:!1,isCompletionRequestInProgress:I,hasActiveRequest:r,shouldGrowContainer:!1,isParagen:!0}),e.jsx(zs,{clientThreadId:i.clientThreadId,conversationTurnMountTime:i.conversationTurnMountTime,turn:s,originalTurn:c})]})]}),e.jsxs(Os,{horizontalScrollContainerRef:R,rootElementRef:x,onClick:()=>{t(a)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:S,children:[e.jsxs(Gs,{children:[e.jsx(Ze,{messages:v,isUserTurn:E,avatarClassName:y}),e.jsx(Vs,{children:e.jsx(U,{...$s.responseNumber,values:{responseIndex:2,display_label:u}})})]}),W&&S?e.jsx(Hs,{}):e.jsxs(e.Fragment,{children:[N!=null&&!E&&e.jsx(Us,{clientThreadId:i.clientThreadId,messages:v,isParagen:!0}),e.jsx(Je,{...i,allMessages:v,groupedMessagesToRender:M,allGroupedMessages:M,isFinalUserTurn:!1,isUserTurn:E,isCompletionRequestInProgress:k,hasActiveRequest:r,shouldGrowContainer:!1,isParagen:!0}),e.jsx(zs,{clientThreadId:i.clientThreadId,conversationTurnMountTime:i.conversationTurnMountTime,turn:o,originalTurn:c})]})]})]})})]})}function Os({horizontalScrollContainerRef:t,rootElementRef:n,onClick:a,children:s,hasActiveRequest:o,isWaitingOnFirstUserVisibleToken:r}){const c=is(),{scrollX:d}=On({layoutEffect:!1,container:t,target:n}),i=Qn(),m=Jn(),u=l.useRef(null),p=l.useRef(null),v=l.useRef(null),[y,g]=l.useState(!1),[T,M]=l.useState(!1),[C,A]=l.useState(!1),[D,b]=l.useState(0);l.useEffect(()=>{if(!c)return;const j=new IntersectionObserver(x=>{for(const w of x)w.target===u.current?g(w.isIntersecting):w.target===v.current?A(w.isIntersecting):w.target===p.current&&M(w.isIntersecting)},{root:i?.current});return u.current&&p.current&&v.current&&(j.observe(u.current),j.observe(p.current),j.observe(v.current)),()=>{j.disconnect()}},[D,c,i]);const h=!C&&(T||y),I=Hn(d,j=>h?-1*j:0),k=As(0);l.useEffect(()=>{if(!c)return;const j=new ResizeObserver(x=>{we(x.length===1,"entryList.length === 1");const w=x[0];we(w.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),k.set(w.contentBoxSize[0].inlineSize)});return n.current&&j.observe(n.current),()=>{j.disconnect()}},[c,k,n]);const f=As(0);l.useEffect(()=>{if(!c)return;const j=new ResizeObserver(x=>{we(x.length===1,"entryList.length === 1");const w=x[0];we(w.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),f.set(w.contentBoxSize[0].blockSize+16),b(w.contentBoxSize[0].blockSize)});return m.current&&j.observe(m.current),()=>{j.disconnect()}},[c,f,m]);const E=e.jsx(wt,{className:c?"px-5":"mt-4 self-start",onClick:a,"data-testid":"paragen-prefer-response-button",children:e.jsx(U,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),R=r;return e.jsx("div",{"data-paragen-root":!0,className:L("@container relative flex min-w-[min(450px,80cqw,80vw)] flex-1 snap-center flex-col gap-1 text-start",c?"min-h-60":"border-token-border-tertiary rounded-xl border shadow-lg shadow-black/3"),ref:n,children:e.jsxs("div",{className:L(Zn,"px-(--thread-content-margin) py-4"),children:[e.jsx("div",{className:L("absolute top-48 right-0! left-0! h-px","invisible"),ref:u}),e.jsx("div",{className:L("absolute top-48 right-0! bottom-0 left-0!","invisible"),ref:p}),e.jsx("div",{className:L("absolute right-0! bottom-0 left-0! h-px","invisible"),ref:v}),s,c?e.jsx("div",{className:"flex-1"}):null,c?e.jsx("div",{className:"mt-4 min-h-10",children:R?null:e.jsx(H.div,{style:{translateX:I,width:k,bottom:f},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:L({fixed:h,"z-20 flex w-full justify-center":!0}),children:E})}):o?null:E]})})}function Hs(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pt-3 pb-5",children:[e.jsx(ce,{className:"h-4 w-[75%]"}),e.jsx(ce,{className:"h-4 w-[50%]"}),e.jsx(ce,{className:"h-4 w-[80%]"}),e.jsx(ce,{className:"h-4 w-[55%]"}),e.jsx(ce,{className:"h-4 w-[66%]"}),e.jsx(ce,{className:"h-4 w-[64%]"}),e.jsx(ce,{className:"h-4 w-[48%]"})]})}function is(){const{layer:t}=Ke("3119715334");return t.get("should-enable-hojicha",!1)}const Vs=ae.div`text-sm text-token-text-secondary font-semibold`,Gs=ae.div`flex gap-4 items-center mb-1`,ce=ae.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function zs({clientThreadId:t,conversationTurnMountTime:n,turn:a,originalTurn:s}){const o=at();if(!o.showParagenMetadata||!o.showDebugConversationTurns&&!o.forceParagen||a==null)return null;let r=a===s?"ORIGINAL":"NEW";const c=a.messages[a.messages.length-1],d=c?.metadata?.__internal,i=c?.metadata?.paragen_display_label;if(d){const{model_id:p,model_definition_slug:v,model_definition_virtual_model_id:y,alternative_model_selection_rule:g,augmented_paragen_prompt_group_id:T,augmented_paragen_prompt_id:M,augmented_paragen_prompt:C}=d;p&&(r+=`
Model ID: ${p}`),v&&(r+=`
Model Slug: ${v}`),y&&(r+=`
Virtual Model ID: ${y}`),g&&(r+=`
Alternative Model Rule: ${g}`),T&&(r+=`
Prompt Group ID: ${T}`),M&&(r+=`
Prompt ID: ${M}`),C&&(r+=`
Prompt: ${C}`),i&&(r+=`
Display Label: ${i}`)}r+=`
Message ID: ${c.id}`;const m=P.getParentPromptNode(Re(t),a.messages[0].id);if(!m)throw new Error("Expected prompt for side by side feedback");const u=m.message.clientMetadata?.variantsInStreamInfo==null&&m.message.metadata?.paragen_variants_info!=null;return r+=`
User prompt message ID: ${m.message.id}`,r+=`
Is Persisted Paragen? ${u}`,r+=`
Completion Sample Finish Time: ${u?`${n} (persisted)`:F(a.messages)?.clientMetadata?.completionSampleFinishTime}`,e.jsx("div",{className:"text-sm whitespace-pre-wrap text-red-500",children:r})}async function Ws({params:t}){await Ct.safePost("/paragen_submission",{requestBody:t,authOption:kt.SendIfAvailable})}const $s=st({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}{display_label}"}});function Mr({handleShowRetrievalResults:t,clientThreadId:n,turnIndex:a,responseComplete:s=!1}){const[o,r]=se(n,u=>[P.getTurnContentReferences(u,a),P.getConversationTurnAtIndex(u,a).messages]),c=l.useMemo(()=>({turnIndex:a,clientThreadId:n,responseComplete:s}),[n,s,a]),d=l.useRef(!1);l.useEffect(()=>{d.current||(d.current=!0,B.logEvent("File Sources Footer Shown",c))},[c]);const i=l.useCallback(()=>{B.logEvent("File Sources Footer Clicked",c),t()},[t,c]),m=l.useMemo(()=>{const u=new Set,p=[];function v(g){!g||u.has(g)||(u.add(g),p.push(g))}if(o.forEach(g=>{g.type==="file"?v(g.cloud_doc_url??g.extra?.cloud_doc_url):g.type==="file_navlist"&&g.items.forEach(T=>{v(T.cloud_doc_url)})}),s){for(const g of r)if(ea(g)){const T=sa(g.content.result),M=g.metadata?.cloud_doc_urls??[],C=T.chunks;for(let A=0;A<C.length;A++){const D=C[A];if(!D.documentId)continue;if(A<M.length){v(M[A]);continue}const b=D.documentId.endsWith("--google")?D.documentId.split("--")[1]:void 0,h=D.metadata.cloud_doc_url??(b?`https://drive.google.com/file/d/${b}`:void 0);v(h?.toString())}break}}const y=[];for(let g=0;g<p.length;g++){const T=p[g],M=ta(T);if(M&&y.push(M.Icon),y.length>=3)break}return y},[r,o,s]);return e.jsxs(e.Fragment,{children:[e.jsx(H.div,{className:"absolute h-[60px]",initial:{opacity:0},animate:{opacity:1},children:e.jsxs("button",{className:L("not-prose group/footnote border-token-border-default bg-token-main-surface-primary hover:bg-token-main-surface-secondary mt-3 mb-2 flex w-fit items-center gap-1.5 rounded-xl border py-2","ps-3 pe-2.5"),onClick:i,children:[m.length>0&&e.jsx("div",{className:"flex flex-row-reverse gap-1",children:m.reverse().map((u,p)=>e.jsx(H.div,{className:L("border-token-main-surface-primary bg-token-main-surface-primary flex items-center overflow-hidden","group-hover/footnote:border-token-main-surface-secondary","relative"),initial:{opacity:0},animate:{opacity:1},children:e.jsx(u,{className:"icon-sm"})},p))}),e.jsx("div",{className:"text-token-text-secondary flex items-center gap-0.5 text-xs font-semibold",children:e.jsx(U,{id:"/48IOP",defaultMessage:"Sources"})})]})}),e.jsx("div",{className:"h-[60px]"})]})}function Ut({followups:t,analyticsMetadata:n,isV2Enabled:a=!1}){const[s,o]=l.useState(-1),r=l.useRef(!1),c=Pt();return l.useEffect(()=>{r.current||(r.current=!0,t.forEach((d,i)=>{B.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...Q(n),action:"show",position:(i+1).toString(),followup_text:fe(d)})}))},[t,n]),e.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex w-full flex-col",children:t.slice(0,4).map((d,i)=>e.jsxs(H.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:i*.03},exit:{opacity:0,translateY:4},onMouseEnter:()=>o(i),onMouseLeave:()=>o(-1),children:[i>0&&!a&&e.jsx(Bt,{$isSelected:s===i||s===i-1}),e.jsx(Ir,{followUp:d,onSelectingSuggestedReply:c,analyticsMetadata:n,position:i,isV2Enabled:a})]},i))})}const Bt=ae.div`
  h-[1px] opacity-45
  ${({$isSelected:t})=>t?"mx-2 bg-token-main-surface-secondary":"bg-token-border-default"}
`;function Ir({followUp:t,onSelectingSuggestedReply:n,analyticsMetadata:a,position:s,isV2Enabled:o}){return e.jsxs(H.button,{whileHover:"hover",className:L("bg-token-main-surface-primary hover:bg-token-main-surface-secondary flex w-full cursor-pointer items-start justify-start gap-2 rounded-lg py-3 text-start",o?"px-0":"px-2"),onClick:r=>{n(r,t,[],0),B.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...Q(a),action:"click",position:(s+1).toString(),followup_text:fe(t)})},onMouseEnter:()=>{B.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...Q(a),action:"hover",position:(s+1).toString(),followup_text:fe(t)})},children:[e.jsx(H.div,{className:"flex items-center justify-center pt-0.25 opacity-70",variants:{hover:{x:4}},initial:{x:0},transition:{duration:.1},children:e.jsx(ot,{className:"text-token-text-secondary h-[20px] w-[20px]"})}),e.jsx("div",{className:"text-token-text-secondary pe-2 text-start text-sm",children:fe(t)})]})}const Er=()=>e.jsx(Ft,{size:"lg",lines:3,width:35,widthVariance:10,className:"w-full"}),Nr=t=>({[ne.Search]:"Web Search",[ne.Research]:"Research",[ne.PictureV2]:"Draw Image",[ne.Think]:"Think Harder"})[t]??"Title",es=(t,n,a,s,o)=>{B.logEventWithStatsig("Capabilities Suggestion Action","chatgpt_capabilities_suggestion_action",{...Q(a),categoryId:n.categoryId,suggestionId:n.id,position:s,action:t,numSuggestions:String(o)})},Rr=(t,n)=>{const a=l.useRef(!1);l.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{es("show",s,n,o+1,t.length)}))},[t,n])},qt=({clientThreadId:t,suggestions:n,analyticsMetadata:a,style:s="default"})=>{const o=Pt();return Rr(n,a),e.jsx(e.Fragment,{children:n.map((r,c)=>e.jsxs(H.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:4},transition:{delay:c*.03},className:L("w-full flex-1",s==="compact"&&"flex-col"),children:[s==="compact"&&c>0&&e.jsx(Bt,{$isSelected:!1}),e.jsx(Ar,{clientThreadId:t,suggestion:r,onSelectingSuggestedReply:o,position:c+1,numSuggestions:n.length,analyticsMetadata:a,style:s})]},r.prompt))})},Ar=({clientThreadId:t,suggestion:n,onSelectingSuggestedReply:a,analyticsMetadata:s,position:o,numSuggestions:r,style:c="default"})=>{const{setThreadSystemHintMode:d}=na(),i=os(),m=Vn();return e.jsx(H.button,{onClick:u=>{if(es("click",n,s,o,r),n.categoryId===ne.Research)if(i?.isFree()){aa(m,"Suggested Capabilities Upsell");return}else d(n.categoryId,!0,s);a(u,n,[],0)},onMouseEnter:()=>{es("hover",n,s,o,r)},className:L("hover:bg-token-main-surface-secondary flex w-full flex-1 items-start rounded-xl text-start transition-colors duration-300 ease-in-out",c==="default"&&"gap-4 p-2"),children:c==="compact"?e.jsx(Fr,{clientThreadId:t,suggestion:n}):e.jsx(Pr,{clientThreadId:t,suggestion:n})})},Fr=({suggestion:t,clientThreadId:n})=>{const{categoryId:a}=t,{systemHints:s}=rt(n),o=s.find(r=>r.systemHint===a);return e.jsxs("div",{className:"bg-primary hover:bg-tertiary group flex w-full cursor-pointer items-center justify-start gap-2 rounded-lg px-2 py-3 text-start transition-colors duration-300 ease-in-out",children:[e.jsx("div",{className:"flex items-center justify-center opacity-70 transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:rotate-[-5deg] group-hover:opacity-100",children:a==="ask"?e.jsx(ot,{className:"text-token-text-secondary group-hover:text-token-text-primary h-[18px] w-[18px]"}):e.jsx(Mt,{svgString:o?.logo??"",className:"text-token-text-secondary icon-md group-hover:text-token-interactive-label-accent-default h-[18px] w-[18px]"})}),e.jsx("div",{className:"text-token-text-secondary group-hover:text-token-text-primary flex items-center pe-2 text-start text-sm",children:fe(t)})]})},Pr=({clientThreadId:t,suggestion:n})=>{const{categoryId:a,imageUrl:s,description:o,title:r,ctaLabel:c,prompt:d}=n,{systemHints:i}=rt(t),m=i.find(u=>u.systemHint===a);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-token-border-default bg-primary relative h-16 w-14 flex-shrink-0 rounded-lg border drop-shadow-xs transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:rotate-[-2deg]",children:[a===ne.PictureV2?e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-lg bg-cover",style:{backgroundImage:`url(${s})`},children:e.jsx(oa,{className:"icon-xl mb-2 text-white"})}):e.jsxs("div",{className:"flex flex-col gap-1.5 p-2",children:[e.jsx("div",{className:"text-token-text-primary text-[5px] leading-tight font-semibold tracking-tighter",children:r??Nr(a)}),e.jsx("div",{className:"flex flex-col gap-0.5",children:Array.from({length:10}).map((u,p)=>e.jsx("div",{className:"bg-token-border-heavy h-[1px] w-full rounded-full"},p))})]}),e.jsx("div",{className:"absolute -end-2 -bottom-2",children:e.jsx(ra,{isBadge:!0,className:"opacity-100",logo:e.jsx(Mt,{svgString:m?.logo??"",className:"icon-md"})})})]}),e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsx("div",{className:"text-token-text-primary flex-grow",children:o??d}),c&&e.jsxs("div",{className:"text-token-text-secondary flex items-center font-medium",children:[c,e.jsx(H.div,{variants:{hover:{x:2}},initial:{x:0},transition:{duration:.1},children:e.jsx(ia,{})})]})]})]})},ss=(t,n,a,s)=>{B.logEventWithStatsig("Capabilities Tab Action","chatgpt_capabilities_tab_action",{...Q(a),tabId:n,position:s,action:t})},Lr=(t,n)=>{const a=l.useRef(!1);l.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{ss("show",s.value,n,o+1)}))},[t,n])},Dr=({clientThreadId:t,categorySuggestions:n,lastMessageId:a,analyticsMetadata:s,style:o="default"})=>{const r=n.map(({category_id:i,title:m,suggestions:u})=>({value:i,message:m,suggestions:u?.map(it)??[]})),[c,d]=l.useState(r[0].value);return Lr(r,s),e.jsxs(la,{value:c,onValueChange:d,orientation:"horizontal",className:"flex w-full flex-col",children:[e.jsx(ca,{className:"border-token-border-default relative flex w-full flex-row gap-6 border-b",children:r.map((i,m)=>e.jsx(Br,{value:i.value,message:i.message,isActive:c===i.value,analyticsMetadata:s,position:m+1},i.value))}),r.map(i=>e.jsx(da,{value:i.value,children:e.jsx(Ur,{initialSuggestions:i.suggestions,clientThreadId:t,categoryId:i.value,isActive:c===i.value,lastMessageId:a,analyticsMetadata:s,style:o})},i.value))]})},Ur=({initialSuggestions:t,clientThreadId:n,categoryId:a,isActive:s,lastMessageId:o,analyticsMetadata:r,style:c="default"})=>{const d=ge(n),i=s&&t.length===0,{suggestions:m,isLoading:u}=ma({categoryId:a,shouldFetch:i,serverThreadId:d,lastMessageId:o}),p=i?m:t;return a==="ask"?u?e.jsx(Er,{}):e.jsx(Ut,{followups:p.map(v=>({type:lt.Reply,text:v.prompt})),analyticsMetadata:r}):e.jsx("div",{className:"flex w-full flex-col gap-y-4 py-3 md:flex-row md:gap-x-4",children:u?e.jsxs(e.Fragment,{children:[e.jsx(Ys,{}),e.jsx(Ys,{})]}):e.jsx(qt,{clientThreadId:n,suggestions:p,analyticsMetadata:r,style:c})})},Br=({value:t,message:n,isActive:a,analyticsMetadata:s,position:o})=>e.jsxs(ua,{className:"text-token-text-tertiary hover:text-token-text-secondary radix-state-active:text-token-text-primary relative flex min-w-10 justify-center py-4 text-sm font-medium",value:t,onClick:()=>{ss("click",t,s,o)},onMouseEnter:()=>{ss("hover",t,s,o)},children:[e.jsx("div",{className:"truncate",children:n}),e.jsx(ve,{children:a&&e.jsx(H.div,{layoutId:"tab-underline",className:"bg-token-text-primary absolute start-0 end-0 bottom-0 h-0.5",transition:{type:"spring",stiffness:500,damping:30}})})]}),Ys=()=>e.jsxs("div",{className:"flex flex-1 items-center gap-4 rounded-xl p-2",children:[e.jsx("div",{className:"bg-token-sidebar-surface-secondary dark:bg-token-border-default h-16 w-14 flex-shrink-0 rounded-lg"}),e.jsx("div",{className:"w-full flex-grow",children:e.jsx(Ft,{lines:3,size:"sm"})})]}),qr=({clientThreadId:t,categorySuggestions:n,lastMessageId:a,analyticsMetadata:s})=>{if(!n||n.length===0)return null;const o=n.length===1,r=n[0],c=r.suggestions.length>0?r.suggestions:void 0;return o&&c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-1 text-sm font-semibold",children:e.jsx(U,{id:"3UFIQc",defaultMessage:"Follow up"})}),e.jsx(qt,{clientThreadId:t,suggestions:c.map(it),analyticsMetadata:s,style:r.style})]}):e.jsx(Dr,{clientThreadId:t,categorySuggestions:n??[],lastMessageId:a,analyticsMetadata:s})};function Or({clientThreadId:t,followups:n,categorySuggestions:a,lastMessageId:s,analyticsMetadata:o}){const[r,c]=l.useState(null),d=ct.useIsEnabled(t),{capabilitySuggestionsEnabled:i}=dt(),m=a&&a.length>0;return e.jsxs(e.Fragment,{children:[e.jsx(Gr,{visible:r==="conversation"}),e.jsx(zr,{visible:r==="global"}),d&&(i?m&&e.jsx(qr,{clientThreadId:t,lastMessageId:s,categorySuggestions:a,analyticsMetadata:o}):n.length>0&&e.jsx(Hr,{clientThreadId:t,followups:n,analyticsMetadata:o,setDisableMessage:c}))]})}function Hr({clientThreadId:t,followups:n,setDisableMessage:a,analyticsMetadata:s}){const{value:o}=ue("2281969373"),{value:r}=ue("2076592918");return e.jsxs("div",{className:"group",children:[r?e.jsx("hr",{className:"bg-token-bg-tertiary mt-5 mb-5 opacity-70"}):e.jsxs("div",{className:"mb-1 flex items-center text-sm font-semibold",children:[e.jsx(U,{id:"3UFIQc",defaultMessage:"Follow up"}),!o&&e.jsx(Vr,{clientThreadId:t,setDisableMessage:a,analyticsMetadata:s})]}),e.jsx(Ut,{followups:n,analyticsMetadata:s,isV2Enabled:r})]})}function Vr({clientThreadId:t,setDisableMessage:n,analyticsMetadata:a}){const s=ct.useStore(),[o,r]=l.useState(!1);return e.jsxs(ga,{size:"small",onOpenChange:c=>r(c),contentClassName:"min-w-[200px]",triggerButton:e.jsx("button",{className:"text-token-text-tertiary hover:bg-token-main-surface-tertiary ms-2 flex h-6 w-6 items-center justify-center rounded-md focus:ring-0 focus:outline-hidden",children:e.jsx(ha,{className:L("h-4 w-4 opacity-0 group-hover:opacity-100",o&&"opacity-100")})}),children:[e.jsx(K.Item,{onClick:()=>{s.setDisabledConversation(t,!0),n("conversation"),setTimeout(()=>n(null),3e3),B.logEventWithStatsig("chatgpt_message_followup_setting","chatgpt_message_followup_setting",{...Q(a),action:"disable_conversation"})},className:"text-token-text-primary",children:e.jsx(U,{id:"GZYofd",defaultMessage:"Hide for this chat"})}),e.jsx(K.Item,{onClick:()=>{s.setDisabledGlobally(!0),n("global"),setTimeout(()=>n(null),5e3),B.logEventWithStatsig("chatgpt_message_followup_setting","chatgpt_message_followup_setting",{...Q(a),action:"disable_globally"})},className:"text-token-text-primary",children:e.jsx(U,{id:"dtAOq4",defaultMessage:"Hide everywhere"})})]})}const Ot={initial:{opacity:1},animate:{opacity:1},exit:{opacity:0,transition:{duration:.2}}};function Gr({visible:t}){return e.jsx(ve,{children:t&&e.jsx(H.div,{...Ot,className:"text-token-text-tertiary flex justify-center py-6 text-sm",children:e.jsx(U,{id:"ckTD9g",defaultMessage:"Follow ups are turned off for this conversation"})})})}function zr({visible:t}){return e.jsx(ve,{children:t&&e.jsxs(H.div,{id:"disableForAllConvos",...Ot,className:"flex flex-col items-center py-3 text-sm",children:[e.jsx("div",{children:e.jsx(U,{id:"5GDIBQ",defaultMessage:"Follow up have been turned off"})}),e.jsx("div",{className:"text-token-text-tertiary pt-1",children:e.jsx(U,{id:"LYaBNe",defaultMessage:"You can re-enable them in settings"})})]})})}function Wr({modelSlug:t,animateModelLabelOnRender:n,isDropdownOpen:a,isRegenerateEnabled:s,isHovered:o,animateShortLabel:r}){const{data:c}=Go(),[d,i]=l.useState("initial");l.useEffect(()=>{if(n){const v=setTimeout(()=>i("show"),500),y=setTimeout(()=>i("initial"),2e3);return()=>{clearTimeout(v),clearTimeout(y)}}i("initial")},[n]);const{shorterLabel:m}=c?.categories.find(({defaultModel:v})=>v===t)??{},u={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},p=a?"visible":o?"show":d;return e.jsxs(H.div,{initial:"initial",animate:p,className:"flex items-center pb-0",children:[e.jsx(ts,{className:"icon-md"}),(s||r)&&e.jsx(H.span,{className:"overflow-hidden text-sm text-clip whitespace-nowrap",variants:u,transition:{type:"tween",duration:.18},children:m}),s&&e.jsx(ut,{className:"icon-sm"})]})}function Ve(t,n){const{modelSwitcherDeny:a,subscriptionLevel:s}=t;return!!a&&a.reason===$o.RATE_LIMIT&&s===Yo.PLUS&&!n}const Ee="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function $r({className:t,clientThreadId:n,message:a,onModelSelect:s,canRegenerateResponse:o,withModelSelectorLabel:r=!0}){const[c,d]=l.useState(null),[i,m]=l.useState(!1),[u,p]=l.useState(!1),v=a.metadata?.model_slug,y=a.id,g=l.useRef(null),T=k=>{k||setTimeout(()=>{g.current&&g.current.blur()},10)};l.useEffect(()=>{T(i)},[i]);const M=se(n,Ca),C=Vo({clientThreadId:n}),A=l.useRef(C);l.useEffect(()=>{A.current=C},[C]);const D=l.useCallback(k=>{A.current?de(n,f=>{f.conduitToken=null,f.prepareState=null}):de(n,f=>{f.conduitToken=k,f.prepareState="success"})},[n]);if(M)return null;const b=pa(n,a.id),h=a.metadata?.model_slug,I=va(b,h);return e.jsxs(K.Root,{onOpenChange:k=>{o&&(h&&ba(n,h,[],D),m(k),T(k))},children:[o?e.jsx(fa,{label:r?e.jsx(U,{id:"wDs5sz",defaultMessage:"Switch model "}):e.jsx(U,{id:"/a4cqQ",defaultMessage:"Switch model ({modelSlug})",values:{modelSlug:h}}),children:e.jsx(xa,{ref:g,className:L("cursor-pointer",t),onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),children:r?e.jsx(Wr,{modelSlug:h,animateModelLabelOnRender:I,isDropdownOpen:i,isRegenerateEnabled:o,isHovered:u}):e.jsxs("div",{className:"flex items-center",children:[e.jsx(ts,{className:"icon-md"}),e.jsx(ut,{className:"icon-sm"})]})})}):null,o&&e.jsx(K.Portal,{children:e.jsxs(K.Content,{className:"text-token-text-primary z-30 min-w-fit origin-top-right",side:"bottom",align:"start",children:[e.jsx(K.Label,{children:e.jsx(U,{id:"bFLh5u",defaultMessage:"Switch model"})}),e.jsx(Yr,{clientThreadId:n,messageId:y,message:a,onModelSelect:s,messageModelSlug:v,setHoveredOption:d,hoveredOption:c})]})})]})}function Yr({clientThreadId:t,message:n,messageId:a,messageModelSlug:s,onModelSelect:o,setHoveredOption:r,hoveredOption:c}){const d=Ae(),{data:i=null}=zo(),m=i&&Wo(i),{modelOptions:u,messageModelEnabledTools:p}=ya({clientThreadId:t,message:n}),v=p.includes(ne.Search),y=l.useMemo(()=>u.find(b=>b.value===s),[u,s]),[g,T]=l.useMemo(()=>_a(u,b=>b.subcategory),[u]),M=Sa(n);l.useEffect(()=>{const b=u.some(h=>Ve(h,m));B.logEvent("Conversation Open Message Model Selector",{has_get_plus_button:b,is_new_regen_dropdown:!0})},[]);const C=l.useMemo(()=>{const b=new Map;return g.forEach(h=>{const I=h.subcategory;I&&(b.has(I)||b.set(I,[]),b.get(I)?.push(h))}),b},[g]),A=L("icon-sm","order-10 ms-auto text-token-text-tertiary icon-md"),D=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:d.formatMessage(Ge.search),icon:e.jsx(Ta,{className:A}),condition:v&&!M,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:d.formatMessage(Ge.nosearch),icon:e.jsx(ja,{className:A}),condition:v&&M,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[T.map(b=>{const{value:h,...I}=b;return e.jsx(Me,{value:h,onSelect:k=>{X.logEvent("chatgpt_regenerate_switch_model_button_clicked",h,{requestedModelId:h,...Q({clientThreadId:t,messageId:a})}),o({sourceEvent:k,requestedModelId:h})},includeRegenerate:!1,onMouseEnter:()=>r(h),onMouseLeave:()=>r(null),isHovered:c===h,messageModelSlug:s,includeCheck:!1,shouldShowUpsell:Ve(b,m),className:Ee,...I,icon:e.jsx("span",{className:A}),clientThreadId:t},h)}),[...C.entries()].map(([b,h])=>e.jsxs(K.Sub,{children:[e.jsx(K.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:b})}),e.jsx(K.Portal,{children:e.jsx(K.SubContent,{className:"min-w-fit",children:h.map(I=>{const{value:k,...f}=I;return e.jsx(Me,{value:k,onSelect:E=>{X.logEvent("chatgpt_regenerate_switch_model_button_clicked",k,{requestedModelId:k,...Q({clientThreadId:t,messageId:a})}),o({sourceEvent:E,requestedModelId:k})},includeRegenerate:!1,onMouseEnter:()=>r(k),onMouseLeave:()=>r(null),isHovered:c===k,messageModelSlug:s,includeCheck:!1,className:Ee,...f,icon:null,shouldShowUpsell:Ve(I,m),clientThreadId:t},b+"-"+k)})})})]},b)),!!y&&e.jsxs(e.Fragment,{children:[e.jsx(K.Separator,{}),e.jsx(Me,{onSelect:b=>{X.logEvent("chatgpt_regenerate_try_again_button_clicked",y.value,{requestedModelId:y.value,...Q({clientThreadId:t,messageId:a})}),o({sourceEvent:b,requestedModelId:y.value})},includeRegenerate:!0,onMouseEnter:()=>r(y.value),onMouseLeave:()=>r(null),messageModelSlug:s,includeCheck:!1,className:Ee,...y,label:d.formatMessage(Ge.tryAgain),subtitle:y.label,icon:e.jsx(ts,{className:A}),clientThreadId:t},y.value),D.filter(b=>b.condition).map(b=>e.jsx(Me,{onSelect:h=>{X.logEvent(b.eventName,y.value,{requestedModelId:y.value,...Q({clientThreadId:t,messageId:a})}),o({sourceEvent:h,requestedModelId:y.value,extraStreamParams:b.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>r(b.key),onMouseLeave:()=>r(null),isHovered:c===b.key,messageModelSlug:s,includeCheck:!1,className:Ee,...y,label:b.label,subtitle:"",icon:b.icon,clientThreadId:t},b.key))]})]})}const Ge=st({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Kr=l.memo($r),Xr=null,Qr=me(()=>he(()=>import("./crcig06q8v34tlbt.js"),__vite__mapDeps([8,2,1,3,9,10,4,5,11,12])).then(t=>t.VoicePlayButton)),Jr=me(async()=>Promise.resolve(()=>null)),Zr=({alwaysShow:t,isUserTurn:n,children:a})=>{const s=l.useRef(null);return l.useEffect(()=>{const o=s.current;o&&(t?requestAnimationFrame(()=>{o&&(o.style.maskPosition=t?"0% 0%":"")}):o.style.maskPosition="")},[t]),e.jsx("div",{className:L("flex",!t&&"absolute start-0 end-0 flex",n?"justify-end":"justify-start"),children:e.jsx("div",{ref:s,className:L("touch:-me-2 touch:-ms-3.5 -ms-2.5 -me-1 flex items-center p-1 select-none",!n&&"-mt-1",t&&"duration-[1.5s]","focus-within:transition-none hover:transition-none",!(t||n)&&"duration-500 group-hover/turn-messages:delay-300",!n&&["pointer-events-none [mask-image:linear-gradient(to_right,black_33%,transparent_66%)] [mask-size:300%_100%] [mask-position:100%_0%] motion-safe:transition-[mask-position]","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:[mask-position:0_0]","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:[mask-position:0_0]","has-data-[state=open]:pointer-events-auto has-data-[state=open]:[mask-position:0_0]"],n&&["duration-300 group-hover/turn-messages:delay-300","pointer-events-none opacity-0 motion-safe:transition-opacity","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:opacity-100","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:opacity-100","has-data-[state=open]:pointer-events-auto has-data-[state=open]:opacity-100"]),children:a})})},ei=({activeVariantIndex:t,clientThreadId:n,conversationMode:a,lastMessage:s,messages:o,numVariants:r,onChangeIndex:c,onRate:d,showCanvasButton:i,showCopyButton:m,showPagination:u,showPlayButton:p,showRatingButtons:v,showRegenerateButton:y,isJam:g,turn:T,turnIndex:M})=>{const C=It(),A=Ae(),D=Et(),{value:b}=ue("4061070236"),h=s?.clientMetadata?.rating;s?.clientMetadata?.requestId;const I=Ko(o,V=>{const[oe]=V.author.name?.split(".")??[];return oe===Xo.T2UAY3K&&Nt.getImageAssetPointers(V).length>0}),k=o.filter(Qo).filter(V=>V.recipient==="all"),f=!!I,E=Rt(),R=wa(),j=Ma(),x=ge(n),w=f&&k.length===0&&Jo(I),S=!g&&x!=null,N=!E&&I&&R(),W=!E&&!I&&Ia(C);let te=null;return S&&(N||W?te=e.jsx(ni,{clientThreadId:n,imageGenMessageId:I?.id,messageSliceIds:o.map(V=>V.id)}):j&&Zo(C,"1547743984").get("show_share_button_inline",!1)&&(te=e.jsx(xe,{onClick:()=>{x&&ht.openSharingModal(x)},label:A.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:gt}))),e.jsxs(e.Fragment,{children:[u&&e.jsx(mt,{currentPage:t,onChangeIndex:c,length:r}),!1,m&&!w&&e.jsx(Ht,{onClick:V=>{Lt(C,n,M,D,V)}}),!f&&v&&e.jsxs(e.Fragment,{children:[h!=="thumbsDown"&&e.jsx(xe,{onClick:()=>d("thumbsUp"),disabled:h==="thumbsUp",icon:h==="thumbsUp"?Ea:pt,label:A.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"}),h!=="thumbsUp"&&e.jsx(xe,{onClick:()=>d("thumbsDown"),disabled:h==="thumbsDown",icon:h==="thumbsDown"?Na:ft,label:A.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"})]}),p&&s&&k.length>0&&e.jsx(Qr,{conversationId:n,message:s,iconClassName:"icon-md",className:"text-token-text-tertiary hover:text-token-text-primary gap-1.5 rounded-md p-1 text-xs"}),!f&&i&&e.jsx(Ra,{turn:T}),s&&Xr,y&&s&&e.jsx(ti,{clientThreadId:n,conversationMode:a,lastMessage:s,messages:o,hasImageGenMessage:f,withModelSelectorLabel:!b}),te]})},si=({activeVariantIndex:t,clientThreadId:n,numVariants:a,onAnticipateEdit:s,onChangeIndex:o,onEnterEdit:r,showCopyButton:c,showEditMessageButton:d,showPagination:i,turnIndex:m})=>{const u=It(),p=Et();return e.jsxs(e.Fragment,{children:[c&&e.jsx(Ht,{onClick:v=>{Lt(u,n,m,p,v)}}),d&&e.jsx(ka,{onAnticipateEdit:s,onEnterEdit:r}),i&&e.jsx(mt,{currentPage:t,onChangeIndex:o,length:a})]})},ti=({clientThreadId:t,conversationMode:n,messages:a,hasImageGenMessage:s,lastMessage:o,withModelSelectorLabel:r})=>{const c=La({clientThreadId:t,conversationMode:n}),d=Da(t,o),i=l.useCallback(({sourceEvent:m,requestedModelId:u,appendMessages:p,extraStreamParams:v})=>{o&&c({sourceEvent:m,nodeId:o.id,requestedModelId:u,appendMessages:p,extraStreamParams:v})},[o,c]);return s?e.jsx(Jr,{messages:a,onModelSelect:i}):e.jsx(Kr,{className:"text-token-text-secondary hover:bg-token-main-surface-secondary touch:px-2.5 h-[30px] rounded-md px-1.5",clientThreadId:t,message:o,onModelSelect:i,canRegenerateResponse:d,withModelSelectorLabel:r})},Ht=({onClick:t})=>{const[n,a]=l.useState(!1),s=Aa(),o=Ae(),r=l.useCallback(c=>{c.stopPropagation(),B.logEvent("ChatGPT Turn Action Copy Clicked"),t(c),a(!0),setTimeout(()=>{s()&&a(!1)},2e3),X.logEvent("chatgpt_turn_action_copy")},[s,t]);return e.jsx(xe,{icon:n?Fa:Pa,onClick:r,label:o.formatMessage({id:"CopyButton.copyTooltip",defaultMessage:"Copy"}),testId:"copy-turn-action-button"})};function ni({clientThreadId:t,imageGenMessageId:n,messageSliceIds:a}){const[s,o]=l.useState(!1),r=Ae(),c=Sr({clientThreadId:t,imageGenMessageId:n,messageSliceIds:a});return l.useEffect(()=>{B.logEventWithStatsig("Share Post: Share Button Shown","chatgpt_post_share_button_shown",{source:"turn_action"})},[]),e.jsx(xe,{onClick:async()=>{o(!0);try{await c()}finally{o(!1)}B.logEventWithStatsig("Share Post: Share Button Clicked","chatgpt_post_share_button_clicked",{source:"turn_action"})},label:r.formatMessage({id:"ConversationTurn.sharePostButtonTooltip",defaultMessage:"Share"}),icon:s?er:gt,disabled:s})}const Ks=[1,2,3,4,10,20,30],ai=1,oi=["g-67e595af0a408191b84ee532fca12cd1","g-67ec3b78892481918c89067962526695","g-67ec3b4988f8819184c5454e18f5e84b","g-67ec3ad40750819181ccffa6a6f050d5","g-67edaaa3d3a081918205d0c470f00a32","g-67edab030ac881918ce8fa5c75a8e1b3","g-67edab2fc0f48191881a20ac98fedf6f","g-67edab4a24fc8191b975acaa8da2dcef"];function ri({clientThreadId:t}){const n=xt(vt.isBusinessWorkspace),a=bt(),s=l.useRef(!1),o=rs(t),[r,c,d,i]=se(t,x=>[x?.mode,P.getRequestId(x),P.getConversationLastTurn(x),P.getConversationTurns(x).filter(w=>w.role===z.Assistant).length]),{isUnauthenticated:m}=At(),u=l.useMemo(()=>{if(!o)return-1;const x=nt(o);return x()>ai?-1:Ks[Math.floor(x()*Ks.length)]},[o]),p=ns(c),v=function(){return Math.random()<.5?"default":"personality_v1"},[y,g]=l.useState(null),[T,M]=l.useState(!1),[C,A]=l.useState(!1),[D,b]=l.useState(!1),[h,I]=l.useState(v),k=(x,w)=>{const S=d?.messages[0]?.id;g(x),I(w),E(S,x,w)},f=d?.role===z.Assistant,E=l.useMemo(()=>Ua((x,w,S)=>{o&&x&&(n&&a?Ba({rating:Oa(w),shown_at_assistant_turn:u,prompt:S},o,x):n||Ct.safePost("/conversation/{conversation_id}/rating",{parameters:{path:{conversation_id:o}},requestBody:{message_id:x,rating:w,shown_at_assistant_turn:u,prompt:S},authOption:kt.SendIfAvailable})),B.logEvent("Conversation Rating Submitted",{rating:w,showAtAssistantTurn:u,conversationId:o,prompt:S}),M(!0),setTimeout(()=>{A(!0)},1500)},2e3),[n,a,o,u]),R=i!==u||p||!f||!!n&&!a||r?.kind!==Qe.PrimaryAssistant&&r?.kind!==Qe.FlyingCircusCustomization&&r?.gizmo_id!==void 0&&!oi.includes(r?.gizmo_id)||D||m;l.useEffect(()=>{!R&&!s.current&&(B.logEvent("Conversation Rating Shown",{showAtAssistantTurn:u,conversationId:o}),s.current=!0)},[R]);const j=qa();return D||!j.forceShowConvoRating&&R?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(ve,{children:T&&!C&&e.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(Xs,{$padded:!0,children:e.jsx("span",{className:"text-token-text-tertiary text-sm",children:e.jsx(U,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!T&&e.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(Xs,{$padded:!1,children:[e.jsxs("div",{className:"text-token-text-secondary flex items-center justify-center gap-4 px-4 py-3 text-sm",children:[h==="personality_v1"?e.jsx(U,{id:"rating.instructions.personality_v1",defaultMessage:"Do you like this personality?"}):e.jsx(U,{id:"rating.instructions.default",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(ze,{$selected:y==="thumbsUp",onClick:()=>k("thumbsUp",h),children:e.jsx(pt,{className:"icon-md"})}),e.jsx(ze,{$selected:y==="thumbsDown",onClick:()=>k("thumbsDown",h),children:e.jsx(ft,{className:"icon-md"})})]})]}),e.jsx("div",{className:"bg-token-main-surface-tertiary w-px flex-1 self-stretch"}),e.jsx(ze,{className:"p-3",$selected:!1,onClick:()=>b(!0),children:e.jsx(sr,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const ze=ae.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,Xs=ae.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`,ii=me(()=>he(()=>import("./e7mjpuh29aogn86e.js"),__vite__mapDeps([13,2,1,3,4,5,14])));function li({clientThreadId:t,canShowInlineMessageFeedback:n,messageForRating:a,allGroupedMessages:s,currentModelId:o}){const r=os()?.isWorkspacePlan()??!1;let c=null;const d=se(t,v=>{const y=P.getConversationTurns(v);let g=0;for(let T=y.length-1;T>=0;T--){const M=y[T];if(M.messages.some(C=>C.metadata?.is_indepth_feedback))return!0;if(M.messages.some(C=>C.author.role===z.Assistant)&&g++,g>=3)break}return!1}),i=rs(t),m=yt(v=>v.voiceFeedbackThread),u=i===m,{voiceName:p}=Ha();return d?null:(u&&i&&!r?(tr.feedbackShown.success({voice:p}),c=e.jsx("div",{className:"text-center",children:e.jsx(Va,{serverThreadId:i})})):a.clientMetadata?.rating&&n?c=e.jsx(ii,{clientThreadId:t,conversationMessage:a,allGroupedMessages:s,currentModelId:o}):c=e.jsx("div",{className:"text-center",children:e.jsx(ri,{clientThreadId:t})}),e.jsx("div",{className:"mt-3 w-full empty:hidden",children:c}))}const ci=me(()=>he(()=>import("./iwyz70ptbfcin3ga.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(t=>t.MemoryActionResult)),di=me(()=>he(()=>import("./iju6lgsvrm2mvqle.js"),__vite__mapDeps([15,2,4,1,3,5,16,17])).then(t=>t.AutomationSourceHeader)),Qs=me(()=>he(()=>import("./lap0mux5alyheeav.js"),__vite__mapDeps([18,2,1,3,4,5])).then(t=>t.TextMessageEditor)),Js=80,ui=16,Zs={minHeight:`calc(100dvh - ${co}px - 120px)`};function mi(t){const{turnIndex:n,isFinalTurn:a,clientThreadId:s,onRequestCompletion:o,currentModelId:r,avatarClassName:c,showAvatar:d,scrollToMessageId:i,dateHeaderType:m}=t,{isNewScrollEnabled:u}=_t(),p=tt();os()?.normalizedAccountUserId;const v=!!p&&nr(p),y=Ga(),g=xt(vt.isBusinessWorkspace),T=xo(),{value:M}=ue("1760640904"),{value:C}=ue("4061070236"),A=!!d,b=null!=null,{value:h}=ue("1887864177"),{capabilitySuggestionsEnabled:I}=dt(),k=xr(),[f,E]=se(s,_=>{const O=P.getConversationTurnAtIndex(_,n),Y=n>0?P.getConversationTurnAtIndex(_,n-1):null,q=Y?.role===z.User&&Y.messages.some(G=>G.metadata?.visually_hide_response_from_conversation);return[O,q]}),{messages:R,messageGroups:j}=f,x=za(),w=R[0],S=F(R),{messages:N,visibleMessages:W,messageGroups:te,lastMessageToRender:V,doesTurnHaveDelayedMessages:oe}=l.useMemo(()=>{const _=x.size===0?-1:j.findIndex(G=>G.type===Oe?G.groups.some(ie=>ie.messages.some(Be=>x.has(Be?.id))):G.messages.some(ie=>x.has(ie?.id))),O=_!==-1&&_+1<j.length,Y=O?j.slice(0,_+1):j,q=O?Y.flatMap(G=>G.type===Oe?G.groups.flatMap(ie=>ie.messages):G.messages):R;return{messages:q,visibleMessages:q.filter(ar),messageGroups:Y,lastMessageToRender:F(q),doesTurnHaveDelayedMessages:_!==-1}},[R,j,x]),be=l.useMemo(()=>({clientThreadId:s,turnIndex:n,messageId:S?.id}),[s,n,S?.id]),J=!1,[ls,cs]=l.useState(!1),[Vt,Gt]=l.useState(!1),zt=l.useContext(Wa)!=null,$=f.role===z.User,ds=Rt(),ye=or(s),Fe=$a(f.gizmoId??ye).data,Pe=St(s),Wt=Ya(s),us=Ka(Pe),$t=Xa(Pe,Wt),ms=bt(),[_e,Yt,Kt,gs,Le,bi,Xt,Qt,Jt,hs,Zt,re,ps]=se(s,_=>{const O=P.getParentPromptNode(_,w.id),Y=O?.message.clientMetadata?.variantsInStreamInfo??(O?.message.metadata?.paragen_variant_choice?void 0:O?.message.metadata?.paragen_variants_info),q=P.getVariantIds(_,w.id),G=P.getCurrentVariantId(_,w.id),ie=P.getIsDoNotRemember(_),Be=G?q.indexOf(G):0,qn=Y&&_?.tree!=null&&q.some(le=>{const{errType:Rs}=_.tree.getLeafFromNode(le).message.clientMetadata??{};return Rs!=null&&Rs!=="info"}),qe=P.getConversationTurns(_);return[_?.async_status===He.STREAMING,P.isMessageTurnEnded(_,S?.id),qn,bo(_?.mode,Fe?.gizmo.id),_?.continuingFromSharedConversationId!=null,null,qe.findIndex(le=>le.role===z.User)===n,yo(qe,le=>le.role===z.User)===n,qe.findIndex(le=>le.role===z.Assistant)===n,P.getRequestId(_,S?.id),Y,q,Be,ie]});let en="default";const sn=N.some(_=>_.content.content_type===rr.MultimodalText),{layer:tn}=Ke("3119715334"),nn=tn.get("should-enable-skip",!1),{isUnauthenticated:fs}=At(),xs=f.messages.map(_=>_.id),Z=l.useRef(null),vs=!u&&(i?.length??0)>2&&i!=="finalAgentTurn"&&a&&T,Se=$?F(W):void 0,De=Se?.id,an=l.useCallback(()=>{De&&(B.logEvent("Edit Prompt",{id:De,threadId:ge(s)}),X.logEvent("chatgpt_edit_prompt"),cs(!0))},[De,s]),on=l.useCallback(()=>{cs(!1)},[]),bs=Qa()??!1,{onChangeRating:rn}=Ja({clientThreadId:s,currentModelConfig:Pe}),ln=_=>{if(!S)return;rn({nodeId:S.id,messageId:S.id,rating:_});const O=bs&&j.some(Y=>Y.type!==Oe&&Y.messages?.some(vo));B.logEventWithStatsig(_==="thumbsDown"?"Message Feedback Thumbs Down Clicked":"Message Feedback Thumbs Up Clicked","chatgpt_thumb_feedback",{id:S.id,threadId:ge(s),model:r,rating:_,...bs?{isCATriggered:O}:{}}),Gt(!0)},[cn]=l.useState(()=>Date.now()),dn=Za(s),{layer:un}=Ke("109457",{shouldLogExposure:!1}),ys=se(s,_=>dn&&P.getConversationTurns(_).filter(O=>O.role===z.Assistant).length<=un.get("onboarding_inject_cards_position",3)),mn=rs(s),_s=eo(s)?.value,gn=_s===He.STREAMING,hn=_s===He.REALTIME,Ss=hs!=null,pn=ns(hs),ee=!Yt&&pn||oe||hn,Ts=Tt(),[fn,js]=l.useState(Ss),Cs=l.useRef(!1),xn=so(s,S),[,vn]=zn();l.useEffect(()=>{const O=new URLSearchParams(window.location.search).get("message");!(O!=null&&xs.includes(O))||!Z.current||(Z.current.scrollIntoView({behavior:"instant"}),vn(q=>(q.delete("message"),q),{replace:!0,preventScrollReset:!0}))},[]),l.useEffect(()=>{if(u)return;const Y=new URLSearchParams(window.location.search).get("message")!=null;if(Cs.current||Y||i===void 0||!Z.current){i==="finalAgentTurn"&&a&&de(s,q=>{q.scrollToMessageId=void 0});return}(xs.includes(i)||i==="finalAgentTurn"&&a)&&(Cs.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(Z.current)if(i==="finalAgentTurn"&&a)Z.current.scrollIntoView({behavior:"instant",block:"end"}),de(s,q=>{q.scrollToMessageId=void 0});else{const q=Z.current.offsetHeight;let G;q>Js?G=Js-q:G=0,Z.current.style.scrollMarginTop=`${G+ui}px`,Z.current.scrollIntoView({behavior:"smooth"})}})}))},[i,Z.current]);const{showDebugConversationTurns:bn}=at(),yn=to(),_n=!y&&!Le&&!ds&&!$,Sn=V?.author.role===z.Assistant?V:null,Tn=V?.metadata?.system_hints?.includes(ne.Research);no({isCompletionRequestInProgress:ee,isUserTurn:$,message:Sn});const{isOpen:jn}=vr(),Cn=ao(),Te=oo(gs),je=!Te&&_n&&a&&Zt?.num_variants_in_stream===2&&re.length<=2&&!S?.clientMetadata?.inlineComparisonRating&&!Kt,kn=yt(_=>_.voiceFeedbackThread),pe=a&&(Ss||mn===kn),ks=_e||ee||gn,wn=!ls&&!y&&!Le&&!Te&&!jn&&!ys&&f.role!==z.Developer&&(C?!pe||!ks:(fn||pe)&&!ks),Mn=N.some(_=>ir(_)===lr.l1239dk1),In=pe&&!ee&&!Le&&!y&&!Mn&&(h||k||I),Ce=S!=null&&!0&&(!g||$t||v||ms)&&!Te&&!fs&&!ds&&!S.metadata?.b1de6e2_s,En=(!g||ms)&&Ce&&pe&&!_e&&!ee,ws=!y&&!((ee||_e)&&a)&&re.length>1&&!je&&!0&&!ys,Ms=$&&N.some(_=>ro(_)?.shouldHideContent),Nn=$&&Se!=null&&!Te&&!y&&!sn&&!Ms&&!fs&&!0&&!Tn,Rn=S!=null&&(S.clientMetadata?.disclaimers??[]).length===0,Is=l.useCallback(_=>{de(s,O=>{as.setCurrentBranch(O,re[_])}),B.logEvent("Change Active Node",{intent:"toggle_between"})},[s,re]),An=io(f,N,bn),{toggleThreadSidebar:Es}=cr(),ke=S?.id,Fn=l.useCallback(()=>{ke&&Es({type:"retrievalResults",clientThreadId:s,turnIndex:n,messageId:ke})},[ke,Es,s,n]),Pn=l.useMemo(()=>lo(f,us,!!ye),[us,ye,f]);if(!An&&!je)return vs?e.jsx("div",{style:Zs}):null;if(E)return null;const Ln=V?.metadata?.followup_prompts?V.metadata.followup_prompts.map(_=>({text:_,type:lt.Reply})):[],Dn=V?.metadata?.category_suggestions,Un=!N.some(_=>Nt.getAudioAssetPointers(_).length>0)&&!0&&!ye,Bn=!ee&&N.some(_=>_.author.role===z.Assistant&&_.metadata?.onboarding?.main_usages),Ue=N.find(_=>!!_.metadata?.onboarding?.examples)?.metadata?.onboarding?.examples,Ns=!Ms&&(!$||M)&&(!a||!ee);return yn&&!a&&W.length===0?null:e.jsxs(uo.Provider,{value:Jt,children:[e.jsx(mo,{dateHeaderType:m,turn:f}),e.jsxs("article",{className:L("text-token-text-primary w-full",!u&&i==="finalAgentTurn"&&T?"opacity-0":"",{hidden:zt&&Xt}),style:vs?Zs:void 0,ref:Z,dir:"auto","data-testid":`conversation-turn-${n}`,"data-scroll-anchor":!u&&a,children:[e.jsx(go,{role:f.role}),e.jsxs($e,{verticalPadding:en,horizontalPadding:je?"none":"standard",children:[je?e.jsxs(e.Fragment,{children:[e.jsx(kr,{isFeedbackEnabled:Ce,variantIds:re,conversationTurnMountTime:cn,...t}),nn&&e.jsx("div",{className:"mt-4 flex w-full justify-center",children:e.jsxs(wt,{color:"secondary",className:"text-token-text-primary","data-testid":"paragen-skip-button",onClick:()=>{jt.publish({kind:"requestCompletion",isForSkippingParagen:!0})},children:[e.jsx(ho,{className:"text-token-text-secondary me-1"}),e.jsx(U,{id:"IuTr+b",defaultMessage:"Skip"})]})})]}):e.jsx(Ne,{tabIndex:-1,className:"group/turn-messages focus-visible:outline-hidden",onFocus:()=>js(!0),onPointerEnter:()=>js(!0),children:e.jsxs(e.Fragment,{children:[J,!$&&!0&&A&&e.jsx(hi,{children:e.jsx(Ze,{messages:N,isUserTurn:$,avatarClassName:c,gizmo:Fe})}),e.jsx("div",{className:Ye({isUserTurn:$}),children:e.jsx("div",{className:"relative flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[null,!$&&!y&&e.jsx(ci,{messages:N,clientThreadId:s,gizmoId:Fe?.gizmo.id}),Cn&&!$&&e.jsx(di,{clientThreadId:s,messages:N}),ls&&Se?e.jsx(Qs,{message:Se,clientThreadId:s,onRequestCompletion:o,onExitEdit:on,disabled:Ts}):e.jsx(Je,{allMessages:R,groupedMessagesToRender:te,allGroupedMessages:j,...t,isUserTurn:$,isFinalUserTurn:Qt,isCompletionRequestInProgress:ee,isFeedbackEnabled:Ce,isFinalTurn:a,hasActiveRequest:Ts}),Pn&&e.jsx(Mr,{handleShowRetrievalResults:Fn,clientThreadId:s,turnIndex:n,responseComplete:!(ee||_e)}),Bn&&e.jsx(pr,{clientThreadId:s}),Ue&&Ue.length>0&&!ee&&e.jsx(fr,{clientThreadId:s,examples:Ue}),wn&&e.jsx(Zr,{isUserTurn:$,alwaysShow:pe||C,children:$?e.jsx(si,{activeVariantIndex:ps,clientThreadId:s,numVariants:re.length,onAnticipateEdit:Qs.prefetch,onChangeIndex:Is,onEnterEdit:an,showCopyButton:Ns,showEditMessageButton:Nn,showPagination:ws,turnIndex:n}):e.jsxs(e.Fragment,{children:[e.jsx(ei,{activeVariantIndex:ps,clientThreadId:s,conversationMode:gs,lastMessage:S,messages:N,numVariants:re.length,onChangeIndex:Is,onRate:ln,showCanvasButton:xn&&!0,showCopyButton:Ns,showPagination:ws,showPlayButton:Rn,showRatingButtons:Ce,showRegenerateButton:Un,isJam:b,turn:f,turnIndex:n}),C&&e.jsx(po,{clientThreadId:s,message:S,turnIndex:n})]})}),En&&e.jsx(li,{canShowInlineMessageFeedback:Vt,clientThreadId:s,messageForRating:S,allGroupedMessages:j,currentModelId:r}),In&&e.jsx(Or,{followups:Ln,categorySuggestions:Dn,clientThreadId:s,lastMessageId:ke,analyticsMetadata:be})]})})})]})}),e.jsx(fo,{clientThreadId:s,turn:f,isFinalTurn:a})]})]})]})}const gi=Gn.memo(mi),hi=ae.div`shrink-0 flex flex-col relative items-end`;function pi(t){const n=P.getConversationTurns(t),a=n.findIndex(o=>o.role===z.Assistant);if(a===-1)return;const s=n[a];for(let o=0;o<s.messageGroups.length;o++)if(s.messageGroups[o].type===Ls.SearchGPTQuery){const c=s.messageGroups.slice(o+1).find(({type:i})=>i===Ls.Text);if(c==null)return;const d=dr(c.messages[0]);if(d?.[0]?.type==="navigation")return{turnIndex:a,navigationCitation:d[0],message:c.messages[0]}}}function fi(t,n){if(n==null||t==null)return t;const a=new Set(t.domains.map(s=>s.url));return{...t,domains:[...t.domains,...n.domains.filter(s=>!a.has(s.url))],safe_urls:[...t.safe_urls??[],...n.safe_urls??[]]}}function xi({clientThreadId:t,prefetchNavlink:n,setPrefetchNavlink:a}){const s=l.use(n),{value:o}=ue("1032814809");l.useEffect(()=>{window.__oai_SSR_NAVLINK&&_o.logEvent("Search Tool Page Load Time To Fast Nav SSR",{server_timing:s?.timing},window.__oai_SSR_NAVLINK)},[]),l.useEffect(()=>{s==null&&a(void 0)},[s,a]);const r=l.useMemo(()=>s==null?null:{...s.navlink,domains:s.navlink.domains.map(i=>({...i,subtitle:i.subtitle??i.domain}))},[s]),c=se(t,pi),d=l.useMemo(()=>fi(r,c?.navigationCitation),[c,r]);return s==null||d==null?null:e.jsxs("div",{children:[e.jsx($e,{horizontalPadding:"standard",children:e.jsx(Ne,{children:e.jsx("div",{className:Ye({isUserTurn:!0}),children:e.jsx("div",{className:So(!0),children:e.jsx(To,{containsImagesOrAttachments:!1,isUserTurn:!0,children:e.jsx(jo,{text:s.query})})})})})}),e.jsx("div",{className:"-mb-10",children:e.jsx($e,{horizontalPadding:"standard",children:e.jsx(Ne,{children:e.jsxs("div",{className:Ye({isUserTurn:!1}),children:[e.jsx(_r,{clientThreadId:t,turnIndex:c?.turnIndex??2,nextMessage:c?.message,navigationCitation:d}),o?e.jsxs("div",{className:"text-token-text-secondary relative -top-2 flex justify-end gap-2 font-mono text-xs",children:[e.jsxs("div",{elementtiming:"navlink",children:["server: ",s.timing,"ms"]}),e.jsx(vi,{})]}):null]})})})}),e.jsx(Co,{scriptSrc:"requestAnimationFrame(()=>window.__oai_SSR_NAVLINK=window.__oai_SSR_NAVLINK||performance.now());"})]})}function vi(){const[t,n]=l.useState(null);return l.useEffect(()=>{const a=new PerformanceObserver(s=>{s.getEntries().forEach(o=>{if(o.identifier==="navlink"){const r=o.renderTime;n(c=>c??r)}})});return a.observe({type:"element",buffered:!0}),()=>a.disconnect()},[]),t==null?null:e.jsxs("span",{children:["render: ",t,"ms"]})}function Pi({onRequestCompletion:t,clientThreadId:n,scrollContainerRef:a,prefetchNavlink:s,setPrefetchNavlink:o}){const[r,c,d,i]=se(n,S=>[S?.mode,P.getConversationTurnIds(S),S?.conversationOrigin===ur.APPLE,S?.scrollToMessageId]),{isNewScrollEnabled:m}=_t(),u=ko(),p=wo(),v=Mo(),[y]=Io(),g=Eo(),[T]=No(),M=St(n),C=u.store.useContentAreaDimensions(Ro.Header,S=>S?.height?S.height:void 0),A=Ao(M.id),D=r?.kind===Qe.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":A;l.useEffect(()=>{p&&(X.logEvent("chatgpt_continue_conversation_page_loaded"),B.logEvent("Continue Conversation: Page Loaded"),X.logEvent("chatgpt_conversation_share_page_loaded"),B.logEvent("Share Public Chat: Shared Conversation Loaded"))},[p]);const b=l.useCallback(()=>{m||v({behavior:"smooth"})},[m,v]),h=l.useContext(mr),I=gr(h),[k,f]=l.useState(!1),E=(k||!1)&&!I,R=Fo(n),j=l.useRef(null),x=Po(n),w=Lo();return e.jsxs("div",{onCopy:R,className:L("@thread-xl/thread:pt-header-height mt-1.5 flex flex-col text-sm",w&&"keyboard-open:pb-[calc(var(--composer-height,100px)+var(--screen-keyboard-height,0))]",C?null:!m&&"pb-25"),style:{paddingBottom:C},children:[s?e.jsx(hr,{name:"prefetch-navlink",onError:S=>{Xe.addError("Error with prefetch navlink",{error:S}),o(void 0)},children:e.jsx(l.Suspense,{fallback:null,children:e.jsx(xi,{clientThreadId:n,prefetchNavlink:s,setPrefetchNavlink:o})})}):null,p&&e.jsxs(e.Fragment,{children:[e.jsx(Ne,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(U,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),e.jsx("div",{className:"text-token-text-primary text-center text-xs font-semibold",children:e.jsx("button",{onClick:()=>{ht.openModal(Do.ReportConversation),X.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),B.logEvent("Share Public Chat: Report Content Clicked",{location:"Dynamic Shared Thread Page"})},children:e.jsx(U,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})})]}),c.map((S,N)=>e.jsx(gi,{isFinalTurn:N===c.length-1,turnIndex:N,clientThreadId:n,onRequestCompletion:t,currentModelId:M.id,avatarClassName:D,scrollToBottom:m?void 0:b,scrollToMessageId:m?void 0:i,dateHeaderType:x(N),showAvatar:void 0},S)),!m&&e.jsxs(e.Fragment,{children:[a?.current&&e.jsx(Uo,{setIsScrolledToEdge:S=>{f(S)},options:{root:a.current,threshold:0,rootMargin:"0%"}},"threadBottomEdgeScrollObserver"),e.jsx("div",{ref:j}),d&&y&&!T&&e.jsx(et,{className:L("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{X.logEvent("chatgpt_thread_scroll_to_top"),g({behavior:"smooth"})},children:e.jsx(Bo,{className:"icon-md text-token-text-primary"})}),e.jsx(ve,{children:E&&e.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"},children:e.jsx(et,{className:L(C?null:"bottom-8"),style:{bottom:C},onClick:()=>{X.logEvent("chatgpt_thread_scroll_to_bottom"),j.current?.scrollIntoView({behavior:"smooth",block:"end"})},children:e.jsx(qo,{className:"icon-md text-token-text-primary"})})})})]})]})}const et=ae.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-default end-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`;export{Pi as T};
//# sourceMappingURL=d7tdwugs2quxc5yt.js.map
