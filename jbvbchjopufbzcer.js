const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/fpmhxpwspnbqkta7.js","assets/lip667d8t42poxum.js","assets/bek4a02po1hapmml.js","assets/hgyrt6j47bbfyjrt.js","assets/root-nsehtib5.css","assets/conversation-small-k5k9c71c.css","assets/iod03i092hedj52t.js","assets/by4q541t555nr8o0.js","assets/jkshdeunw22wsq7a.js","assets/bvff6uri7zkt0ua1.js","assets/mrja6mbtdpn27l02.js","assets/gfnsbm99dy8f9dle.js","assets/gkp5860wafdf24mv.js","assets/jwvxkjptpstk4ej7.js","assets/bszrilswpsf8hziz.js"])))=>i.map(i=>d[i]);
import{r as f,d as hn,j as e,g as Fe,f as K,L as ll,M as E,a5 as Z,o as cl,ag as ul,a6 as dt,p as dl,D as ml}from"./lip667d8t42poxum.js";import{d as At}from"./mrja6mbtdpn27l02.js";import{oi as Rt,W as fe,bJ as Ha,kJ as xn,ek as Ua,g_ as ys,n2 as Ga,s4 as Sn,u2 as za,b_ as lt,hq as pl,du as fl,Q as vs,hp as gl,u3 as hl,gP as xl,ff as Sl,eU as bl,u4 as zt,u5 as qe,V as Wt,u6 as bn,u7 as Se,u8 as Cl,u9 as yl,an as Vt,ua as ct,ub as vl,fG as Cn,eu as H,ei as ia,c4 as qt,uc as Wa,ud as wl,d3 as ut,d as on,ue as yn,uf as ws,ug as Va,fA as _l,eR as vn,eO as qa,eP as wn,eQ as _n,gd as jl,is as jn,uh as Ya,fQ as kl,g7 as Rl,ui as ra,uj as Al,lu as kn,rm as Ml,uk as El,ul as Ka,ru as Pl,g5 as $a,um as Tl,un as Nl,uo as Bl,hE as Il,up as Ol,uq as Dl,ur as Ll,k1 as _s,d9 as js,M as Rn,us as Fl,ut as ps,p6 as Hl,qB as Ul,b8 as Le,aZ as pe,a_ as An,al as Gl,uu as Qa,ph as zl,uv as Wl,uw as Vl,ux as ql,im as De,bG as Ht,d2 as Mn,uy as Yl,uz as Kl,uA as $l,iq as fs,ly as Xa,uB as Ql,uC as Xl,uD as Jl,fz as Zl,uE as Ja,pf as ks,ip as ec,uF as tc,mq as be,uG as sc,uH as nc,uI as oc,uJ as ac,uK as vt,uL as Za,uM as ic,uN as rc,uO as lc,E as an,i8 as ee,fP as cc,d8 as uc,uP as dc,uQ as mc,uR as pc,uS as fc,uT as gc,kv as $s,uU as la,uV as hc,uW as xc,uX as Sc,uY as bc,uZ as Cc,u_ as yc,rZ as Qs,B as En,by as ei,bz as ti,pH as vc,jo as wc,jr as _c,u$ as jc,f5 as kc,v0 as Rc,R as Ce,v1 as Ac,r7 as Ut,v2 as Mc,n1 as Ec,v3 as Pc,v4 as B,v5 as si,v6 as Tc,v7 as Nc,v8 as Bc,v9 as Ic,va as Oc,vb as Dc,vc as Lc,vd as Fc,ve as Hc,vf as Uc,vg as Gc,vh as zc,vi as Wc,vj as Vc,vk as qc,vl as Yc,vm as Kc,vn as $c,vo as Qc,vp as Xc,vq as Jc,hI as Zc,vr as eu,vs as tu,vt as su,vu as nu,vv as ou,vw as au,vx as iu,vy as ru,vz as lu,vA as cu,vB as uu,vC as du,vD as mu,vE as pu,vF as fu,vG as gu,vH as hu,vI as xu,h_ as ni,vJ as Su,vK as bu,vL as Cu,lA as yu,lB as oi,lz as wt,eH as vu,nv as ca,d7 as Pn,oY as ai,dc as ms,dd as wu,vM as Tn,vN as Nn,vO as _u,de as it,vP as gs,p9 as rn,fp as Bn,da as In,db as On,e6 as Dn,nu as Ln,e7 as Fn,nw as ju,jO as ku,pl as ii,io as He,vQ as Ru,vR as Au,pM as Mu,f as Eu,g0 as Hn,ia as Gt,vS as Pu,vT as Tu,vU as hs,jg as Nu,vV as ri,vW as li,vX as ci,vY as ui,vZ as Dt,lC as Bu,v_ as Iu,ne as xs,nd as di,v$ as Ou,w0 as Du,w1 as Lu,w2 as Fu,w3 as Hu,w4 as Uu,d6 as Un,A as Gn,jd as mi,w5 as ln,w6 as Gu,fE as zu,a2 as Wu,w7 as Ss,fF as pi,w8 as fi,fH as Vu,w9 as gi,fI as qu,ir as Yu,kR as zn,kT as Wn,kQ as Ku,qw as hi,wa as cn,wb as $u,eK as xi,aF as Qu,wc as Xu,wd as ua,g4 as Ju,oR as Vn,we as Si,wf as bi,fO as Zu,kS as ed,wg as td,wh as sd,wi as nd,wj as da,wk as od,wl as Ci,wm as ad,wn as id,wo as rd,gZ as yi,wp as vi,wq as wi,wr as ld,p8 as cd,ws as un,wt as ud,j9 as ma,e as dd,fn as md,fq as pd,X as fd,cR as gd,wu as hd,qQ as xd,wv as Sd,ww as bd,wx as Cd,wy as yd,wz as vd,lU as wd,wA as pa,le as _d,lP as jd,wB as Xs,wC as kd,mv as Rd,wD as Ad,wE as Md,wF as Ed,lX as Pd,wG as Td,wH as Nd,ct as Bd,wI as Id,y as Od,U as fa,fN as Dd,mG as Ld,mL as Fd,aG as Hd,wJ as Ud,wK as Gd,wL as zd,wM as Wd,wN as Vd,fD as qd,wO as ga,wP as ha,wQ as xa,mD as Yd,wR as Kd,wS as $d,wT as Qd,wU as Xd,wV as Jd,wW as Zd,e9 as em,oW as tm,kY as Sa,wX as sm,oj as _i,k7 as nm,wY as om,wZ as am,O as ji,ke as im,w_ as rm,w$ as lm,iE as cm,pj as um,x0 as dm,x1 as mm,iT as pm,oV as fm,jQ as gm,nE as Js,nF as Zs,jP as hm}from"./bek4a02po1hapmml.js";import{ao as Mt,hx as ki,af as le,g as Ke,s as _t,as as Te,cV as jt,aI as Ye,aj as T,gV as se,ag as te,aX as Pe,hc as Ri,cj as Ai,aJ as A,ae as oe,hy as Mi,gt as dn,W as Yt,c as q,F as qn,fp as Kt,hz as Yn,dZ as Ei,m as $e,b as ba,q as J,r as Ca,aY as xm,fq as Kn,c1 as Pi,aL as Oe,ff as Sm,e4 as bs,cc as bm,d9 as Ti,bQ as $t,fV as Cm,aO as ym,B as vm,bV as wm,dQ as Ni,hA as Bi,aV as rt,hB as _m,cz as ya,b1 as jm,fh as Ii,dg as Oi,aC as km,aE as kt,b8 as Rm,X as $n,_ as Qn,aH as en,u as mn,aa as Di,cl as Am,hC as Rs,e3 as Li,dj as Fi,ca as Mm,hD as Em,b3 as Pm,n as va,am as Ve,hE as wa,f5 as Xn,x as Tm,E as Nm,b2 as Bm,ah as Hi,eH as Im,c2 as Om,e as Dm,bC as Lm,gF as Jn,bU as Fm,gS as Hm,eA as Um,b9 as Lt,bb as _a,hF as Gm,hG as zm,hH as Wm,dJ as Vm,dK as qm,at as Ym,c4 as Km,c5 as $m,cU as ja,g8 as Qm,g9 as Xm,eS as Jm,hI as Zm}from"./hgyrt6j47bbfyjrt.js";import{P as ep,u as tp}from"./fk5wemdfypmbezuh.js";import{u as sp}from"./hxt6ipx4btplutlt.js";import{u as np}from"./j4mmgxghl8b1mh10.js";import{C as As,c as op,A as ap,d as Ui}from"./kx9sak1ife31wz46.js";import{G as Gi}from"./iamkd7uovamzrioo.js";import{e as ip,c as zi,b as Zn}from"./dh1349twprpizmeg.js";import{P as eo,B as Wi,C as to,F as Vi,g as rp,V as lp,a as cp,b as so,T as up}from"./ovkaazdtaxjvkjeq.js";import{G as dp}from"./accwyue32xah1z1m.js";import{e as mp,f as pp,h as us,i as fp,P as gp,j as hp}from"./gfnsbm99dy8f9dle.js";import{u as no}from"./jcf462ypc5hntqqf.js";import{u as qi,a as xp,I as Sp,R as bp,b as ka,C as Cp,H as Ra,B as yp,F as Aa,c as vp,T as wp,S as _p,d as Ma,e as jp}from"./bvff6uri7zkt0ua1.js";import{b as kp}from"./jy5dxk25zw6hpymq.js";import"./j5maet6kh5o0bu61.js";const Rp=({clientThreadId:t,rateLimitInfo:s,onDismiss:n,onInteract:o,onMount:a})=>{const{name:r,title:i,call_to_action:d,description:l}=s,u=Mt(),m=Rt(!0),{updateSystemHint:c}=fe(),p=At(),x=Rt(!1),g=ki(),h=le(t,te.getIsNewConversation),S=u?.planType??"unknown",y=Ke(),v=_t(y,"3809605125"),_=g&&"block_reason"in g?g.block_reason:null,P="banner_description",R=f.useMemo(()=>({type:r||"unknown",location:P,plan_type:S,is_new_conversation:h,is_hard_block:!!g,hard_block_reason:_??"",call_to_action:d}),[r,P,S,h,g,_,d]),M=hn(),w=Ha(),{isUnauthenticated:j}=Te(),N=xn(),D=Ua(jt.signUpButtonText),F=ys(),z=Ga({clientThreadId:t}),{layer:b}=Ye("1368081792"),I=Y=>{switch(Y){case se.AUTHENTICATE:return{text:N?jt.logInButtonText:D,onClick:()=>{w({authType:N?"login":"signup",callback:L=>{N?T.logLogInButtonClicked({location:`Rate limit banner - ${r}`,provider:L}):T.logSignUpButtonClicked({location:`Rate limit banner - ${r}`,provider:L})}})}};case se.AUTHENTICATE_SECONDARY:return{text:N?D:jt.logInButtonText,onClick:()=>{w({authType:N?"signup":"login",callback:L=>{N?T.logSignUpButtonClicked({location:`Rate limit banner - ${r}`,provider:L}):T.logLogInButtonClicked({location:`Rate limit banner - ${r}`,provider:L})}})}};case se.GET_PLUS:return{text:yt.getPlusButton,onClick:()=>{T.logRateLimitGetPlusButtonClicked(R),j?w({authType:N?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:L=>{N?T.logLogInButtonClicked({location:"Rate limit banner Get Plus upsell",provider:L}):T.logSignUpButtonClicked({location:"Rate limit banner Get Plus upsell",provider:L})}}):lt(M,"Prompt textarea rate limit banner")}};case se.NEW_CHAT:return{text:yt.newChatButton,onClick:()=>{m({modelId:"",location:P})}};case se.PAID_USER_O3_MINI_HIGH:{const L=te.getCurrentLeafId(Pe(t)),Q=()=>{T.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:b.get("should_change_model_picker",!0)?"In-context upsell o3-mini-high for Plus banner - Try it button":"In-context upsell o3-mini-high for Plus (no model switch) banner - Try it button",eventProperties:R}),b.get("should_change_model_picker",!0)&&x(v?{modelId:"o4-mini-high",location:"In-context upsell o4-mini-high for Plus banner - Try it button"}:{modelId:"o3-mini-high",location:"In-context upsell o3-mini-high for Plus banner - Try it button"}),z(v?{sourceEvent:new Event("click"),nodeId:L,requestedModelId:"o4-mini-high"}:{sourceEvent:new Event("click"),nodeId:L,requestedModelId:"o3-mini-high"})};return{text:yt.tryItButton,onClick:Q}}case se.FREE_USER_O3_MINI_HIGH:return{text:yt.getPlusButton,onClick:()=>{T.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:"In-context upsell o3-mini-high for Free banner - Get Plus button",eventProperties:R}),lt(M,"Prompt textarea in-context upsell banner")}};case se.DEEP_RESEARCH_IN_CONTEXT_UPSELL:{const L=te.findNode(Pe(t),ie=>Ri(ie.message)),Q=L?Ai(L.message):void 0;return{text:yt.tryItButton,onClick:()=>{T.logEventWithStatsig("In Context Upsell Banner Deep Research CTA Clicked","chatgpt_in_context_upsell_banner_deep_research_cta_clicked",{location:"In-context upsell deep research - Try it button",eventProperties:R}),c(A.Research,{clientThreadId:t}),p.focus(),p.setText(Q??"")}}}case"get_pro":return{text:yt.getProButton,onClick:()=>{T.logRateLimitUpgradePlanButtonClicked({...R,upgrade_plan_tye:"pro"}),j?w({authType:N?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:L=>{N?T.logLogInButtonClicked({location:"Rate limit banner Get Pro upsell",provider:L}):T.logSignUpButtonClicked({location:"Rate limit banner Get Pro upsell",provider:L})}}):lt(M,"Prompt textarea rate limit banner")}}}};Sn(()=>{!b.get("should_change_model_picker",!0)&&R.type==="o3-mini-high-in-context-upsell-plus"&&(R.type="o3-mini-high-in-context-upsell-plus-no-model-switch"),T.logRateLimitBannerShown(R),a?.()});const[G,W]=d??[];let k=W;G===se.AUTHENTICATE&&F&&(k=se.AUTHENTICATE_SECONDARY);const U={primaryAction:I(G),secondaryAction:I(k)};return e.jsx(za,{onDismiss:n,title:i,description:l,actions:U,onInteract:o})},yt=Fe({getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"},getProButton:{id:"Pl8/Vk",defaultMessage:"Get Pro"},newChatButton:{id:"7OvnJ5",defaultMessage:"New chat"},tryItButton:{id:"zPDzun",defaultMessage:"Try it"}}),Ap=({clientThreadId:t,rateLimitInfo:s,onDismiss:n,onInteract:o,onMount:a})=>{const{name:r,title:i,call_to_action:d,description:l}=s,u=Mt(),m=Rt(!0),{updateSystemHint:c}=fe(),p=At(),x=Rt(!1),g=ki(),h=le(t,te.getIsNewConversation),S=u?.planType??"unknown",y=ys(),v=Ke(),_=_t(v,"3809605125"),P=g&&"block_reason"in g?g.block_reason:null,R="banner_description",M=f.useMemo(()=>({type:r||"unknown",location:R,plan_type:S,is_new_conversation:h,is_hard_block:!!g,hard_block_reason:P??"",call_to_action:d}),[r,R,S,h,g,P,d]),w=hn(),j=Ha(),{isUnauthenticated:N}=Te(),D=xn(),F=Ua(jt.signUpButtonText),z=Ga({clientThreadId:t}),{layer:b}=Ye("1368081792"),I=Y=>{switch(Y){case se.AUTHENTICATE:return{text:D?jt.logInButtonText:F,onClick:()=>{j({authType:D?"login":"signup",callback:L=>{D?T.logLogInButtonClicked({location:`Rate limit banner - ${r}`,provider:L}):T.logSignUpButtonClicked({location:`Rate limit banner - ${r}`,provider:L})}})}};case se.AUTHENTICATE_SECONDARY:return{text:D?F:jt.logInButtonText,onClick:()=>{j({authType:D?"signup":"login",callback:L=>{D?T.logSignUpButtonClicked({location:`Rate limit banner - ${r}`,provider:L}):T.logLogInButtonClicked({location:`Rate limit banner - ${r}`,provider:L})}})}};case se.GET_PLUS:return{text:Ft.getPlusButton,onClick:()=>{T.logRateLimitGetPlusButtonClicked(M),N?j({authType:D?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:L=>{D?T.logLogInButtonClicked({location:"Rate limit banner Get Plus upsell",provider:L}):T.logSignUpButtonClicked({location:"Rate limit banner Get Plus upsell",provider:L})}}):lt(w,"Prompt textarea rate limit banner")}};case se.NEW_CHAT:return{text:Ft.newChatButton,onClick:()=>{m({modelId:"",location:R})}};case se.PAID_USER_O3_MINI_HIGH:{const L=te.getCurrentLeafId(Pe(t)),Q=()=>{T.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:b.get("should_change_model_picker",!0)?"In-context upsell o3-mini-high for Plus banner - Try it button":"In-context upsell o3-mini-high for Plus (no model switch) banner - Try it button",eventProperties:M}),b.get("should_change_model_picker",!0)&&x(_?{modelId:"o4-mini-high",location:"In-context upsell o4-mini-high for Plus banner - Try it button"}:{modelId:"o3-mini-high",location:"In-context upsell o3-mini-high for Plus banner - Try it button"}),z(_?{sourceEvent:new Event("click"),nodeId:L,requestedModelId:"o4-mini-high"}:{sourceEvent:new Event("click"),nodeId:L,requestedModelId:"o3-mini-high"})};return{text:Ft.tryItButton,onClick:Q}}case se.FREE_USER_O3_MINI_HIGH:return{text:Ft.getPlusButton,onClick:()=>{T.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:"In-context upsell o3-mini-high for Free banner - Get Plus button",eventProperties:M}),lt(w,"Prompt textarea in-context upsell banner")}};case se.DEEP_RESEARCH_IN_CONTEXT_UPSELL:{const L=te.findNode(Pe(t),ie=>Ri(ie.message)),Q=L?Ai(L.message):void 0;return{text:Ft.tryItButton,onClick:()=>{T.logEventWithStatsig("In Context Upsell Banner Deep Research CTA Clicked","chatgpt_in_context_upsell_banner_deep_research_cta_clicked",{location:"In-context upsell deep research - Try it button",eventProperties:M}),c(A.Research,{clientThreadId:t}),p.focus(),p.setText(Q??"")}}}}};Sn(()=>{!b.get("should_change_model_picker",!0)&&M.type==="o3-mini-high-in-context-upsell-plus"&&(M.type="o3-mini-high-in-context-upsell-plus-no-model-switch"),T.logRateLimitBannerShown(M),a?.()}),f.useEffect(()=>()=>{T.logEventWithStatsig("Rate Limit: Dismiss Banner","chatgpt_rate_limit_banner_dismissed",M)},[M]);const[G,W]=d??[];let k=W;G===se.AUTHENTICATE&&y&&(k=se.AUTHENTICATE_SECONDARY);const U={primaryAction:I(G),secondaryAction:I(k)};return e.jsx(za,{onDismiss:n,title:i,description:l,actions:U,onInteract:o})},Ft=Fe({getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"},newChatButton:{id:"7OvnJ5",defaultMessage:"New chat"},tryItButton:{id:"zPDzun",defaultMessage:"Try it"}}),Yi=t=>{const{value:s}=oe("1028682714");return s?e.jsx(Rp,{...t}):e.jsx(Ap,{...t})},Ki=qn.div`group flex h-10 items-center gap-2 rounded-lg px-2 hover:bg-token-main-surface-secondary text-sm text-token-text-primary`;function Mp(){const{data:t,isLoading:s}=gl({cutId:"recent",limit:8}),{data:n,isLoading:o}=hl();return{isLoading:s||o,recent:t,pinned:n}}function Ep({query:t,onSelectGizmo:s,selectedIdx:n},o){const a=pl(),r=f.useRef([]),{isLoading:i,recent:d,pinned:l}=Mp();f.useImperativeHandle(o,()=>({handleEnterOnIndex:c=>{if(!m[c])return c<u.length?u[c].resource:"create"},getResultsLength:()=>u.length+1,scrollToItem:c=>{const p=r.current[c];p&&p.scrollIntoView({behavior:"instant",block:"nearest"})}}));let u=[];if(i)return e.jsx("div",{className:"absolute end-4 top-0 flex h-full items-center justify-center",children:e.jsx(Yt,{})});d&&u.push(...d.pages.flatMap(c=>c.list.items).map(c=>({resource:c.resource,from:"recent"}))),l&&u.push(...l.items.map(c=>({resource:c,from:"pinned"}))),u=fl(u,c=>c.resource.gizmo.id);const m=u.map(c=>c.resource.gizmo.tags?.includes(vs.WorkspaceDisabled));return t&&t!==""&&(u=u.filter(c=>(c.resource.gizmo.display.name.toLowerCase()+c.resource.gizmo.display.description?.toLowerCase()+c.resource.gizmo.author.display_name?.toLowerCase()).includes(t?.toLowerCase()))),e.jsxs("div",{className:"max-h-40 overflow-y-auto",children:[u.map((c,p)=>e.jsx("div",{ref:x=>{r.current[p]=x},tabIndex:p,onClick:()=>{m[p]||s(c.resource)},children:e.jsx(Bp,{gizmoResource:c.resource,from:c.from,showDescription:a,isSelected:n===p,grayedOut:m[p]})},c.resource.gizmo.id)),e.jsx("div",{ref:c=>{r.current[u.length]=c},tabIndex:u.length,onClick:()=>{s("create")},children:e.jsx(Tp,{isSelected:n===u.length})},"create")]})}const Pp=f.forwardRef(Ep),Tp=({isSelected:t})=>e.jsx(Ki,{className:t?"bg-token-main-surface-secondary":"",children:e.jsxs(ll,{to:"/gpts/editor",target:"_blank",className:"flex flex-row space-x-2 font-semibold",children:[e.jsx("span",{className:"self-center",children:e.jsx(bl,{className:"icon-sm"})}),e.jsx("span",{children:e.jsx(E,{...$i.dropdownCreateLabel})})]})}),Np=({onClick:t,onClose:s})=>{const[n,o]=f.useState(null),a=f.useRef(null),r=f.useRef(null),[i,d]=f.useState(0),l=K(),u=m=>{T.logEvent("Mentions Click Gizmo",{gizmo_id:m==="create"?"create":m.gizmo.id}),m!=="create"&&t(m)};return e.jsxs(e.Fragment,{children:[e.jsx("input",{autoFocus:!0,placeholder:l.formatMessage($i.searchPlaceholder),ref:a,onKeyDown:m=>{if(m.nativeEvent.isComposing)return;const c=r.current?.getResultsLength()??0;if((m.key==="Escape"||m.key==="Backspace"&&!n)&&(m.preventDefault(),s()),m.key==="Enter"||m.key==="Tab"){m.preventDefault();const p=r.current?.handleEnterOnIndex(i);if(!p)return;p==="create"?(window.open("/gpts/editor","_blank"),s()):u(p)}if(m.key==="ArrowDown"&&i<c-1){m.preventDefault();const p=i+1;r.current?.scrollToItem(p),d(p)}if(m.key==="ArrowUp"&&i>0){m.preventDefault();const p=i-1;r.current?.scrollToItem(p),d(p)}},onChange:m=>{o(m.target.value),d(0)},className:"bg-token-main-surface-primary w-full border-0 p-2 text-sm focus:outline-hidden"}),e.jsx(Pp,{ref:r,query:n,selectedIdx:i,onSelectGizmo:u})]})},Ea=({onClick:t,onClose:s})=>{const n=Mi(),o=!!n;return Sn(()=>{T.logEvent("Mentions Opened",{gizmo_selector_disabled:o})}),o?e.jsx(Yi,{clientThreadId:dn,rateLimitInfo:n}):e.jsx("div",{onBlur:a=>{a.currentTarget.contains(a.relatedTarget)||s()},className:"popover border-token-border-default bg-token-main-surface-primary rounded-2xl border p-2 shadow-lg",children:e.jsx(Np,{onClick:t,onClose:s})})};function Bp({gizmoResource:t,from:s,showDescription:n,isSelected:o,grayedOut:a}){const r=!!t.gizmo.tags?.includes(vs.FirstParty);return e.jsxs(Ki,{className:q(o?"bg-token-main-surface-secondary":"",a&&"opacity-50"),children:[e.jsx(Gi,{isFirstParty:r,src:t.gizmo.display.profile_picture_url,className:q("icon-xl h-7 w-7 shrink-0",a&&"grayscale group-hover:grayscale-0")}),e.jsxs("div",{className:"flex h-fit grow flex-row justify-between space-x-2 overflow-hidden text-ellipsis whitespace-nowrap",children:[e.jsxs("div",{className:"flex flex-row space-x-2",children:[e.jsx("span",{className:"shrink-0 truncate font-semibold",children:t.gizmo.display.name}),n&&e.jsx("span",{className:"text-token-text-tertiary grow truncate text-sm sm:max-w-xs lg:max-w-md",children:t.gizmo.display.description})]}),e.jsx("span",{className:"shrink-0 self-center",children:s==="recent"?e.jsx(xl,{className:"icon-sm"}):e.jsx(Sl,{className:"icon-sm"})})]})]})}const $i=Fe({talkingTo:{id:"TaggingDropdown.talkingTo",defaultMessage:"Talking to"},dropdownCreateLabel:{id:"TaggingDropdown.dropdownCreateLabel",defaultMessage:"Create a GPT"},searchPlaceholder:{id:"TaggingDropdown.searchPlaceholder",defaultMessage:"Search recent and pinned GPTs"}});function Ip({systemHint:t,label:s,logo:n,isDisabled:o=!1,composerController:a,analyticsMetadata:r,onClick:i,showLabel:d=!1,splitButtonDropdownContent:l,showSplitButton:u,dropdownContent:m,dataTestid:c,tooltip:p,as:x}){const{name:g,systemHint:h}=t,S=h,{setThreadSystemHintMode:y,clearAllSystemHintModeTriggers:v}=fe(),_=zt(S),P=!!t.composerBarButtonInfo?.upsell,R=qe.useStore(),{value:M}=oe("2454940646"),w=Wt(),j=[A.Search,A.Think].includes(S);f.useEffect(()=>{o&&w.has(S)&&y(S,!1,r)},[o,S,r,y,w,j]);const N=f.useCallback(z=>{z.stopPropagation(),z.preventDefault();let b=!0;M&&j&&(R.getState().persistedSystemHints.has(A.Search)||R.getState().persistedSystemHints.has(A.Think))&&(b=!1),b&&v(),y(S,!_,r),_||(a.removeSystemHints(),a.focus()),bn(S,_?Se.Disable:Se.Enable,r.clientThreadId),i?.(z)},[r,M,v,a,S,j,_,i,y,R]),D=P?e.jsx("div",{className:"py-2",children:e.jsx(Cn,{location:S,statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked",containerNoPadding:!0})}):null;return e.jsx(As,{pressed:_,disabled:o,icon:n,label:s,ariaLabel:g,animatedLabel:!d,showLabel:d||_,onClick:N,dropdownContent:m??D,splitButtonDropdownContent:l,showSplitButton:u,dataTestid:c,tooltip:p,as:x})}function Op({composerController:t,systemHint:s,composerBarButtonInfo:n,isDisabled:o,clientThreadId:a,showLabel:r,labelOverride:i,disabledReason:d,rateLimitProgress:l,dropdownContent:u,splitButtonDropdownContent:m,showSplitButton:c,logoOverride:p,dataTestid:x,tooltipPosition:g,disableNuxMarkdown:h,as:S}){const y={clientThreadId:a},v=_=>e.jsx(Dp,{composerBarButtonInfo:n,isDisabled:o,analyticsMetadata:y,systemHint:s.systemHint,disabledReason:d,rateLimitProgress:l,tooltipPosition:g,disableNuxMarkdown:h,children:_});return e.jsx(Ip,{isDisabled:o,systemHint:s,label:i??s.name,logo:p??e.jsx(Kt,{svgString:s.logo,className:"h-[18px] w-[18px]"}),composerController:t,analyticsMetadata:y,showLabel:r,dropdownContent:u,splitButtonDropdownContent:m,showSplitButton:c,dataTestid:x,tooltip:v,as:S})}function Dp({children:t,isDisabled:s,systemHint:n,composerBarButtonInfo:o,analyticsMetadata:a,disabledReason:r,rateLimitProgress:i,tooltipPosition:d="bottom",disableNuxMarkdown:l}){const u=Cl(o.announcementKey,n),m=yl({composerBarButtonInfo:o,children:t,disableMarkDown:l}),c=K();let p=null;return i&&i.remaining?p=e.jsx(Qi,{remaining:i.remaining,reset_date:i.reset_after,text:o.tooltipText}):o.tooltipText&&(p=e.jsx(oo,{text:o.tooltipText})),u?m:e.jsx("div",{children:e.jsx(Vt,{label:s?r===ct.HasAttachedFiles?c.formatMessage({id:"hhxO6y",defaultMessage:"Reason disabled for attachments"}):r===ct.DeepResearchHighLoad?c.formatMessage({id:"UrDtrS",defaultMessage:"Deep research is temporarily unavailable"}):r===ct.RateLimitReached?o.rateLimitReachedText:o.disabledText:p,side:d,onOpenChange:x=>{x&&bn(n,Se.Hover,a.clientThreadId)},children:t})})}const oo=({text:t})=>e.jsx("span",{children:t}),Qi=({remaining:t,reset_date:s,text:n})=>{const{locale:o}=K(),a=vl(s,o);return e.jsxs("div",{className:"text-start",children:[e.jsx("span",{className:"text-token-text-tertiary block text-xs font-semibold",children:e.jsx(E,{id:"PromptTextarea.systemHintTooltip.remaining",defaultMessage:"{remaining} available until {resetDate}",values:{remaining:t,resetDate:a}})}),e.jsx(oo,{text:n})]})};function Lp({children:t,isDisabled:s,disabledReason:n,logEvent:o}){const a=K(),r=Yn(),i=Ei(m=>m.bySystemHint(A.Research)),d=a.formatMessage({id:"SpX/tG",defaultMessage:"Get a detailed report"});let l=null;i&&i.remaining?l=e.jsx(Qi,{remaining:i.remaining,reset_date:i.reset_after,text:d}):l=e.jsx(oo,{text:d});const u=n===ct.DeepResearchHighLoad?a.formatMessage({id:"UrDtrS",defaultMessage:"Deep research is temporarily unavailable"}):n===ct.RateLimitReached&&r?a.formatMessage({id:"T3aUKM",defaultMessage:"More available {time}"},{time:r.resets_after_text}):void 0;return e.jsx(Vt,{className:"inline-block",label:s?u:l,side:"bottom",onOpenChange:m=>{m&&o(Se.Hover)},children:t})}const Fp=({items:t,searchTerm:s,setSearchTerm:n,selectedItems:o,searchPlaceholder:a,handleSelectItem:r,showSelectAllRepos:i,loading:d,endReposRef:l})=>{const u=wl(),m=i&&o?.includes("$all_accessible_repos");return e.jsx(Z.div,{variants:u,initial:"initial",animate:"animate",exit:"exit",className:"relative",children:e.jsxs("div",{className:"border-token-border-default bg-token-main-surface-primary flex max-h-60 w-full flex-col gap-2 overflow-y-auto rounded-lg border p-4",children:[e.jsx("input",{type:"text",value:s,onChange:c=>n(c.target.value),placeholder:a,className:"text-token-text-primary bg-token-main-surface-primary border-token-border-default w-full rounded-sm border-1 px-2 py-1 text-sm focus:ring-0 focus:ring-offset-0 focus:outline-hidden"}),t?.map(c=>{const p=o?.includes(c.name);return e.jsx(ut,{onClick:()=>{r(c)},isSelected:p,label:c.name,subtitle:c.description??void 0,className:"mx-0! w-full",selectedIconClassName:"color:black dark:color-gray"},c.name)}),d&&e.jsxs("div",{className:"text-token-text-secondary flex items-center justify-center gap-2 text-xs",children:[e.jsx(Yt,{}),e.jsx(E,{id:"M1WgQ2",defaultMessage:"Searching..."})]}),i&&e.jsx(ut,{onClick:()=>{r({name:"$all_accessible_repos"})},className:"mx-0! w-full",isSelected:m,label:e.jsx(E,{id:"pJnTxe",defaultMessage:"All Repositories"}),subtitle:e.jsx(E,{id:"EhTGqu",defaultMessage:"Select all repositories accessible to ChatGPT"}),selectedIconClassName:"color:black"},"select-all-repos"),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-token-border-primary border-token-border-default mt-2 mb-2 border-b"}),e.jsx(ut,{onClick:()=>{window.open(Wa,"_blank")},isSelected:!1,isActive:!1,label:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(E,{id:"ICVOEb",defaultMessage:"Configure Repositories"})}),subtitle:e.jsx(E,{id:"GXUcp/",defaultMessage:"Configure which repositories ChatGPT can access"}),className:"mx-0! w-full",infoIcon:e.jsx(qt,{className:"icon-sm"}),infoLink:"https://help.openai.com/en/articles/11145903-chatgpt-connectors "},"configure-repos")]}),e.jsx("div",{className:"border-token-border-default my-2 border-t",ref:l}),e.jsx("div",{className:"text-token-text-secondary justify-center text-center text-xs",children:e.jsx(E,{id:"5A9QzP",defaultMessage:"Not seeing your repositories? {helpLink}.",values:{helpLink:e.jsx(e.Fragment,{children:e.jsx("a",{href:"https://help.openai.com/en/articles/11145903-chatgpt-connectors",target:"_blank",rel:"noopener noreferrer",className:"underline",children:e.jsx(E,{id:"sVuhcw",defaultMessage:"Learn more"})})})}})})]})})},Hp=({items:t,searchTerm:s,setSearchTerm:n,selectedItems:o,searchPlaceholder:a,handleSelectItem:r,showSelectAllRepos:i,loading:d,endReposRef:l})=>{const u=f.useRef(null),m=i&&o?.includes("$all_accessible_repos");return f.useEffect(()=>{requestAnimationFrame(()=>{u.current?.focus(),u.current?.select()})},[]),e.jsxs(e.Fragment,{children:[e.jsx(H.Item,{className:"mx-1.5 mb-1 p-0!",onClick:c=>{c.preventDefault(),u.current?.focus()},onFocus:()=>u.current?.focus(),tabIndex:-1,children:e.jsx("input",{type:"text",value:s,onChange:c=>n(c.target.value),placeholder:a,className:"text-token-text-primary bg-token-bg-primary border-token-border-default m-[-1px] w-full rounded-[10px] border-1 px-2.5 py-2 text-sm focus:ring-0 focus:ring-offset-0 focus:outline-hidden",ref:u,onKeyDown:c=>{if(tn(c,"ArrowDown"))c.preventDefault(),sn(c.currentTarget);else{if((tn(c,"ArrowLeft")||tn(c,"ArrowRight"))&&c.currentTarget.selectionStart===0)return;c.stopPropagation()}}})}),t?.map(c=>{const p=o?.includes(c.name);return e.jsx(H.Item,{onClick:x=>{x.preventDefault(),r(c),p&&!s&&sn(x.currentTarget)},secondary:c.description,trailing:p&&ia,children:c.name},c.name)}),d&&e.jsx("div",{className:"text-token-text-tertiary mx-1.5 px-2 py-2.5 text-sm",role:"alert","aria-busy":"true",children:e.jsx(E,{id:"M1WgQ2",defaultMessage:"Searching..."})}),i&&e.jsx(H.Item,{onClick:c=>{c.preventDefault(),r({name:"$all_accessible_repos"}),m&&!s&&sn(c.currentTarget)},secondary:e.jsx(E,{id:"EhTGqu",defaultMessage:"Select all repositories accessible to ChatGPT"}),trailing:m&&ia,children:e.jsx(E,{id:"pJnTxe",defaultMessage:"All Repositories"})}),(i||t.length>0)&&e.jsx(H.Separator,{}),e.jsx(H.Item,{onClick:()=>{window.open(Wa,"_blank")},secondary:e.jsx(E,{id:"GXUcp/",defaultMessage:"Configure which repositories ChatGPT can access"}),trailing:e.jsx(qt,{className:"icon-sm"}),children:e.jsx(E,{id:"ICVOEb",defaultMessage:"Configure Repositories"})}),e.jsx("div",{className:"text-token-text-tertiary mx-1.5 justify-center px-2.5 py-2 text-center text-xs",ref:l,children:e.jsx(E,{id:"4Z21ID",defaultMessage:"Not seeing a repository? {helpLink}",values:{helpLink:e.jsx(e.Fragment,{children:e.jsx("a",{href:"https://help.openai.com/en/articles/11145903-chatgpt-connectors",target:"_blank",rel:"noopener noreferrer",className:"underline",children:e.jsx(E,{id:"sVuhcw",defaultMessage:"Learn more"})})})}})})]})};function tn(t,s){return t.key===s&&!t.nativeEvent.isComposing&&!t.ctrlKey&&!t.altKey&&!t.shiftKey&&!t.metaKey}function sn(t){const s=t.closest("[role=menuitem]");if(!s)return;let n=s.nextElementSibling;for(;n&&n.getAttribute("role")!=="menuitem";)n=n.nextElementSibling;if(!n)for(n=s.previousElementSibling;n&&n.getAttribute("role")!=="menuitem";)n=n.previousElementSibling;n instanceof HTMLElement&&n.focus()}function Up(t,s){const[n,o]=f.useState(t),a=f.useRef(on(r=>o(r),s));return f.useEffect(()=>(a.current=on(r=>{o(r)},s),()=>{a.current?.cancel()}),[s]),f.useEffect(()=>{a.current?.(t)},[t]),n}const Pa=({searchTerm:t,setSearchTerm:s,selectedRepos:n,handleSelectRepo:o,linkId:a,asSubmenu:r})=>{const i=$e(),d=K(),l=Ke(),u=Up(t,300),{data:m,isFetching:c,isFetchingNextPage:p,isError:x,fetchNextPage:g,hasNextPage:h}=cl({queryKey:["github-repos",u,a],queryFn:async({pageParam:w=null})=>u.length===0?{repos:[],next_token:null}:_t(l,"1524828339")?await ba.safePost("/aip/connectors/github/search_repos",{requestBody:{query:u,limit:20,next_token:w,link_id:a}}):await ba.safePost("/aip/connectors/github/search_repos_v2",{requestBody:{query:u,limit:2,next_token:w,link_id:a}}),getNextPageParam:w=>w.next_token??void 0,initialPageParam:null,retry:1}),S=f.useRef(null),y=1,v=f.useRef(0);f.useEffect(()=>{if(!h||p)return;const w=S.current,j=new IntersectionObserver(N=>{N[0].isIntersecting&&v.current<y&&g()},{threshold:1});return w&&j.observe(w),()=>{w&&j.unobserve(w)}},[h,p,g]),f.useEffect(()=>{v.current=0},[u]),f.useEffect(()=>{x?(v.current+=1,v.current===1&&i.danger("Request error fetching Github repositories. Try disconnecting and connecting GitHub again.")):!p&&!x&&(v.current=0)},[x,p,i]);let _=m&&u?m.pages.flatMap(w=>w.repos).flatMap(w=>w.repository_full_name):[];_=Array.from(new Set([..._,...n.selectedRepos??[]]));const P=w=>{o(w.name)},R=r?Hp:Fp,M=e.jsx(R,{items:_?.map(w=>({name:w}))??[],searchTerm:t,setSearchTerm:s,selectedItems:[...n.selectedRepos??[],...n.selectedAllRepos?["$all_accessible_repos"]:[]],searchPlaceholder:d.formatMessage({id:"lEa/MK",defaultMessage:"Add a repositoryâ€¦"}),handleSelectItem:P,showSelectAllRepos:!1,loading:c||p,endReposRef:S});return r?M:e.jsx("div",{children:M})};function Gp({clientThreadId:t,repoSelectorOpen:s,linkId:n,triggerButton:o,setRepoSelectorOpen:a,asSubmenu:r}){const{selectedRepos:i,setSelectedRepos:d}=yn(t),{deleteSource:l,addSource:u}=ws(t),[m,c]=f.useState(""),p=f.useRef(null),x=g=>{let h=[],S=!1;g==="$all_accessible_repos"?(S=!i?.selectedAllRepos,d({selectedRepos:[],selectedAllRepos:S})):i?.selectedRepos?.includes(g)?(h=i.selectedRepos?.filter(y=>y!==g),d({selectedRepos:h,selectedAllRepos:!1})):(h=[...i?.selectedRepos??[],g],d({selectedRepos:h,selectedAllRepos:!1})),S||h.length>0?u(J.GITHUB_CONNECTOR):r||l(J.GITHUB_CONNECTOR)};if(r){if(!n)return null;const g=Va(i);return e.jsxs(H.Sub,{open:g?s:!0,onOpenChange:h=>{g&&a(h)},children:[e.jsx(H.SubMenuTrigger,{className:"ps-4",icon:_l,children:o}),e.jsx(H.Portal,{children:e.jsx(H.SubContent,{children:e.jsx(Pa,{asSubmenu:r,searchTerm:m,setSearchTerm:c,selectedRepos:{selectedRepos:i.selectedRepos?[...i.selectedRepos]:[],selectedAllRepos:i.selectedAllRepos},handleSelectRepo:x,linkId:n})})})]})}return e.jsx(vn,{open:s,onOpenChange:g=>{a(g),g||c("")},children:e.jsxs(qa,{children:[o,n&&e.jsx(wn,{children:e.jsx(_n,{side:"bottom",align:"start",ref:p,children:e.jsx(Pa,{asSubmenu:r,searchTerm:m,setSearchTerm:c,selectedRepos:{selectedRepos:i.selectedRepos?[...i.selectedRepos]:[],selectedAllRepos:i.selectedAllRepos},handleSelectRepo:x,linkId:n})})})]})})}const zp=30,Wp=25,Ms=({clientThreadId:t,enabledConnectors:s,includeWebSearch:n=!0,includeSyncConnectors:o=!1})=>{const a=K(),{selectedSources:r,toggleSource:i}=ws(t),d=jl(),[l,u]=f.useState(!1),{selectedRepos:m}=yn(t),c=Ke(),{connectorLinks:p}=ip(),{connectionInstanceData:x,refetch:g}=jn({skip:!o}),h=f.useMemo(()=>[...x?.connection_statuses??[]].sort(Ya),[x]),S=f.useMemo(()=>{if(m?.selectedRepos?.length&&m?.selectedRepos?.length>=1){const y=m.selectedRepos;let v=y[0];if(v.length>zp){const P=(Wp-3)/2;v=v.slice(0,Math.floor(P))+"..."+v.slice(Math.floor(-11))}const _=y.length-1;return _>0?`${v} +${_}`:v}},[m.selectedRepos]);return!t||!r?null:e.jsxs(e.Fragment,{children:[e.jsx(H.Label,{children:e.jsx(E,{id:"bXIRlR",defaultMessage:"Sources"})}),n&&e.jsx(H.CheckboxItem,{icon:kl,checked:r.has(Ca.Web),onCheckedChange:()=>{i(Ca.Web)},children:a.formatMessage(nn.webSearch)}),o&&h.map(y=>e.jsx(qp,{connection:y,location:"user_dropdown",refetch:g},y.user_connection_details.connection_instance_id)),s.map(y=>{const v=p.get(Rl[y])?.[0],_=!!v,P=r.has(y)&&_;switch(y){case J.GITHUB_CONNECTOR:case J.GDRIVE_ACTION_CONNECTOR:case J.DROPBOX_CONNECTOR:case J.HUBSPOT_CONNECTOR:case J.LINEAR_CONNECTOR:case J.SHAREPOINT_CONNECTOR:case J.OUTLOOK_EMAIL_CONNECTOR:case J.GCAL_CONNECTOR:case J.GMAIL_CONNECTOR:case J.GOOGLE_CONTACTS_CONNECTOR:case J.OUTLOOK_CALENDAR_CONNECTOR:case J.TEAMS_CONNECTOR:case J.BOX_CONNECTOR:case J.INTERCOM_CONNECTOR:{const R=y===J.GITHUB_CONNECTOR&&_&&P,M=a.formatMessage(ra[y].title),w=ra[y].icon;return e.jsxs(e.Fragment,{children:[_?e.jsx(H.CheckboxItem,{icon:w,checked:P,onCheckedChange:()=>{i(y)},children:M}):e.jsx(H.Item,{onSelect:()=>{Al(y,c,void 0,d)},icon:w,trailing:e.jsx("div",{className:"text-token-text-tertiary",children:a.formatMessage(nn.connect)}),children:M}),R&&e.jsx(Gp,{asSubmenu:!0,clientThreadId:t,setRepoSelectorOpen:u,repoSelectorOpen:l,linkId:v?.id,triggerButton:S??a.formatMessage({id:"sDCihQ",defaultMessage:"Repositories"})},y)]})}default:return}}),e.jsx(H.Item,{icon:kn,onSelect:()=>{window.location.hash="#settings/ConnectorSettings"},children:a.formatMessage(nn.connectApps)})]})},Vp=({clientThreadId:t,enabledConnectors:s,trigger:n,includeWebSearch:o})=>{const{deleteSource:a}=ws(t);return e.jsxs(H.Root,{"data-testid":"sources-pill",onOpenChange:r=>{r||(Va(Nl(Pe(t)))||a(J.GITHUB_CONNECTOR),Pe(t)?.selectedSources?.size===0&&xm(t,l=>{l.selectedSources=void 0}))},children:[n,e.jsx(H.Portal,{children:e.jsx(H.Content,{alignOffset:-8,size:"auto",children:e.jsx(Ms,{clientThreadId:t,enabledConnectors:s,includeWebSearch:o})})})]})},qp=({connection:t,refetch:s,location:n})=>{const o=K(),[a,r]=f.useState(!1),[i,d]=f.useState(),l=t.user_connection_details.connection_instance_id,u=$e(),m=Ml(),c=t.user_connection_details.knowledge_connector_type,p=c==="google_drive_oauth",x=f.useCallback(async()=>{try{r(!0),await El({connectorType:c,connectionId:l,location:n,intl:o})}catch(P){P instanceof Error?u.danger(P.message):u.danger(o.formatMessage({id:"FNXFnS",defaultMessage:"Encountered an error connecting your account. Please try again later."}))}finally{r(!1),s?.()}},[l,c,o,n,s,u]),[g,h]=f.useState(!1),S=()=>p?h(!0):x(),y=t.user_connection_details.activation_status==="inactive"&&t.user_connection_details.auth_status==="not_connected",v=["activating","partially_activated"].includes(t.user_connection_details.activation_status),_=y&&!m||v;return e.jsxs(e.Fragment,{children:[i&&e.jsx(Ka,{connection:i,onClose:()=>d(void 0)}),g&&e.jsx(Pl,{isAdminFlow:!1,onClose:()=>h(!1),connectionId:l,location:n,onSuccess:s}),e.jsx(H.Item,{disabled:!_,onSelect:P=>{if(P.stopPropagation(),P.preventDefault(),y){S();return}if(v){d(t);return}},icon:e.jsx("img",{src:t.connection_display_info.icon_url??"",alt:t.connection_display_info.display_name,className:"icon-md"}),trailing:a?e.jsx(Yt,{className:"icon-md"}):e.jsx($a,{connection:t,location:"user_dropdown",inactiveButtonOverride:e.jsx("div",{className:"text-token-text-tertiary",children:e.jsx(Tl,{connection:t,refetch:s,location:"user_dropdown"})})}),children:t.connection_display_info.display_name},t.connection_display_info.display_name)]})},nn=Fe({allRepositories:{id:"EzHFPp",defaultMessage:"All Repositories"},connect:{id:"OODbh3",defaultMessage:"Connect"},sourcesEnabled:{id:"aEIPI+",defaultMessage:"On"},webSearch:{id:"XoUbAe",defaultMessage:"Web search"},sourcesDisabled:{id:"j32+iI",defaultMessage:"Off"},connectApps:{id:"QJdTTY",defaultMessage:"Connect apps"}});function Yp({clientThreadId:t,gizmoId:s,showLabel:n=!1,isDisabled:o}){const a=Bl(t,s),r=At(),i=zt(A.Research),{setThreadSystemHintMode:d,clearAllSystemHintModeTriggers:l}=fe(),u=!!Yn(),{value:m}=oe("1416952492"),c=m?ct.DeepResearchHighLoad:u?ct.RateLimitReached:void 0;return a?e.jsx("div",{"data-testid":"system-hint-research",style:{viewTransitionName:`var(--vt-composer-${A.Research}-action)`},children:e.jsx(Kp,{composerController:r,isThreadInSystemHintMode:i,setThreadSystemHintMode:d,clearAllSystemHintModeTriggers:l,clientThreadId:t,showLabel:n,isDisabled:o||!!c,disabledReason:c})},`system-hint-${A.Research}`):null}function Kp({composerController:t,isThreadInSystemHintMode:s,setThreadSystemHintMode:n,clearAllSystemHintModeTriggers:o,clientThreadId:a,showLabel:r=!1,isDisabled:i=!1,disabledReason:d}){const l=K(),u={clientThreadId:a},m=l.formatMessage({id:"ORxecl",defaultMessage:"Deep research"}),c=v=>{v===Se.Hover?T.logEventWithStatsig("Composer Research Button Hovered","composer_research_button_hovered",u):v===Se.Enable?T.logEventWithStatsig("Composer Research Button Enabled","composer_research_button_enabled",u):v===Se.Disable&&T.logEventWithStatsig("Composer Research Button Disabled","composer_research_button_disabled",u)},p=v=>{v.stopPropagation(),v.preventDefault(),o(),n(A.Research,!s,u),s||(t.removeSystemHints(),t.focus()),c(s?Se.Disable:Se.Enable)},x=oe("3544641259")?.value,g=zi(),{enabled:h}=Zn(),S=f.useMemo(()=>Object.entries(g).reduce((v,[_,P])=>(P&&(_!==J.GITHUB_CONNECTOR||h)&&v.push(_),v),[]),[g,h]),y=v=>e.jsx(Lp,{disabledReason:d,isDisabled:i,logEvent:c,children:v});return e.jsx(As,{pressed:s,disabled:i,icon:e.jsx(Il,{className:"h-[18px] w-[18px]"}),label:m,animatedLabel:!r,showLabel:r||s,onClick:p,ariaLabel:m,dataTestid:"composer-button-deep-research",splitButtonDropdownContent:x?e.jsx(Ms,{clientThreadId:a,enabledConnectors:S,includeSyncConnectors:!1,includeWebSearch:!0}):void 0,showSplitButton:s&&x,tooltip:y,as:x?"dropdown":"popover"})}function $p({clientThreadId:t,gizmoId:s,composerController:n,isDisabled:o}){return Ol({clientThreadId:t,gizmoId:s})?e.jsx("div",{"data-testid":"system-hint-reason",style:{viewTransitionName:`var(--vt-composer-${A.Think}-action)`},children:e.jsx(Qp,{clientThreadId:t,composerController:n,isDisabled:o})},`system-hint-${A.Think}`):null}function Qp({clientThreadId:t,composerController:s,isDisabled:n}){const o=K(),a=!!Kn();n=n||a;const r=o.formatMessage({id:"T+qu+0",defaultMessage:"Reason"}),{setThreadSystemHintMode:i,clearAllSystemHintModeTriggers:d}=fe(),l=zt(A.Think),u=qe.useStore(),m=Wt(),{isUnauthenticated:c}=Te();f.useEffect(()=>{n&&m.has(A.Think)&&i(A.Think,!1,{clientThreadId:t})},[n,m,i,t]);const p=h=>{if(h.stopPropagation(),h.preventDefault(),c)return;let S=!0;u.getState().persistedSystemHints.has(A.Search)&&(S=!1),S&&d(),i(A.Think,!l,{clientThreadId:t}),l||(s.removeSystemHints(),s.focus()),l?T.logEventWithStatsig("Composer Think Button Disabled","composer_think_button_disabled",{clientThreadId:t}):T.logEventWithStatsig("Composer Think Button Enabled","composer_think_button_enabled",{clientThreadId:t})},x=c?e.jsx(Cn,{location:A.Think,statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked",containerNoPadding:!0}):void 0,g=e.jsx(As,{pressed:l,disabled:n,icon:e.jsx(Ll,{className:"h-[18px] w-[18px]"}),label:r,ariaLabel:r,animatedLabel:!0,showLabel:!0,onClick:p,dropdownContent:x,dataTestid:"composer-button-reason"});return e.jsx(Dl,{isDisabled:n,clientThreadId:t,children:g})}const Xp=["o1","o1-pro","gpt-4"];function Jp({account:t,clientBootstrapFlags:s,features:n,clientThreadId:o,currentModelConfig:a,composerController:r,isDisabled:i,gizmoId:d,hasFiles:l}){const{prospectiveModelId:u}=_s(o),m=js(o),c=Rn(d),{userIsInSearchHoldoutWithWebDisabled:p}=Fl(),x=a?.enabledTools?.includes(Pi.Search),g=m==null||m?.kind===Oe.PrimaryAssistant||m?.kind===Oe.GizmoInteraction&&c,{isUnauthenticated:h}=Te(),S=Sm(A.Search);return x===!1||h&&s?.includes(bs.AnonSearchHoldout)||!h&&(t==null||t.isFree())&&(s?.includes(bs.FreeSearchHoldout)||p)||!S||!h&&(t==null||t.isEnterprisey())&&!n?.includes(bm.BrowsingAvailable)||!g?null:e.jsx("div",{"data-testid":"system-hint-search",style:{viewTransitionName:`var(--vt-composer-${A.Search}-action)`},children:e.jsx(Zp,{clientThreadId:o,composerController:r,modelSupportsSearch:x??(h||t?.isFree()||!!u&&!Xp.includes(u)),isDisabled:i,disabledReason:x?l?ps.HasAttachedFiles:void 0:ps.ModelNotSupported,currentModelName:a?.title??""})},`system-hint-${A.Search}`)}function Zp({clientThreadId:t,composerController:s,isDisabled:n,disabledReason:o,currentModelName:a,modelSupportsSearch:r}){const i=K(),d=Hl(),l=i.formatMessage({id:"TbHx8d",defaultMessage:"Search"}),{setThreadSystemHintMode:u,clearAllSystemHintModeTriggers:m}=fe(),c=qe.useStore(),p=Wt();n=n||!r,f.useEffect(()=>{n&&p.has(A.Search)&&u(A.Search,!1,{clientThreadId:t})},[n,p,u,t]);const x=g=>{g.stopPropagation(),g.preventDefault();let h=!0;c.getState().persistedSystemHints.has(A.Think)&&(h=!1),h&&m(),u(A.Search,!d,{clientThreadId:t}),d||(s.removeSystemHints(),s.focus()),T.logEventWithStatsig("Composer Search Button Clicked","composer_search_button_clicked",{clientThreadId:t}),d&&s.trimLeadingText(/^search\b/i)};return e.jsx(tf,{analyticsMetadata:{clientThreadId:t},isThreadUsingSearchMode:d,isDisabled:n,disabledReason:o,currentModelName:a,children:e.jsx(As,{pressed:d,disabled:n??!1,icon:e.jsx(Ul,{className:"h-[18px] w-[18px]"}),label:l,ariaLabel:l,animatedLabel:!0,showLabel:!0,onClick:x,dataTestid:"composer-button-search"})})}function ef(){const t=Qa(),s=Le(pe.hasSeenComposerSearchButtonTooltip);return!s.isLoading&&s.eligible&&!t}function tf({children:t,analyticsMetadata:s,isThreadUsingSearchMode:n,isDisabled:o,disabledReason:a,currentModelName:r}){const i=ef()&&!n,d=Le(pe.hasSeenComposerSearchButtonTooltip);return i?e.jsx(An,{announcementKey:pe.hasSeenComposerSearchButtonTooltip,side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(E,{id:"Yjduqi",defaultMessage:"Search the web"}),onDismiss:d.markAsViewed,sideOffset:0,className:"xs:max-w-sm! max-w-2xs!",description:e.jsx(E,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:e.jsx(Gl,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:e.jsx(E,{id:"stA7F4",defaultMessage:"Learn more"})})}}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(Vt,{className:"inline-block",label:o?a===ps.ModelNotSupported?e.jsx(E,{id:"GZemJe",defaultMessage:"Search disabled for {modelName}",values:{modelName:`${r}`}}):a===ps.HasAttachedFiles?e.jsx(E,{id:"Wd1fc2",defaultMessage:"Search disabled for attachments"}):e.jsx(E,{id:"GpDAWD",defaultMessage:"Search is unavailable"}):e.jsx(E,{id:"c+4o2s",defaultMessage:"Search the web"}),side:"bottom",onOpenChange:l=>{l&&T.logEventWithStatsig("Composer Search Button Hovered","composer_search_button_hovered",s)},children:t})})}const sf=1;function nf({value:t=sf,size:s,onStateChange:n}){return e.jsx("div",{className:"relative flex h-full w-full flex-col items-center justify-center",children:e.jsxs(Z.div,{animate:{translateY:t>1&&s==="small"?-1:0},onAnimationStart:()=>n?.("animating"),onAnimationComplete:()=>n?.("idle"),className:q("relative",s==="small"?"h-5 w-5":"h-8 w-8"),children:[e.jsx(Z.div,{style:{transformOrigin:"50% 100%",translateY:s==="large"?3:0},animate:{scale:t>1&&s==="small"?.85:1},className:"absolute start-0 top-0",children:e.jsx(zl,{"aria-label":"",className:q(s==="small"?"h-5 w-5":"h-8 w-8")})}),e.jsx(Z.div,{initial:{scale:s==="small"?.9:1.1,opacity:0},animate:{scale:s==="large"?1.1:t>1?1:.9,opacity:t>1?1:0},style:{translateY:s==="large"?-1:0},className:"absolute start-0 top-0",children:e.jsx(Wl,{"aria-label":"",className:q(s==="small"?"h-5 w-5":"h-8 w-8")})}),e.jsx(Z.div,{initial:{scale:s==="small"?.9:1.1,opacity:0},animate:{scale:s==="large"?1.1:t>2?1:.9,opacity:t>2?1:0},style:{translateY:s==="large"?-1:0},className:"absolute start-0 top-0",children:e.jsx(Vl,{"aria-label":"",className:q(s==="small"?"h-5 w-5":"h-8 w-8")})})]})})}function of(t){const{reasoningLevelTypes:s,reasoningLevelType:n}=t,{ReasoningLevels:o}=s;let a=1;return n===o.medium.type?a=2:n===o.high.type&&(a=3),e.jsx("div",{className:q("relative flex h-5 w-5 items-center justify-center"),children:e.jsx(nf,{size:"small",value:a})})}const af=({isManualModelSelection:t,animatedLabel:s,reasoningLevelTypes:n,reasoningLevelType:o,modelName:a,onResetReasoningLevel:r,onReasoningLevelChanged:i,type:d})=>{const[l,u]=f.useState(!1),m=ul(),{reasoningLevel:c}=ql({reasoningLevelTypes:n,reasoningLevelType:o}),p=o!=="low"||t||!1,x=De(h=>h.isVisuallyOverflowing),g=x;return e.jsxs("div",{className:q("radix-state-open:bg-black/10 inline-flex h-9 rounded-full border text-[13px] font-medium",p?"text-token-interactive-label-accent-default can-hover:hover:bg-[#BDDCF4] dark:can-hover:hover:bg-[#1A416A] bg-token-composer-blue-bg border-transparent dark:bg-[#2A4A6D] dark:text-[#48AAFF]":"border-token-border-default text-token-text-secondary can-hover:hover:bg-token-main-surface-secondary focus-visible:outline-black dark:focus-visible:outline-white",l&&"duration-75 motion-safe:transition-all"),children:[e.jsxs("div",{className:"flex h-full min-w-8 items-center justify-center p-2","aria-pressed":p,onTransitionEnd:()=>u(!1),onClick:h=>{d==="think"&&!t&&!x&&(h.stopPropagation(),h.preventDefault(),i(o==="low"?"medium":"low"))},children:[e.jsx(of,{reasoningLevelTypes:n,reasoningLevelType:o}),s&&e.jsx(dt,{initial:!1,children:e.jsx(Z.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:m?0:.15},children:e.jsx("div",{className:q("ps-1 pe-1 whitespace-nowrap",g&&!t&&"hidden"),children:t?a:c?.shortLabel})})}),!t&&d==="auto"&&!p&&!g&&e.jsx(Ht,{"aria-label":"",className:"h-[18px] w-[18px] opacity-50"})]}),p&&!x&&(t||d!=="think")?e.jsx("div",{className:"border-token-border-default mt-[1px] border-s p-2",style:{borderColor:p?"#0285FF28":void 0},onClick:h=>{h.stopPropagation(),h.preventDefault(),r()},children:e.jsx(Ti,{"aria-label":"",className:"h-[16px] w-[16px]"})}):d==="think"?e.jsx("div",{className:q("border-token-border-default border-s p-2",g&&"hidden"),style:{borderColor:p?"#0285FF28":void 0},children:e.jsx(Ht,{className:"h-[18px] w-[18px]"})}):null]})},rf=({clientThreadId:t,currentModelId:s,onModelSelection:n,closePopover:o,setIsModelPickerOpen:a,ref:r})=>{const i=K(),{data:d}=$t(),{mode:l}=Mn(),u=Yl({clientThreadId:t}),{hasInternalModels:m}=Kl(),x=$l(g=>g.query).toLowerCase().trim().length>0;return e.jsxs(Z.div,{initial:{clipPath:"inset(0 100% 0 0)",opacity:0},animate:{clipPath:"inset(0 0% 0 0)",opacity:1},exit:{clipPath:"inset(0 100% 0 0)",opacity:0},transition:fs,className:"flex flex-col",ref:r,children:[l!=="model-picker-only"&&e.jsxs("div",{className:"border-token-border-xlight bg-token-main-surface-primary dark:bg-token-main-surface-secondary sticky start-0 top-0 z-10 flex w-full flex-row items-center justify-center overflow-clip border-b p-3",children:[e.jsx("button",{onClick:()=>{a(!1)},id:"reasoning-level-popover-model-list-back-button",className:"hover:bg-token-main-surface-tertiary flex items-center rounded-md p-1",children:e.jsx(Xa,{className:"text-token-text-secondary h-5 w-5"})}),e.jsx("div",{className:"flex-auto text-center text-sm font-medium",children:i.formatMessage({id:"j6WEI7",defaultMessage:"Choose a model"})}),e.jsx("div",{className:"w-5"})]}),e.jsx("div",{className:q("flex w-full flex-col pb-2"),children:x?e.jsx(Ql,{currentModelId:s,onModelSelection:n,closePopover:o,rootRef:r}):e.jsxs(e.Fragment,{children:[d?.categories?.map(g=>{const h=g?.defaultModel;return e.jsx(Xl,{model:g,modelSwitcherDenialsBySlug:u,isSelected:h===s,onClick:()=>{n(h),o()}},h)}),m&&e.jsxs(e.Fragment,{children:[e.jsx(Jl,{modelsData:d,clientThreadId:t,triggerButton:e.jsx(ut,{className:"relative mt-1 border-transparent",children:e.jsxs("div",{className:"mb-1 flex items-center px-1",children:[e.jsx("div",{className:"text-sm",children:i.formatMessage({id:"ZDpo4I",defaultMessage:"Internal Models"})}),e.jsx(Zl,{className:"icon-md text-token-text-tertiary absolute end-1 w-7"})]})}),onModelItemClick:g=>{g&&(n(g),o())}}),e.jsx(Ja,{})]})]})})]})},lf={modelPickerOpen:{maxHeight:375,width:320},modelPickerClosed:{maxHeight:245,width:320},vanguardModelPickerClosed:{maxHeight:320,width:264}},cf=({clientThreadId:t,reasoningLevelTypes:s,reasoningLevelType:n,onReasoningLevelChanged:o,isManualModelSelection:a,currentModelId:r,onModelSelection:i,resetReasoningLevel:d})=>{const{layoutMode:l,closePopover:u,mode:m}=Mn(),c=!ks(),[p,x]=f.useState(!!(a||m==="model-picker-only")),g=f.useRef(null),h=f.useRef(null);return f.useEffect(()=>{p?(g.current?.scrollTo({top:-1e3,behavior:"instant"}),document.getElementById("reasoning-level-popover-model-list-back-button")?.focus()):document.getElementById("reasoning-level-popover-juice-list-model-picker-button")?.focus()},[a,p]),e.jsxs(Z.div,{className:q("max-h-[max(calc(var(--radix-popover-content-available-height)-64px), 245px)] flex flex-1 origin-center snap-y snap-proximity scroll-pt-[30px] overflow-y-auto overscroll-contain scroll-smooth [scrollbar-gutter:stable]",c&&!p&&"pt-4",l==="bottom"&&"flex-col-reverse"),animate:p?"modelPickerOpen":"modelPickerClosed",transition:ec,variants:lf,ref:g,children:[!p&&m!=="model-picker-only"&&e.jsx(tc,{clientThreadId:t,reasoningLevelTypes:s,reasoningLevelType:n,onReasoningLevelChanged:o,resetReasoningLevel:d,shouldShowModelPicker:c,setIsModelPickerOpen:x,isModelPickerOpen:p,showAccountPaymentModal:lt}),e.jsx(dt,{children:p&&c&&e.jsx(rf,{clientThreadId:t,setIsModelPickerOpen:x,ref:h,currentModelId:r,onModelSelection:i,closePopover:u})})]})},uf=({clientThreadId:t,layoutMode:s,currentModel:n,category:o,type:a,...r})=>{const{data:i}=$t(),l=De(j=>j.threads[t]?.modelSelection)?.type===be.SPECIFIC,u=De(j=>j.setThreadModelSelection),m=ks(),c=hn(),p=f.useMemo(()=>{const j=n?.id??"";return sc(j)?"low":nc(j)?"medium":oc(j)?"high":"low"},[n?.id]),x=ac(),g=Rt(),h=f.useCallback(j=>{vt(t,u,{type:be.EFFORT_MODE,effortMode:Za[j]}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{const N=ic(j,i?.categories.map(D=>D.defaultModel)??[]);N&&(m&&j==="high"?lt(c,"Model picker upsell"):g({location:"PromptTextarea",modelId:N}))})})},[t,g,c,m,i,u]),S=j=>{const N=n?.id??"";j&&(T.logEvent("Model Switcher Model Changed",{from:N,to:j,source:"popover"}),ym.logEvent("chatgpt_model_switcher_model_changed",j,{from:N,to:j,source:"popover"}),g({modelId:j,location:"Model switcher menu item"}),lc({type:be.SPECIFIC,modelSlug:j}),vt(t,u,{type:be.SPECIFIC,modelSlug:j}))},y=!rc(n?.id??""),v=l||y,P=(o?.label&&o?.label?.length<10?o?.label:o?.shortLabel)??n?.title??"",R=n?.id??"",M=()=>{h("low")},w=f.useCallback(()=>{const{reasoningLevelList:j}=x,D=(j.findIndex(F=>F.type===p)+1)%j.length;h(j[D].type)},[h,p,x]);return f.useEffect(()=>Cm(dp,{cycleReasoningLevel:w}),[w]),e.jsxs(eo,{layoutMode:s,...r,children:[e.jsx(Wi,{children:e.jsx(af,{isManualModelSelection:v,modelName:P,animatedLabel:!0,reasoningLevelTypes:x,reasoningLevelType:p,onResetReasoningLevel:M,onReasoningLevelChanged:h,type:a})}),e.jsx(to,{align:"start",children:e.jsx(cf,{clientThreadId:t,reasoningLevelTypes:x,reasoningLevelType:p,onReasoningLevelChanged:h,modelName:P,isManualModelSelection:v,currentModelId:R,onModelSelection:S,resetReasoningLevel:M})})]})},df=({className:t,children:s})=>e.jsx(Z.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:s});function mf({canContinue:t,onContinueGenerating:s}){const n=f.useCallback(a=>{s(a),an()},[s]);let o=null;return t&&(o=e.jsx(ff,{onHandleContinueGenerating:n})),o&&e.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:o})}function pf({className:t}){return e.jsx(cc,{className:q("-rotate-180",t)})}const ff=({onHandleContinueGenerating:t})=>e.jsx(df,{children:e.jsx(vm,{as:"button",color:"secondary",onClick:t,className:"py-2 whitespace-nowrap",icon:pf,size:"small",children:e.jsx(E,{...ee.continueGenerating})})}),gf=({clientThreadId:t,composerController:s})=>{const n=Bi(),o=rt(s.store,g=>g.rateLimitBannerFeature),a=_m(),r=n??hf(o,a),i=le(t,te.getRequestId),d=le(t,te.getCurrentLeafId),l=Ni(i),{layer:u}=Ye("1368081792"),m=r?.name?()=>{switch(r.name){case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":Sc(d);break}}:void 0,{value:c}=oe("3612584454");f.useEffect(()=>{l&&!(r?.name==="gpt-4l"&&c)&&(ya.dismissBanner(),s.setRateLimitBannerFeature(null))},[l,r?.name,c,s]);const p=r?.is_dismissible?()=>{T.logEventWithStatsig("Rate Limit: Dismiss Banner","chatgpt_rate_limit_banner_dismissed",{type:!u.get("should_change_model_picker",!0)&&r?.name==="o3-mini-high-in-context-upsell-plus"?"o3-mini-high-in-context-upsell-plus-no-model-switch":r?.name}),ya.dismissBanner(),s.setRateLimitBannerFeature(null)}:void 0,x=()=>{switch(r?.name){case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":bc({interactedInPeriod:!0});break}};return e.jsx(dt,{children:r&&e.jsx(Z.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(Yi,{clientThreadId:t,rateLimitInfo:r,onDismiss:p,onInteract:x,onMount:m})})})};function hf(t,s){const n=s.find(o=>o.name===t);return n?{name:n.name,title:n.title,description:n.description,is_dismissible:!0,call_to_action:n.call_to_action,resets_after:n.resets_after}:null}function xf(t,s,n,o,a,r,i,d,l,u,m){if(l||(t.name==="o3-mini-high-in-context-upsell-free"||t.name==="o3-mini-high-in-context-upsell-plus")&&(s.some(v=>v.model_slug==="o3-mini-high")||n.id==="o3-mini-high")||d&&i&&$s(Date.now(),i)<la)return!1;const p=o==null||$s(Date.now(),o)>=hc,x=a===u,g=i==null||r==null||$s(Date.now(),i)>=la||r<xc;if(!(p&&g||x))return!1;switch(t.name){case"deep-research-in-context-upsell":return m("should_show_deep_research_upsell_banner",!1);case"o3-mini-high-in-context-upsell-free":return m("should_show_o3_mini_high_upsell_banner_free_user_to_plus",!1);case"o3-mini-high-in-context-upsell-plus":return m("should_show_o3_mini_high_upsell_banner_plus_user",!1);default:return!1}}function Sf(t,s){const n=wm(),o=uc(t),a=le(t,te.getRequestId),r=le(t,te.getCurrentLeafId),i=Ni(a),d=Bi(),l=dc(S=>S.lastSeenInContextUpsellBannerAt),u=mc(S=>S.inContextUpsellBannerPeriodExposureCount),m=pc(S=>S.inContextUpsellBannerPeriodStartAt),c=fc(S=>S.inContextUpsellBannerLastSeenId),p=gc(S=>S.inContextUpsellBannerInteractedInPeriod),{layer:x}=Ye("1368081792"),g=rt(s.store,S=>S.rateLimitBannerFeature);let h=!1;switch(d?.name){case null:case void 0:h=g!=null;break;case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":h=xf(d,n,o,l,c,u,m,p,i,r,x.get);break;default:h=!0}return!i&&h}const Cs="month",Xi="year";function bf(){const t=jm(),s=K(),n=$e(),{markAsViewed:o}=Le(Cc),{initialBillingDetails:a}=sp(t,!0),r=f.useMemo(()=>({...t?.subscriptionAnalyticsParams,referrer:document.referrer}),[t]);async function i(){try{await vc(t?.features??[],s,n,a,r)}catch{}}const{shouldShowBanner:d,discountValue:l,discountDuration:u}=yc();if(f.useEffect(()=>{d&&l&&u&&Qs.logShowReferrerRedemptionBanner()},[d,l,u]),!d||!l||!u)return null;const m=Cf(s,a,l,u),c=yf(s,a,l,u),p=e.jsxs("div",{className:"grow",children:[e.jsx("div",{className:"mb-0.5 font-semibold",children:m}),e.jsx("span",{className:"text-token-text-secondary",children:c})]});return e.jsx(En,{onPrimaryCtaClick:()=>{o(),Qs.logClickReferrerRedeemButton(),i()},primaryCtaText:e.jsx(E,{id:"referrerRedemptionBannerPrimaryCta",defaultMessage:"Get Plus"}),onDismiss:()=>{o(),Qs.logCloseReferrerRedemptionBanner()},content:p})}function Cf(t,s,n,o){const{currencySymbol:a}=ei(ti(),s.currency),r=o?o.period:Cs,i=o?o.num_periods:1,d=a.code.defaultMessage?.toString()??Ii,l=t.formatNumber(n.value,{style:"currency",currency:d,minimumFractionDigits:0,maximumFractionDigits:2});let u;return r===Cs?u=i===1?e.jsx(E,{id:"referrerRedemptionBannerTitleForSingleMonth",defaultMessage:"Your {discount} credit is ready",values:{discount:l}}):e.jsx(E,{id:"referrerRedemptionBannerTitleForPluralMonths",defaultMessage:"Redeem your {discount} referral reward",values:{discount:l}}):r===Xi&&(u=i===1?e.jsx(E,{id:"referrerRedemptionBannerTitleForSingleYear",defaultMessage:"Redeem your {discount} referral reward",values:{discount:l}}):e.jsx(E,{id:"referrerRedemptionBannerTitleForPluralYears",defaultMessage:"Redeem your {discount} referral reward",values:{discount:l}})),u}function yf(t,s,n,o){const{currencySymbol:a}=ei(ti(),s.currency),r=o?o.period:Cs,i=o?o.num_periods:1,d=a.code.defaultMessage?.toString()??Ii,l=t.formatNumber(n.value,{style:"currency",currency:d,minimumFractionDigits:0,maximumFractionDigits:2});let u;return r===Cs?u=i===1?e.jsx(E,{id:"referrerRedemptionBannerContentForSingleMonth",defaultMessage:"Your referral link was used â€” claim your free month of Plus."}):e.jsx(E,{id:"referrerRedemptionBannerContentForPluralMonths",defaultMessage:"Your referral link earned you {discount} off {num_months} months of Plus.",values:{discount:l,num_months:i}}):r===Xi&&(u=i===1?e.jsx(E,{id:"referrerRedemptionBannerContentForSingleYear",defaultMessage:"Your referral link earned you {discount} off a year of Plus.",values:{discount:l}}):e.jsx(E,{id:"referrerRedemptionBannerContentForPluralYears",defaultMessage:"Your referral link earned you {discount} off {num_years} years of Plus.",values:{discount:l,num_years:i}})),u}const pn=window.sessionStorage,fn=km(Rm(()=>({memoryFullBannerDismissed:!!pn?.getItem(kt.MemoryFullBannerDismissed)}))),Ji={dismissBanner(){fn.setState(t=>{t.memoryFullBannerDismissed=!0}),pn?.setItem(kt.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){fn.setState(t=>{t.memoryFullBannerDismissed=!1}),pn?.removeItem(kt.MemoryFullBannerDismissed)}};function vf(t){const s=Oi(t),n=wc(),{data:o}=_c(s,!1,n),a=o!=null,r=a&&o.memoryFullPct>=100,[i,d]=f.useState(!1);f.useEffect(()=>{!r&&a&&(d(!0),Ji.clearDismissedBanner())},[r,a]);const l=fn(u=>u.memoryFullBannerDismissed);return r&&i&&!l}function wf(){const t=K(),{openSettings:s}=jc();return e.jsx(Z.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(En,{title:t.formatMessage(ds.memoryFullTitle),content:t.formatMessage(ds.memoryFullTooltip,ds.memoryFullTooltip.values),primaryCtaText:t.formatMessage(ds.memoryManageButton),onPrimaryCtaClick:()=>s(kc.Personalization),onDismiss:()=>Ji.dismissBanner()})})}const ds=Fe({memoryFullTitle:{id:"i1hV1R",defaultMessage:"ChatGPT's out of space for saved memories"},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"Rs+Att",defaultMessage:"New memories wonâ€™t be added until you make space. <a>Learn more</a>",values:{a:t=>e.jsx("a",{href:Rc,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}}),_f=$n(()=>Qn(()=>import("./fpmhxpwspnbqkta7.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.JawboneNotificationsBanner)),Zi=f.memo(function({className:s}){const{store:n}=Ce(),o=n.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:q(s??"absolute start-0 end-0 bottom-full",Mc.PromptTextareaHeader),children:e.jsx(Ac,{shouldRender:o,contentArea:Ut.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(jf,{}),e.jsx(kf,{})]})})})});function jf(){const{store:t}=Ce(),s=t.useSharedProps(d=>d?.clientThreadId),n=t.useContentAreaId(Ut.HeaderTop),o=Ec(),a=le(s,d=>d?.modelId),r=Pc.useStore();let i;switch(n){case B.ProjectConversationTaskNoFileAccess:i=e.jsx(Ef,{});break;case B.AdvancedVoiceOnMobileAnnouncement:i=e.jsx(Kc,{clientThreadId:s});break;case B.S09KM1:i=null;break;case B.TeamsCreditRequest:i=null;break;case B.BannerSignup:i=e.jsx(Mf,{});break;case B.BannerTermsDisclaimer:i=e.jsx(Pf,{});break;case B.PromptTextareaAction:i=e.jsx(Tf,{});break;case B.BannersRateLimit:i=e.jsx(Nf,{});break;case B.BannerSidekickAnnouncement:i=e.jsx(Yc,{});break;case B.SearchBrowserExtensionAnnouncement:i=e.jsx(qc,{});break;case B.MoonshineAnnouncement:i=e.jsx(Vc,{});break;case B.CustomizeChatGPTAnnouncement:i=e.jsx(Wc,{});break;case B.SearchBrowserExtensionReactiveAnnouncement:i=e.jsx(zc,{});break;case B.BannerMemoryFull:i=e.jsx(wf,{});break;case B.Box:i=e.jsxs("div",{id:"Box",className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;case B.JawboneAnnouncement:o?i=e.jsx(_f,{}):i=null;break;case B.JawboneMaxActiveAnnouncement:o?i=e.jsx(Gc,{}):i=null;break;case B.PromoRedemptionAnnouncement:i=e.jsx(ep,{});break;case B.OperatorAnnouncement:i=e.jsx(Uc,{});break;case B.BannerPlusUpsell:i=e.jsx(Hc,{});break;case B.ContextualAnswersAdminUpsell:i=e.jsx(Fc,{});break;case B.ContextualAnswersUserUpsell:i=e.jsx(Lc,{});break;case B.ReferrerRedemptionAvailableAnnouncement:i=e.jsx(bf,{});break;case B.RefereeRedemptionAvailableAnnouncement:i=e.jsx(Dc,{});break;case B.ReferralProgramUpsellAnnouncement:i=e.jsx(Oc,{});break;case B.StudentsUpsellAnnouncement:i=e.jsx(Ic,{});break;case B.ModelDeprecationBanner:i=Bc(a);break;case B.TeamsContextualAnswersUpsell:i=e.jsx(Nc,{});break;case B.KanziConfig:i=!1;break;case B.LanguageUpsellBanner:i=e.jsx(Tc,{onDismissSideEffect:()=>{T.logEventWithStatsig("Language Upsell Banner Dismissed","chatgpt_web_language_upsell_banner_dismissed"),r.closeBanner()},onPrimaryCtaClickSideEffect:()=>{T.logEventWithStatsig("Language Upsell Banner Primary CTA Clicked","chatgpt_web_language_upsell_banner_primary_cta_clicked"),r.closeBanner()}});break;default:i=null;break}return i}function kf(){const{store:t}=Ce(),s=t.useContentAreaId(Ut.HeaderBottom);let n;switch(s){case si.DallePromptControls:n=e.jsx(Af,{});break;default:n=null;break}return n}const Rf=$n(()=>Qn(()=>import("./by4q541t555nr8o0.js"),__vite__mapDeps([7,1,2,3,4,5])).then(t=>t.default));function Af(){const{store:t}=Ce(),s=t.useSharedProps(n=>n?.composerController);return s?e.jsx(Rf,{composerController:s}):null}function Mf(){const{store:t}=Ce(),s=t.useSharedProps(a=>a?.clientThreadId),n=xn(),o=$c();return s?n?e.jsx(Qc,{threadId:s,showSignUp:o}):e.jsx(Xc,{threadId:s,showLogin:o}):null}function Ef(){return f.useEffect(()=>()=>{en.getItem(kt.TasksHasSeenProjectDisclaimerBanner)||en.setItem(kt.TasksHasSeenProjectDisclaimerBanner,!0)},[]),e.jsx(En,{icon:e.jsx(qt,{}),title:e.jsx(E,{id:"ibX3g7",defaultMessage:"Tasks canâ€™t access project files"}),content:e.jsx(E,{id:"fm94Tm",defaultMessage:"Thereâ€™s a task in this conversation â€” just FYI, it wonâ€™t be able to access project files."}),onDismiss:()=>{en.setItem(kt.TasksHasSeenProjectDisclaimerBanner,!0)}})}function Pf(){const{store:t}=Ce(),s=t.useSharedProps(n=>n?.clientThreadId);return s?e.jsx(Jc,{threadId:s}):null}function Tf(){const{store:t}=Ce(),s=t.useSharedProps();return s?e.jsx(mf,{...s}):null}function Nf(){const{store:t}=Ce(),s=t.useSharedProps(o=>o?.clientThreadId),n=t.useSharedProps(o=>o?.composerController);return!s||!n?null:e.jsx(gf,{clientThreadId:s,composerController:n})}const Bf=5,If=f.memo(function(s){return Of(s),Df(s),Lf(),null});function Of(t){const{store:s}=Ce(),n=s.useSetSharedProps();mn(()=>{n(t)},[t,n])}function Df(t){const{clientThreadId:s,canContinue:n}=t,{store:o}=Ce(),a=f.useRef({top:o.useContentAreaApi(Ut.HeaderTop),bottom:o.useContentAreaApi(Ut.HeaderBottom)}).current,r=Zc(s),{shouldShowBannerSignup:i,shouldShowBannerTermsDisclaimer:d}=Ff(s),l=Sf(s,t.composerController),u=eu(t),m=tu(t),c=Qa(),p=su(),x=nu(t),g=vf(s),h=ou(t),S=au(s),y=iu(s),v=tp(),{eligible:_}=Le(ru),P=lu(),R=cu(),M=uu(),w=du(),j=mu(s),N=pu(s),D=fu(),F=gu(s),z=hu(s),b=xu(s),I=le(s,k=>k?.modelId),G=js(s),W=ni();mn(()=>{I&&G?.kind===Oe.GizmoInteraction&&G.gizmo&&Su(I,G.gizmo)?a.top.set(B.ProjectConversationTaskNoFileAccess):h.eligible?a.top.set(B.AdvancedVoiceOnMobileAnnouncement):d?a.top.set(B.BannerTermsDisclaimer):l?a.top.set(B.BannersRateLimit):D?a.top.set(B.BannerPlusUpsell):F?a.top.set(B.ContextualAnswersAdminUpsell):z?a.top.set(B.ContextualAnswersUserUpsell):S?a.top.set(B.JawboneAnnouncement):y?a.top.set(B.JawboneMaxActiveAnnouncement):u.eligible?a.top.set(B.BannerSidekickAnnouncement):c?a.top.set(B.MoonshineAnnouncement):p?a.top.set(B.CustomizeChatGPTAnnouncement):m?a.top.set(B.SearchBrowserExtensionAnnouncement):x?a.top.set(B.SearchBrowserExtensionReactiveAnnouncement):v?a.top.set(B.PromoRedemptionAnnouncement):_?a.top.set(B.OperatorAnnouncement):M?a.top.set(B.ReferralProgramUpsellAnnouncement):n?a.top.set(B.PromptTextareaAction):i?a.top.set(B.BannerSignup):g?a.top.set(B.BannerMemoryFull):P?a.top.set(B.ReferrerRedemptionAvailableAnnouncement):R?a.top.set(B.RefereeRedemptionAvailableAnnouncement):w?a.top.set(B.StudentsUpsellAnnouncement):j?a.top.set(B.ModelDeprecationBanner):N?a.top.set(B.TeamsContextualAnswersUpsell):b?a.top.set(B.LanguageUpsellBanner):a.top.set(null)},[a,W,n,d,i,l,u,g,h]),mn(()=>{r&&a.bottom.set(si.DallePromptControls)},[a,r])}function Lf(){const{store:t}=Ce();f.useEffect(()=>()=>{t.reset()},[t])}function Ff(t){const{isUnauthenticated:s}=Te(),{layer:n}=Ye("3637408529",{shouldLogExposure:!1}),{layer:o}=Ye("3637408529"),a=o.get("no_auth_banner_signup_rate_limit",Bf),r=n.get("should_show_no_auth_signup_banner",!0),i=bu(c=>c.bannerDisclaimerClientThreadId),d=Cu(),l={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1},[u,m]=le(t,c=>[te.getConversationTurns(c).filter(p=>p.role===Di.User).length,Hf(te.getCurrentNode(c)?.message)]);return t&&(l.shouldShowBannerTermsDisclaimer=m&&s&&u===1&&!d&&(i==null||i===t),l.shouldShowBannerSignup=r&&m&&s&&u>0&&u%a===0),l}function Hf(t){return t?.author.role===Di.Assistant&&Am(t)}function er({clientThreadId:t,getInputProps:s,openFileDialog:n,uploadType:o,icon:a,isDisabled:r=!1,isSmall:i=!1,showLabel:d=!1,showUpsell:l=!1,hideBorder:u=!1,highlightTooltip:m=!1,disabledReason:c,currentModelName:p,visualTreatment:x}){const g=K(),h=Rs();r=(r||!!h)&&!l;const S=e.jsxs(yu,{disabled:r,$showLabel:d,$hideBorder:u,$isSmall:i,$visualTreatment:x,onClick:_=>{if(_.preventDefault(),l){T.logNoAuthAttachButtonClicked({location:"No auth upsell"});return}T.logEvent("Open File Viewer",{intent:o.toString()}),n()},"aria-label":r?c===wt.ModelNotSupported?g.formatMessage({id:"pEB4vw",defaultMessage:"Attachments disabled for {modelName}"},{modelName:`${p}`}):c===wt.ThinkModeInUse?g.formatMessage({id:"NRk4QL",defaultMessage:"Attachments disabled for Reason mode"}):c===wt.SearchModeInUse?g.formatMessage({id:"YlO80p",defaultMessage:"Attachments disabled for Search mode"}):g.formatMessage({id:"PromptFilePicker.attachFilesUnavailable",defaultMessage:"Attach files is unavailable"}):g.formatMessage({id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"}),children:[a,d&&e.jsx(oi,{})]}),y=e.jsx("input",{disabled:r,...s({className:"hidden"})}),v=e.jsxs("div",{className:"flex",children:[S,y]});return l?e.jsx(Vt,{label:e.jsx(E,{id:"wkpQmi",defaultMessage:"Upload files and more"}),side:"bottom",open:m||void 0,children:e.jsx(vu,{triggerButton:v,sideOffset:0,alignOffset:0,children:e.jsx(Cn,{location:"attach",statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked"})})}):e.jsx(Vi,{disabled:r,clientThreadId:t,rateLimitPopup:h,highlightTooltip:m,children:v})}function Uf({code:t,message:s}){switch(t){case ca.FileTooLarge:return Ta.errorFileTooLarge;case ca.TooManyFiles:return T.logEvent("Uploaded Max Files Error"),Ta.errorTooManyFiles;default:return s}}const Ta=Fe({attachImages:{id:"PromptFilePicker.attachImages",defaultMessage:"Attach images"},attachFiles:{id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"},errorFileTooLarge:{id:"PromptFilePicker.errorFileTooLarge",defaultMessage:"Your file is too large. The maximum file size is {size}MB."},errorTooManyFiles:{id:"PromptFilePicker.errorTooManyFiles",defaultMessage:"You may only upload {maxNum} files at a time."},defaultFileUploadRateLimited:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"}}),Na=Fe({dragInstructions:{id:"FileDropZone.dragInstructions",defaultMessage:"Add anything"},dragAllAccepted:{id:"FileDropZone.dragAllAccepted",defaultMessage:"Drop any file here to add it to the conversation"}});function Gf(t){if(!t.accept||Object.keys(t.accept).length===0)return[];const s=[];return Object.values(t.accept).forEach(n=>s.push(...n)),s.sort()}function Xg(t){const{className:s,children:n,clientThreadId:o,currentModelConfig:a,noKeyboard:r}=t,i=K(),d=$e(),l=js(o),u=Wt(),m=gs(a,l,u),c=m!==it.None,p=rn(M=>M.files),x=(m===it.Multimodal?Tn:Nn)-p.length,g=x<=0,{getGizmoId:h}=Bn(),{handleFileAccepted:S}=io(i,m,On(a,l),"drag",h,In(a,l)?.attachments),y=Rs(),v=Dn(Ln(a,l)),{getRootProps:_,isDragActive:P}=no({maxFiles:x,disabled:!c||g||y!=null,noClick:!0,noKeyboard:r,onDropAccepted:S,onDropRejected:M=>ao(M,i,d,m),multiple:!0,maxSize:Fn,...v}),R=Gf(v);return e.jsxs("div",{..._({className:s}),children:[n,P&&e.jsxs(zf,{children:[e.jsx(ju,{}),e.jsx("h3",{children:e.jsx(E,{...Na.dragInstructions})}),e.jsx("h4",{className:"w-2/3 text-center",children:R.length>0?R.join(", "):e.jsx(E,{...Na.dragAllAccepted})})]})]})}function ao(t,s,n,o){const{errors:a}=t[0];a.forEach(r=>{const i=Uf(r);typeof i=="string"?n.danger(i,{hasCloseButton:!0}):n.danger(s.formatMessage(i,{size:_u,maxNum:o===it.Multimodal?Tn:Nn}),{hasCloseButton:!0})})}function io(t,s,n,o,a,r){const i=Ke(),d=Li(i).flags,l=$e(),u=Pn(),m=ai(),{isUnauthenticated:c}=Te(),p=d?.includes(bs.NoAuthEnableFileUploads);return{handleFileAccepted:f.useCallback(async(g,h)=>{T.logEvent("Upload File",{client:"web",eventSource:o,intent:s.toString()}),m.fileUploadAccepted();const S=a!=null?await a():void 0;g.length>0&&g.forEach(y=>{ms.uploadFile(u,wu(y),y,s,n,t,l,{gizmoId:S,...p&&{isUnauthenticated:c}},r)})},[o,s,a,u,m,n,t,l,r,p,c])}}const zf=qn.div`absolute z-50 inset-0 flex gap-2 flex-col justify-center items-center after:contents-[""] after:absolute after:opacity-80 after:z-[-1] after:bg-token-main-surface-primary after:inset-0`,tr=t=>{const s=[];s.push({category:null,systemHints:t.filter(n=>!n.category)});for(const n of Em)s.push({category:n,systemHints:t.filter(o=>o.category===n)});return s};function sr({composerController:t,clientThreadId:s,onHintSelected:n}){const o=Fi(s),[a]=le(s,I=>[I?.modelId]),{data:r}=$t(),i=a??ku(void 0).id,d=ii(r?.models,i),{configurationMenuType:l}=He(),{setThreadSystemHintMode:u,clearAllSystemHintModeTriggers:m}=fe(),{viewableSystemHints:c,persistedSystemHints:p}=qe.useState(({availableHints:I,persistedSystemHints:G})=>({viewableSystemHints:I,persistedSystemHints:G})),[x,g]=f.useState([]),[h,S]=f.useState(void 0),[y,v]=f.useState(0);f.useEffect(()=>{if(!h)g([]);else{const I=h.text.toLocaleLowerCase(),G=c.filter(k=>{const U=k.name.toLocaleLowerCase().startsWith(I),Y=k.systemHint.toLocaleLowerCase().startsWith(I);let L=!1;return k.regexMatches&&k.regexMatches.length>0&&(L=k.regexMatches.some(Q=>Q.replace(/[\^\$\(\)]/g,"").toLocaleLowerCase().startsWith(I))),U||Y||L}).filter(k=>k.requiredFeatures.every(U=>d?.enabledTools?.includes(U))),W=tr(G).map(k=>k.systemHints).flat();g(W)}},[h]),f.useEffect(()=>{t.view.dispatch(mp(t.view.state.tr,{onHintMatch(I){S(G=>Mm(G,I)?G:I)}}))},[t]);const _=!c.length||!x.length||!h;f.useEffect(()=>{v(0)},[_]);const P=x.length,R=f.useCallback(I=>{v(G=>(I(G)%P+P)%P)},[P]),M=f.useCallback(()=>{v(-1)},[]),w=x[y],j=f.useCallback(()=>{h?.range&&t.delete(h.range.from,h.range.to)},[h,t]),N=({hintToSave:I=w,expectPerfectMatch:G})=>{if(!h||!w||G&&I.name.toLowerCase()!==h.text.toLowerCase())return!1;T.logEvent("System Hint Selected",{system_hint:I.systemHint,conversation_id:o??dn});const W=h.range.from===1?I.name:h.text+I.name.slice(h.text.length),k={clientThreadId:s};us(t.view),p.size>0&&m();const U=!!I.composerBarButtonInfo,Y=I.systemHint===A.Search;return U||Y||l!=="none"?(u(I.systemHint,!0,k,Y?Ru.CONVERSATION_COMPOSER_SLASH_SEARCH:void 0),j(),t.removeSystemHints(),!0):(t.addSystemHint(I.systemHint,W,h.range.from,h.range.to),!0)},D=f.useRef(N);D.current=N;const F=f.useRef(R);F.current=R;const z=f.useRef(h);z.current=h;const b=t.view;return f.useEffect(()=>(_||pp(b,I=>{if(I==="up")F.current(G=>G-1);else if(I==="down")F.current(G=>G+1);else if(I==="cancel")us(b),fp(b);else if(I==="submit")if(n)j(),n(w.systemHint);else return us(b),D.current({expectPerfectMatch:!1});else if(I==="checkMatch")return D.current({expectPerfectMatch:!0})}),()=>us(b)),[_,b,w,n,j]),f.useEffect(()=>{_||T.logEvent("System Hint List Opened",{conversation_id:o??dn})},[_]),{suggestorClosed:_,systemHintSuggestions:x,hintMatch:h,selectedIndex:y,resetSelectedIndex:M,setSelectedIndex:v,saveHint:N}}function Wf({composerController:t,clientThreadId:s}){const{selectedIndex:n,systemHintSuggestions:o,suggestorClosed:a,setSelectedIndex:r,saveHint:i}=sr({composerController:t,clientThreadId:s});return a?null:e.jsx(Au,{className:"max-w-60",onMouseDown:d=>{d.preventDefault()},children:o.map((d,l)=>e.jsx("div",{onMouseOver:()=>r(l),onClick:()=>{i({hintToSave:d,expectPerfectMatch:!1}),t.focus()},children:e.jsx(Mu,{autoFocus:!1,className:"rounded-lg px-1 py-2",highlighted:l===n,children:e.jsx(nr,{title:d.name,description:d.description,logo:d.logo})})},d.systemHint))})}function nr({title:t,description:s,logo:n,checked:o,badge:a}){const r=K();return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-2 ps-1.5 pe-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:e.jsx(Kt,{svgString:n,className:"icon-lg text-token-text-secondary"})}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsxs("p",{className:"text-token-text-primary text-sm leading-tight font-normal",children:[t,a&&e.jsx("span",{className:"ms-2 rounded-full bg-blue-400 px-2 py-0.5 text-xs text-white","aria-label":r.formatMessage({id:"I75WNJ",defaultMessage:"Create image updated"}),children:e.jsx(E,{id:"uUmZQi",defaultMessage:"Updated"})})]}),!!s&&e.jsx("p",{className:"text-token-text-secondary text-[13px] leading-[18px] font-normal",children:s})]}),o&&e.jsx(Eu,{className:q("icon-md text-token-text-primary",{"group-hover:hidden":!o})})]})}function Ba({composerController:t,clientThreadId:s}){return t instanceof gp?e.jsx(Wf,{composerController:t,clientThreadId:s}):null}function or({children:t,className:s,showBackground:n,showGlowingBorder:o}){return e.jsxs("div",{className:q("relative",o&&"overflow-clip rounded-full p-0.5"),children:[t,o&&e.jsx("div",{className:"border-glowing-gradient"}),n&&e.jsx(Z.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:q("pointer-events-none absolute inset-0 rounded-full",s)})]})}const Vf=({showUnconnectedInSubmenu:t,unconnectedConnectors:s,handleOauthRedirect:n,handleConnectorClick:o,showOneDriveInSubmenu:a,isConnectorConfigLoading:r,connectedConnectors:i,desktopConnectors:d,modelSupportedImageMimeTypes:l,showMenuForNoAuth:u,handleLocalFileUploadClick:m,unconnectedOneDriveConnectors:c})=>{const[p,x]=f.useState("main"),g=p!=="main",h=K(),S=f.useRef(null),y=Hn();return f.useEffect(()=>{g?document.getElementById("vanguard-file-picker-popover-submenu-back-button")?.focus():S.current&&S.current.focus()},[g]),e.jsx("div",{className:q("max-h-[max(calc(var(--radix-popover-content-available-height)-64px), 215px)] flex flex-1 snap-y snap-proximity flex-col overflow-y-auto scroll-smooth py-2 [scrollbar-gutter:stable] focus-visible:rounded-[inherit] focus-visible:-outline-offset-1"),ref:S,tabIndex:0,children:e.jsxs(dt,{mode:"wait",children:[e.jsx(Z.div,{className:"flex flex-col",transition:y?Gt:fs,children:p==="main"&&e.jsx(qf,{showUnconnectedInSubmenu:t,unconnectedConnectors:s,setActiveMenu:x,handleConnectorClick:o,showOneDriveInSubmenu:a,isConnectorConfigLoading:r,connectedConnectors:i,desktopConnectors:d,modelSupportedImageMimeTypes:l,showMenuForNoAuth:u,handleLocalFileUploadClick:m})},"main"),g&&e.jsxs(Z.div,{initial:{clipPath:"inset(0 100% 0 0)",opacity:0},animate:{clipPath:"inset(0 0% 0 0)",opacity:1},transition:y?Gt:fs,className:"flex flex-col",children:[e.jsxs("div",{className:"border-token-border-xlight bg-token-main-surface-primary dark:bg-token-main-surface-secondary sticky start-0 top-0 z-10 flex w-full flex-row items-center justify-center overflow-clip border-b px-3 py-3",children:[e.jsx("button",{onClick:()=>x("main"),id:"vanguard-file-picker-popover-submenu-back-button",className:"hover:bg-token-main-surface-tertiary flex items-center rounded-md p-1",children:e.jsx(Xa,{className:"text-token-text-secondary h-5 w-5","aria-label":""})}),e.jsx("div",{className:"flex-auto text-center text-sm font-medium",children:h.formatMessage({id:"LlLQYj",defaultMessage:"Back"})}),e.jsx("div",{className:"w-5"})]}),e.jsxs("div",{className:"flex w-full flex-col py-2",children:[p==="connect-apps"&&e.jsx(Pu,{connectorEntries:s,onOauthRedirect:n}),p==="one-drive"&&e.jsx(Tu,{connectorEntries:c,onOauthRedirect:n})]})]},p)]})})};function qf({showUnconnectedInSubmenu:t,unconnectedConnectors:s,showOneDriveInSubmenu:n,setActiveMenu:o,handleConnectorClick:a,isConnectorConfigLoading:r,connectedConnectors:i,desktopConnectors:d,modelSupportedImageMimeTypes:l,showMenuForNoAuth:u,handleLocalFileUploadClick:m}){const c=K();return e.jsxs(e.Fragment,{children:[t&&s.length>0&&e.jsx(ut,{label:c.formatMessage(Ia.connectApps),icon:kn,isSubMenuTrigger:!0,onClick:()=>o("connect-apps")},"connect-apps-submenu-trigger"),!t&&s.map(p=>e.jsx(hs,{entry:p,onClick:()=>a(p),visualTreatment:"vanguard"},p.id)),n&&e.jsx(ut,{label:c.formatMessage(Ia.oneDriveSubmenuName),icon:Nu,isSubMenuTrigger:!0,onClick:()=>o("one-drive")},"one-drive-submenu-trigger"),r&&e.jsx(ut,{icon:e.jsx(Yt,{className:"text-token-text-secondary"})}),(s.length>0||r)&&e.jsx(Ja,{}),i.map(p=>e.jsx(hs,{entry:p,onClick:()=>a(p),visualTreatment:"vanguard"},p.id)),d.map(p=>e.jsx(ri,{entry:p,visualTreatment:"vanguard"},p.key)),e.jsx(li,{modelSupportedImageMimeTypes:l}),e.jsx(ci,{handleLocalFileUploadClick:m,showMenuForNoAuth:u})]})}const Ia=Fe({connectApps:{id:"ContextConnectorPicker.connectApps",defaultMessage:"Connect apps"},oneDriveSubmenuName:{id:"ContextConnectorPickerOneDriveSubmenu.oneDriveSubmenuName",defaultMessage:"Connect to Microsoft OneDrive"}}),Yf=({layoutMode:t,triggerButton:s,restoreFocus:n,...o})=>e.jsxs(eo,{layoutMode:t,restoreFocus:n,children:[s,e.jsx(to,{align:"start",children:e.jsx(Vf,{...o})})]});function Kf(){const{connectorConfig:t}=ui(),s=Un(),n=Gn(),[o,a]=xs(di([...t.values()],m=>!!m.access_token),m=>!!m.access_token),[r,i]=xs(a,m=>m.type===Ve.O365_PERSONAL||m.type===Ve.O365_BUSINESS),d=!s&&!n&&o.length>0,l=!s&&!n&&!d&&r.length>1;return{unconnectedConnectors:n?[]:l?i:a,showUnconnectedInSubmenu:d,showOneDriveInSubmenu:l}}function ar({clientThreadId:t,icon:s,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:o,attachmentsProductFeature:a,onOauthRedirect:r,uploadType:i,getInputProps:d,openFileDialog:l,isDisabled:u=!1,highlightTooltip:m=!1,showLabel:c,isSmall:p=!1,hideBorder:x=!1,disabledReason:g,currentModelName:h,visualTreatment:S="vanguard",showMenuForNoAuth:y=!1,showGlowingBorder:v=!1,layoutMode:_="centered",restoreFocus:P}){const R=Pm().locale,M=K(),w=$e(),j=Pn(),N=Rs(),{connectorConfig:D,isLoading:F}=ui(),z=Le(pe.ContextConnectors),{getGizmoId:b}=Bn(),{value:I}=oe("58345806"),{configurationMenuType:G}=He(),W=G!=="none",k=I&&S==="vanguard",[U,Y]=f.useState();f.useEffect(()=>{b?b().then(O=>Y(O)):Y(void 0)},[b]);const L=f.useRef(null),[Q,ie]=f.useState(!1),ye=f.useRef(!1),Ue=f.useCallback(()=>{const O=L.current?.files;Array.from(O??[]).forEach(de=>Dt.uploadFile(j,de,o,M,w,a))},[j,o,M,w,a]),[mt,Ne]=f.useState(null),Qe=f.useCallback(()=>Ne(null),[Ne]),Xe=f.useCallback((O,de)=>Dt.uploadPickedFile(j,O,de,o,n,a,U,M,w),[j,o,n,a,U,M,w]),{openMenu:ve,confirmMenuOpened:we}=Bu();f.useEffect(()=>{ve&&(ie(!0),we())},[ve,we,ie]);const _e=f.useCallback(O=>{Dt.doContextConnectorOauthRedirect(location.pathname+location.search+location.hash,O,r,va.Picker),r()},[r]),Je=f.useCallback(O=>{Dt.uploadPickedFile(j,O,Ve.GDRIVE,o,n,a,U,M,w)},[j,o,n,a,U,M,w]),ge=f.useCallback(async O=>{const{access_token:de}=O;if(!de){_e(O);return}switch(Dt.logAttemptIfAccessTokenIsExpired(O,va.Picker),O.type){case Ve.GDRIVE:Iu(R,O.type,de,gt=>gt.forEach(Je));break;case Ve.O365_PERSONAL:case Ve.O365_BUSINESS:Ne(O.type);break}},[Je,_e,Ne,R]),Be=()=>{T.logEvent("Open File Viewer",{intent:i.toString()}),l()},ae=O=>{if(!O&&ye.current&&!F)Be();else if(O&&Ae&&!F&&!y){Be();return}ie(O),O&&(z.eligible&&z.markAsViewed(),T.logEventWithStatsig("Composer: Open Context Connector Picker","chatgpt_composer_open_context_connector_picker"),ye.current=!0,setTimeout(()=>{ye.current=!1},250))},[je,pt]=xs(di([...D.values()],O=>!!O.access_token),O=>!!O.access_token);$f(je,ge);const[Ze]=xs(pt,O=>O.type===Ve.O365_PERSONAL||O.type===Ve.O365_BUSINESS),{unconnectedConnectors:ce,showUnconnectedInSubmenu:ke,showOneDriveInSubmenu:ne}=Kf(),{desktopConnectors:Re}=Ou(o),Ae=!je.length&&!ce.length&&!Re.length,Et=e.jsxs(e.Fragment,{children:[ke&&ce.length>0&&e.jsx(Du,{connectorEntries:ce,onOauthRedirect:O=>_e(O)}),!ke&&ce.map(O=>e.jsx(hs,{entry:O,onClick:()=>ge(O)},O.id)),ne&&e.jsx(Lu,{connectors:Ze,onOauthRedirect:_e}),F&&e.jsx(H.Item,{icon:e.jsx(Yt,{className:"text-token-text-secondary"})}),(ce.length>0||F)&&e.jsx(H.Separator,{}),je.map(O=>e.jsx(hs,{entry:O,onClick:()=>ge(O)},O.id)),Re.map(O=>e.jsx(ri,{entry:O},O.key)),e.jsx(li,{modelSupportedImageMimeTypes:o}),e.jsx(ci,{handleLocalFileUploadClick:Be,showMenuForNoAuth:y})]}),ue=u||N!=null,ft=f.useRef(!1);let Me;W?Me=e.jsx(Vi,{clientThreadId:t,rateLimitPopup:N,highlightTooltip:m,disabled:ue,disabledReason:g,currentModelName:h,children:e.jsxs(H.BasicTrigger,{className:"composer-btn",disabled:ue,id:"upload-file-btn","aria-label":rp(M,ue,g,h),children:[s,c&&e.jsx(oi,{})]})}):k?Me=e.jsx(lp,{clientThreadId:t,icon:s,isDisabled:ue,highlightTooltip:m,showLabel:c,hideBorder:x,isSmall:p,disabledReason:g,currentModelName:h,visualTreatment:S,isLoading:F,handleLocalFileUploadClick:Be,noAvailableConnectors:Ae,showMenuForNoAuth:y,announcement:z,rateLimit:N}):Me=e.jsx(cp,{clientThreadId:t,icon:s,setOpen:ae,open:Q,isDisabled:ue,highlightTooltip:m,showLabel:c,hideBorder:x,isSmall:p,disabledReason:g,currentModelName:h,visualTreatment:S,showGlowingBorder:v,rateLimit:N});const et=k?e.jsx(Yf,{layoutMode:_,triggerButton:Me,showUnconnectedInSubmenu:ke,unconnectedConnectors:ce,handleOauthRedirect:_e,handleConnectorClick:ge,showOneDriveInSubmenu:ne,isConnectorConfigLoading:F,connectedConnectors:je,desktopConnectors:Re,modelSupportedImageMimeTypes:o,showMenuForNoAuth:y,handleLocalFileUploadClick:Be,unconnectedOneDriveConnectors:Ze,restoreFocus:P}):e.jsxs(H.Root,{open:Q,onOpenChange:ae,children:[Me,e.jsx(H.Portal,{children:e.jsx(H.Content,{alignOffset:-8,onEscapeKeyDown:()=>{ft.current=!0},side:W?"bottom":"top",size:"small",onCloseAutoFocus:O=>{ft.current||O.preventDefault()},className:"radix-side-bottom:flex-col-reverse flex flex-col",children:Et})})]});return e.jsxs("div",{className:"flex flex-col",children:[e.jsx(Fu,{type:mt,onClose:Qe,uploadPickedFile:Xe}),e.jsx("input",{onChange:Ue,...d({className:"hidden"})}),et,e.jsx(Hu,{hasConnectors:!F&&!Ae})]})}function $f(t,s){const{connector:n,clearParam:o}=Uu(),a=t.find(r=>r.type===n&&!!r.access_token);f.useEffect(()=>{a&&(s(a),o())},[a,s,o])}function Qf({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:o,attachmentsProductFeature:a,getInputProps:r,openFileDialog:i,onOauthRedirect:d,historyDisabled:l,isDisabled:u,highlightTooltip:m,disabledReason:c,currentModelName:p,showLabel:x,showUpsell:g,hideBorder:h,isSmall:S,showMenuForNoAuth:y,visualTreatment:v,showGlowingBorder:_}){const P=Gn(),{gdriveStatus:R,o365Status:M}=mi(),{isUnauthenticated:w}=Te(),j=l?"text-white":m?"text-brand-blue-800":"",N=!g&&(y||R!=="false"||M!=="false"||P),D=w?ln:Gu,F=e.jsx(D,{"aria-label":"",className:q("icon-md",j)}),z=N?e.jsx(ar,{showGlowingBorder:_,hideBorder:h,isSmall:S,clientThreadId:t,icon:F,showLabel:w&&x,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:o,attachmentsProductFeature:a,onOauthRedirect:d,uploadType:s,openFileDialog:i,getInputProps:r,isDisabled:u,highlightTooltip:m,disabledReason:c,currentModelName:p,showMenuForNoAuth:y,visualTreatment:v}):e.jsx(er,{isSmall:S,hideBorder:h,clientThreadId:t,uploadType:s,openFileDialog:i,getInputProps:r,showLabel:x,showUpsell:g,icon:F,isDisabled:u,highlightTooltip:m,disabledReason:c,currentModelName:p,visualTreatment:v});return e.jsx(or,{showBackground:m,showGlowingBorder:_,className:"bg-brand-blue-800/20",children:z})}const Xf=f.forwardRef(function({type:s,placeholder:n,replyRegions:o,state:a,renderFiles:r,leftSideActions:i,topRightAction:d,onSubmit:l,setIsComposerOverflowing:u,inputState:m,composerController:c,clientThreadId:p,gizmoId:x,disableReason:g,matchaData:h},S){const y=zu();let v=null;const{isLoading:_}=y;_||(v=y.modelId),f.useEffect(()=>{_||Wu()||c.focus()},[v,c,_]);const{value:P}=oe("3780975974"),{state:R,shouldShowResearchText:M}=Ss(p),w=f.useCallback(()=>e.jsx(pi,{useStartButtonText:R==="clarify"||!1,inputState:m,state:a,onSubmit:l,composerController:c,clientThreadId:p,gizmoId:x,disableReason:g}),[m,a,l,c,p,x,g,h,R]),{whisperControls:j,waveContainerRef:N}=qi({composerController:c,renderInComposer:w,composerType:"legacy"}),{controlsDisabled:D,waveformData:F,waveWidth:z}=rt(c.store),{getShowUpsellReason:b}=fi(),I=P||b(),G=W=>{Jf({target:W.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||c.focus()};return e.jsx(Vu,{id:"composer-background",ref:S,className:q("border-token-border-default flex w-full cursor-text flex-col overflow-clip rounded-t-3xl border-t duration-150 ease-in-out contain-inline-size motion-safe:transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow,bottom] dark:border-none dark:shadow-none",s!=="temporary"&&"shadow-[0_9px_9px_0px_rgba(0,0,0,0.01),_0_2px_5px_0px_rgba(0,0,0,0.06)] has-focus:shadow-[0_2px_12px_0px_rgba(0,0,0,0.04),0_9px_9px_0px_rgba(0,0,0,0.01),0_2px_5px_0px_rgba(0,0,0,0.06)]",s!=="temporary"&&"bg-token-main-surface-primary dark:bg-[#303030]",s==="temporary"&&"dark bg-[#303030]","rounded-b-3xl border-b"),onClick:G,style:{viewTransitionName:"var(--vt-composer)"},children:e.jsxs("div",{className:"px-3 py-1",children:[e.jsx(dt,{initial:!1,children:o.length>0&&e.jsx(Z.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:e.jsx("div",{className:"-mx-2",children:e.jsx(gi,{replyRegions:o})})})}),e.jsxs(e.Fragment,{children:[r,e.jsx(dt,{initial:!1,children:e.jsx(xp,{enabled:M,composerController:c,visualTreatment:"legacy",children:e.jsxs("div",{id:"composer-waveform-container",className:"flex min-h-[44px] items-start ps-1",ref:N,children:[e.jsx("div",{className:"max-w-full min-w-0 flex-1",children:D?F?e.jsx(qu,{waveform:F,containerWidth:z,scaleFactor:10,initialValue:Sp}):null:e.jsx(bp,{composerController:c,placeholder:n})}),e.jsx("div",{className:"w-[32px] pt-1",children:d})]})})}),e.jsxs("div",{className:"mt-1 mb-2 flex items-center justify-between sm:mt-5",ref:W=>{if(!I||!("ResizeObserver"in window))return;const k=new AbortController;let U=window.innerWidth;const Y=Yu({axis:"width",debounce:!0,target:W,onChange:()=>{if(!W)return;W.scrollWidth>W.clientWidth?u?.(!0):Math.abs(U-window.innerWidth)>40&&(u?.(!1),U=window.innerWidth)}});return()=>{Y?.(),k.abort()}},children:[e.jsx("div",{className:"text-token-text-primary flex gap-x-1.5",id:"composer-left-actions",children:i}),e.jsx("div",{className:"flex gap-x-1.5",id:"composer-voice-controls",children:j})]})]})]})})});function Jf({target:t,rootId:s,additonalInteractiveIds:n}){let o=t;for(;o&&o!=null;){if(o.tagName==="BUTTON"||o.tagName==="INPUT"||o.tagName==="TEXTAREA"||o.isContentEditable||n.includes(o.id))return!0;if(o.id===s)return!1;o=o.parentElement}return!1}const Zf=["o3-mini","o3-mini-high","o1-pro"],eg=[A.Search,A.Research],tg=5,sg=({composerController:t,clientThreadId:s,hideThinkButton:n,disableIfNoAccess:o,disabled:a})=>{const{prospectiveModelId:r}=_s(s),{systemHints:i,activeSystemHints:d,isLoading:l}=zn(s),u=oe("2868048419"),m=Ei(k=>k.bySystemHint(A.Research)),c=Kn(),p=Yn(),{value:x}=oe("1416952492"),g=De(k=>k.isVisuallyOverflowing),{showLegacyReasoningSlider:h,hideSearchInSystemHintOverflow:S,hideReasonInSystemHintOverflow:y,configurationMenuType:v}=He(),_=Mt()?.isFree(),P=v!=="none",R=d.filter(k=>P&&(_||k.systemHint!==A.Think)||S&&k.systemHint===A.Search||y&&k.systemHint===A.Think?!0:g&&h?k.systemHint!==A.Think&&!k.composerBarButtonInfo&&!eg.includes(k.systemHint):!k.composerBarButtonInfo&&k.systemHint!==A.Search&&(!u||k.systemHint!==A.PictureV2)&&(!n||k.systemHint!==A.Think));if(P&&_&&!R.find(k=>k.systemHint===A.Think)){const k=i.find(U=>U.systemHint===A.Think);k&&R.push(k)}const M=Wn(t),w=Ku(t,s),{clearAllSystemHintModeTriggers:j}=fe(),N=r&&Zf.includes(r),D=R.length===0&&!l||N;if(!o&&D)return null;const F={clientThreadId:s};function z(){T.logEventWithStatsig("Composer System Hint Button Hovered","composer_system_hint_button_hovered",F)}function b(){T.logEventWithStatsig("Composer System Hint Button Clicked","composer_system_hint_button_clicked",F)}const I=k=>{switch(k){case A.Research:return!!p;case A.Think:return!!c;default:return!1}},G=()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{t.focus()})})},W=P?og:ng;return e.jsx(W,{systemHints:R,selectedHint:M??void 0,disabled:a,onHover:z,onOpen:b,onSelect:w,clientThreadId:s,isDeepResearchHighLoad:x,getFeatureRateLimitIndicator:k=>{switch(k){case A.Research:return ag(m);case A.Think:return c?e.jsx(qt,{"aria-label":"",className:"icon-md text-token-text-secondary h-5 w-5"}):null;default:return null}},hasFeatureRateLimit:I,setRateLimitBannerFeature:k=>{switch(k){case A.Research:case A.Think:I(k)?(j(),t.setRateLimitBannerFeature(k===A.Research?wa.DEEP_RESEARCH:wa.REASON)):t.setRateLimitBannerFeature(null);break;default:t.setRateLimitBannerFeature(null);break}},restoreFocus:G})},ng=({systemHints:t,selectedHint:s,disabled:n,onHover:o,onOpen:a,onSelect:r,isDeepResearchHighLoad:i,hasFeatureRateLimit:d,restoreFocus:l})=>{const u=K(),[m,c]=f.useState(!1),p=t.find(S=>S.systemHint==="contextual_answers")?.name,x=f.useRef(!1);f.useEffect(()=>{if(!m)return()=>{requestAnimationFrame(()=>{x.current=!1})}},[m]);const g=f.useRef(!1),h=t.length===0?e.jsxs("div",{className:"mx-2 flex min-h-[40px] flex-col justify-center gap-2",children:[e.jsx("div",{className:"loading-results-shimmer bg-token-bg-tertiary h-9 w-[180px] rounded-md"}),e.jsx("div",{className:"loading-results-shimmer bg-token-bg-tertiary h-9 w-[180px] rounded-md"})]}):e.jsx(e.Fragment,{children:t.map(S=>e.jsx(H.Item,{className:"px-1 py-2",onClick:()=>{const y=S.systemHint!==s;d(S.systemHint)||(x.current=!0,r?.({hint:S,enable:y}))},disabled:S.systemHint===A.Research?i:void 0,children:e.jsx(nr,{title:S.name,description:S.description,logo:S.logo,checked:S.systemHint===s,badge:S.systemHint===A.PictureV2})},S.systemHint))});return e.jsxs(H.Root,{open:m,onOpenChange:S=>{c(S),S?a?.():requestAnimationFrame(()=>{requestAnimationFrame(()=>{x.current&&l()})})},children:[e.jsx(ir,{disabled:!!n,contextualAnswersHintNameIfPresent:p,children:e.jsx(hi,{className:"border-token-border-default text-token-text-secondary radix-state-open:bg-black/10 can-hover:hover:bg-tertiary flex h-9 min-w-9 items-center justify-center rounded-full border p-1 text-xs font-semibold focus-visible:outline-black disabled:opacity-30 dark:focus-visible:outline-white","data-opened":cn(m),"aria-label":u.formatMessage({id:"oDAnGy",defaultMessage:"Use a tool"}),id:"system-hint-button",disabled:n,onPointerOver:o,onClick:S=>{S.preventDefault()},onFocusCapture:S=>{S.stopPropagation()},children:e.jsx(Qu,{className:"pointer-events-none h-5 w-5"})})}),e.jsx(H.Portal,{children:e.jsx(H.Content,{size:"auto",alignOffset:-16,onEscapeKeyDown:()=>{g.current=!0},onCloseAutoFocus:S=>{if(!g.current||x.current){S.preventDefault();return}document.querySelector("#system-hint-button")?.focus()},children:h})})]})},og=({systemHints:t,selectedHint:s,disabled:n,onHover:o,onOpen:a,onSelect:r,clientThreadId:i,getFeatureRateLimitIndicator:d,isDeepResearchHighLoad:l,hasFeatureRateLimit:u,setRateLimitBannerFeature:m,restoreFocus:c})=>{const p=K(),[x,g]=f.useState(!1),h=t.find(w=>w.systemHint==="contextual_answers")?.name,{configurationMenuType:S}=He(),y=S==="config_icon"||S==="skills_icon",_=(S==="settings_icon"||S==="skills_icon")&&s==null,P=y?$u:xi,R=f.useRef(!1);f.useEffect(()=>{if(!x)return()=>{requestAnimationFrame(()=>{R.current=!1})}},[x]);const M=f.useRef(!1);return e.jsxs(H.Root,{open:x,onOpenChange:w=>{g(w),w?a?.():requestAnimationFrame(()=>{requestAnimationFrame(()=>{R.current&&c()})})},children:[e.jsx(ir,{disabled:!!n,contextualAnswersHintNameIfPresent:h,newToolsConfigMenu:S,skip:_,children:e.jsxs(hi,{className:"composer-btn","data-opened":cn(x),"data-pill":cn(_),"aria-label":y?p.formatMessage({id:"RiMXTh",defaultMessage:"Use a skill"}):p.formatMessage({id:"mJYhKI",defaultMessage:"Choose tool"}),id:"system-hint-button",disabled:n,onPointerOver:o,onClick:w=>{w.preventDefault()},onFocusCapture:w=>{w.stopPropagation()},children:[e.jsx(P,{"aria-label":"",className:"icon-md"}),_&&e.jsx("span",{className:"ms-1.5 me-0.5",children:y?e.jsx(E,{id:"5+Ls1e",defaultMessage:"Skills"}):e.jsx(E,{id:"mNL7WC",defaultMessage:"Tools"})})]})}),e.jsx(H.Portal,{children:e.jsx(H.Content,{size:"auto",alignOffset:-8,onEscapeKeyDown:()=>{M.current=!0},onCloseAutoFocus:w=>{if(!M.current||R.current){w.preventDefault();return}document.querySelector("#system-hint-button")?.focus()},children:e.jsxs(H.RadioGroup,{value:s,onValueChange:w=>{const j=t.find(N=>N.systemHint===w);j&&(bn(j.systemHint,j.systemHint===s?Se.Disable:Se.Enable,i),s===w?r?.({hint:j,enable:!1}):u(j.systemHint)||(R.current=!0,r?.({hint:j,enable:!0}),m(j.systemHint)))},children:[!_&&e.jsx(H.Label,{children:y?e.jsx(E,{id:"m/042P",defaultMessage:"Skills"}):e.jsx(E,{id:"KSn3Jr",defaultMessage:"Tools"})}),t.length===0?e.jsxs(e.Fragment,{children:[e.jsx(H.Shimmer,{}),e.jsx(H.Shimmer,{}),e.jsx(H.Shimmer,{})]}):e.jsx(e.Fragment,{children:t.map(w=>{const j=w.actionLabel??w.name,N=d(w.systemHint),D=w.systemHint===A.Research&&l,F=w.systemHint===s;return e.jsx(H.RadioItem,{value:w.systemHint,disabled:D,color:F?"selected":"default",icon:e.jsx(Kt,{svgString:w.logo,"aria-label":"",className:"icon-md"}),trailing:!D&&!F&&N?e.jsx("span",{className:"text-token-text-secondary",children:N}):e.jsx(H.RadioItemCheck,{}),children:D?e.jsxs("div",{className:"flex flex-col",children:[j,D&&e.jsx("span",{className:"text-xs",children:e.jsx(E,{id:"composer.skills.unavailable",defaultMessage:"Temporarily unavailable"})})]}):j},w.systemHint)})})]})})})]})},ir=({disabled:t,children:s,contextualAnswersHintNameIfPresent:n,newToolsConfigMenu:o,skip:a})=>{const r=o!=null,i=o==="config_icon"||o==="skills_icon",d=Le(pe.hasSeenComposerSystemHintButtonTooltip),l=Le(pe.hasSeenCaSystemHint),u=!t&&!d.isLoading&&d.eligible,m=!t&&!d.isLoading&&n&&!l.isLoading&&l.eligible,c=u?{announcementKey:pe.hasSeenComposerSystemHintButtonTooltip,title:r&&i?e.jsx(E,{id:"H819Oo",defaultMessage:"ChatGPT skills, all in one place"}):e.jsx(E,{id:"tTydhk",defaultMessage:"All your tools, in one handy place"}),onDismiss:d.markAsViewed,description:e.jsx(E,{id:"Kgb5fv",defaultMessage:"Create an image, research report, and more."})}:m?{announcementKey:pe.hasSeenCaSystemHint,title:e.jsx(E,{id:"uaC1JM",defaultMessage:"Not finding internal information?"}),onDismiss:l.markAsViewed,description:e.jsx(E,{id:"TL/S+W",defaultMessage:"If ChatGPT didn't search your files automatically, type {hintName} or select it from the menu.",values:{hintName:e.jsx("span",{className:"font-bold whitespace-nowrap",children:'"/'+n+'"'})}})}:void 0;if(a)return s;if(c)return e.jsx(An,{show:!0,side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",sideOffset:0,className:"xs:max-w-sm! max-w-2xs!",...c,children:s});let p;return t?p=i?e.jsx(E,{id:"R3rcdg",defaultMessage:"Skills unavailable"}):e.jsx(E,{id:"uw9x80",defaultMessage:"Tools unavailable"}):r?p=i?e.jsx(E,{id:"SiU5Ib",defaultMessage:"Choose skill"}):e.jsx(E,{id:"Yr1zf1",defaultMessage:"Choose tool"}):p=e.jsx(E,{id:"mrYNGk",defaultMessage:"View tools"}),e.jsx(Vt,{side:"bottom",label:p,children:s})};function ag(t){return!t||t.remaining>tg?null:t.remaining===0?e.jsx(qt,{"aria-label":"",className:"icon-md text-token-text-secondary h-5 w-5"}):e.jsx(E,{id:"m6JsYD",defaultMessage:"{remaining} left",values:{remaining:t.remaining}})}const rr=({clientThreadId:t})=>{const s=Tm(),{setThreadSystemHintMode:n}=fe(),o=s?.location.search;f.useEffect(()=>{if(new URLSearchParams(window.location.search).get("enable-internal-knowledge")==="true"&&document){n(A.ContextualAnswers,!0,{clientThreadId:t});const r=new URLSearchParams(window.location.search);r.delete("enable-internal-knowledge");const i=r.toString();window.history.replaceState({},document.title,`${window.location.pathname}${i?`?${i}`:""}`)}},[o,t,n])},ig=({composerController:t,systemHint:s,clientThreadId:n,connectionStatuses:o})=>{const a=ys(),r=s.systemHint,i=zt(r);rr({clientThreadId:n});const d=Ke();if(!s.composerBarButtonInfo)return null;const l=o.some(p=>p.user_connection_details.activation_status==="partially_activated"||p.user_connection_details.activation_status==="activated"),u=Xn(d,"463092697")?.value,m=u?.enabled??!1,c=u?.enabledConnectors??[];return e.jsx(Op,{composerController:t,systemHint:s,composerBarButtonInfo:s.composerBarButtonInfo,clientThreadId:n,isDisabled:!1,showLabel:a,dropdownContent:!l&&!m?e.jsx(gn,{}):void 0,splitButtonDropdownContent:m?e.jsx(Ms,{clientThreadId:n,enabledConnectors:c,includeSyncConnectors:!0,includeWebSearch:!1}):l&&i?e.jsx(gn,{}):void 0,dataTestid:Xu,tooltipPosition:"top",disableNuxMarkdown:!0,as:m?"dropdown":"popover"})},gn=()=>{const[t,s]=f.useState(),{connectionInstanceData:n,isLoading:o}=jn(),a=f.useMemo(()=>[...n?.connection_statuses??[]].sort(Ya),[n]),r=a.some(i=>i.user_connection_details.activation_status==="activating"||i.user_connection_details.activation_status==="partially_activated"||i.user_connection_details.activation_status==="inactive"&&i.user_connection_details.auth_status==="user_connected");return f.useEffect(()=>{T.logEventWithStatsig("Contextual Answers User Composer Dropdown Shown","chatgpt_contextual_answers_user_composer_dropdown_shown")},[]),o?e.jsx("div",{className:"w-full max-w-[calc(100vw-1.5rem)] min-w-[calc(100vw-1.5rem)] p-3 md:min-w-[22rem]",children:e.jsx(kp,{lines:4,size:"lg"})}):e.jsxs(dt,{children:[t&&e.jsx(Ka,{connection:t,onClose:()=>s(void 0)}),e.jsxs("div",{className:"w-full max-w-[calc(100vw-1.5rem)] min-w-[calc(100vw-1.5rem)] px-1 py-3 md:min-w-[22rem]",children:[a.map(i=>{const d=i.user_connection_details.activation_status,l=d==="partially_activated"||d==="activating";return e.jsx(ua,{className:q(i.user_connection_details.activation_status==="activating"?"grayscale":void 0,l?"":"cursor-default"),onClick:u=>{l&&s(i),u.stopPropagation()},children:e.jsx(Ju,{title:i.connection_display_info.display_name,icon:e.jsx("img",{src:i.connection_display_info.icon_url??"",alt:i.connection_display_info.display_name,className:"icon-md"}),statusIndicator:e.jsx($a,{connection:i,location:"user_dropdown"})})},i.user_connection_details.connection_instance_id)}),e.jsx(ua,{onClick:i=>{window.location.hash="#settings/ConnectorSettings",i.stopPropagation()},children:e.jsxs("div",{className:"flex w-full flex-row items-center justify-start gap-4 text-start",children:[e.jsx(kn,{className:"icon-md"}),e.jsx("p",{className:"text-token-text-primary flex-1 text-sm font-medium",children:r?e.jsx(E,{id:"EqgQdy",defaultMessage:"See syncing state"}):e.jsx(E,{id:"05N3nu",defaultMessage:"Manage connectors"})})]})})]})]})};function rg({systemHints:t,composerController:s,clientThreadId:n}){const{configurationMenuType:o}=He(),a=o!=="none",r=Wn(s),i=t.find(({systemHint:u})=>u===r),{isUnauthenticated:d}=Te(),{setThreadSystemHintMode:l}=fe();return f.useEffect(()=>{o!=="none"&&r&&!t.some(({systemHint:u})=>u===r)&&!d&&l(r,!1,{clientThreadId:n})},[n,l,r,t,d,o]),i?e.jsxs("div",{"data-testid":"active-system-hint-pill",className:Vn("[view-transition-name:var(--vt-composer-active-system-hint-pill)",a&&"flex items-center gap-1.5 ps-0.5"),children:[e.jsx("div",{"data-separator":!0,className:"bg-token-border-default h-3 w-px"}),e.jsx(lg,{activeSystemHint:i,onClick:()=>{l(i.systemHint,!1,{clientThreadId:n})}})]},"active-hint-tag"):null}function lg({activeSystemHint:t,onClick:s}){const n=K(),{configurationMenuType:o}=He(),a=o!=="none";return e.jsxs(so,{as:a?"button":"div",role:a?void 0:"button",tabIndex:a?void 0:0,onClick:s,spacing:"compact",isSelected:!0,isLegacyStyle:!0,borderVisible:!0,children:[e.jsx(Kt,{svgString:t.logo,className:a?"icon-md":"icon-md text-token-interactive-label-accent-default flex-1","aria-label":""}),e.jsx("span",{"data-label":!0,className:"mx-1.5",children:t.shortLabel??t.name}),a&&e.jsx(Ti,{"aria-label":"",className:"icon-smaller -ms-0.5 mt-px @max-[521px]/thread:ms-1"}),!a&&e.jsx(Si,{"data-remove-think-button":!0,className:"-me-1","aria-label":n.formatMessage({id:"HW9RTL",defaultMessage:"Disable {systemHintName}"},{systemHintName:t.name})})]})}function cg({systemHints:t,composerController:s,clientThreadId:n,connectionStatuses:o}){rr({clientThreadId:n});const a=Ke(),{configurationMenuType:r}=He(),i=r!=="none",d=Wn(s),l=t.find(({systemHint:y})=>y===d),u=zi(),{enabled:m}=Zn(),c=f.useMemo(()=>Object.entries(u).reduce((y,[v,_])=>(_&&(v!==J.GITHUB_CONNECTOR||m)&&y.push(v),y),[]),[u,m]);if(!i||!l)return null;if(d===A.Research||!1)return e.jsx(Vp,{clientThreadId:n,enabledConnectors:c,trigger:e.jsx(H.BasicTrigger,{children:e.jsxs(so,{as:"button",spacing:"compact",children:[e.jsx(bi,{className:"icon-md","aria-label":""}),e.jsx("span",{"data-label":!0,className:"mx-1.5",children:e.jsx(E,{id:"DhW8Wx",defaultMessage:"Sources"})}),e.jsx(Ht,{className:"icon-sm -ms-0.5 @max-[521px]/thread:ms-1"})]})})});const g=Xn(a,"463092697")?.value,h=g?.enabled??!1,S=g?.enabledConnectors??[];return d===A.ContextualAnswers&&(o&&o.length>0||h)?e.jsx("div",{"data-testid":"sources-pill",className:Vn("[view-transition-name:var(--vt-composer-sources-pill)",i&&"flex items-center gap-1.5 ps-0.5"),children:e.jsx(ug,{dropdownContent:h?e.jsx(Ms,{clientThreadId:n,enabledConnectors:S,includeSyncConnectors:!0,includeWebSearch:!1}):e.jsx(gn,{}),as:h?"dropdown":"popover"})},"sources-tag"):null}function ug({dropdownContent:t,as:s}){const n=e.jsxs(so,{as:"button",spacing:"compact",children:[e.jsx(bi,{className:"icon-md mx-1","aria-label":""}),e.jsx("span",{"data-label":!0,children:e.jsx(E,{id:"DhW8Wx",defaultMessage:"Sources"})}),e.jsx("div",{className:"me-0.5 flex items-center",children:e.jsx(Ht,{className:"pointer-events-auto! h-4 w-4"})})]}),o=s==="popover"?e.jsx(wn,{children:e.jsx(ed,{className:"p-0",$as:_n,side:"bottom",align:"start",collisionPadding:10,sideOffset:8,children:t})}):e.jsx(H.Portal,{children:e.jsx(H.Content,{children:t})});return s==="popover"?e.jsxs(vn,{children:[e.jsx(Zu,{asChild:!0,children:n}),o]}):e.jsxs(H.Root,{children:[e.jsx(H.Trigger,{asChild:!0,children:n}),o]})}function dg({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:o,attachmentsProductFeature:a,getInputProps:r,openFileDialog:i,onOauthRedirect:d,historyDisabled:l,isDisabled:u,highlightTooltip:m,disabledReason:c,currentModelName:p,showLabel:x,showUpsell:g,hideBorder:h,isSmall:S,visualTreatment:y,layoutMode:v,restoreFocus:_}){const P=Gn(),{gdriveStatus:R,o365Status:M}=mi(),w="h-[20px] w-[20px]",j=l?"text-white":m?"text-brand-blue-800":"",N=g?e.jsx(ln,{"aria-label":"",className:q(w,j)}):e.jsx(ln,{"aria-label":"",className:q(w,j)}),D=(R!=="false"||M!=="false"||P||y==="vanguard")&&!g,F=Nm(),z=y==="vanguard"&&!F,b=D?e.jsx(ar,{hideBorder:h,isSmall:S,clientThreadId:t,icon:N,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:o,attachmentsProductFeature:a,onOauthRedirect:d,uploadType:s,openFileDialog:i,getInputProps:r,isDisabled:z?!1:u,highlightTooltip:m,disabledReason:c,currentModelName:p,visualTreatment:y,layoutMode:v,restoreFocus:_}):e.jsx(er,{isSmall:S,hideBorder:h,clientThreadId:t,uploadType:s,openFileDialog:i,getInputProps:r,showLabel:x,showUpsell:g,icon:N,isDisabled:u,highlightTooltip:m,disabledReason:c,currentModelName:p});return e.jsx("div",{className:"relative",children:e.jsx(or,{showBackground:m,className:"bg-brand-blue-800/20",children:b})})}const mg=({clientThreadId:t,currentModel:s,uploadType:n,modelSupportedImageMimeTypes:o,modelAcceptedMimeTypes:a,modelProductFeatures:r,getEditorGizmoId:i,onOauthRedirect:d,disabledReason:l,isTemporaryChat:u,isDisabled:m,highlightTooltip:c,showLabel:p,showUpsell:x,numRemainingFiles:g,visualTreatment:h,layoutMode:S,restoreFocus:y})=>{const v=K(),_=$e(),{handleFileAccepted:P}=io(v,n,o,"mouse",i,r?.attachments),{getInputProps:R,open:M}=no({disabled:m,noClick:!0,onDropAccepted:P,onDropRejected:w=>ao(w,v,_,n),multiple:!0,maxSize:Fn,maxFiles:g,...Dn(a)});return e.jsx(dg,{isSmall:!0,hideBorder:!0,isDisabled:m,highlightTooltip:c,onOauthRedirect:d,visualTreatment:h,attachmentsProductFeature:r?.attachments,clientThreadId:t,uploadType:n,modelAcceptedMimeTypes:a,modelSupportedImageMimeTypes:o,getInputProps:R,openFileDialog:M,historyDisabled:u,showLabel:p,showUpsell:x,disabledReason:l,currentModelName:s?.title??"",layoutMode:S,restoreFocus:y})};function pg(){const s=ni().has(A.Research),n=!1,o=oe("3544641259")?.value;return(s||n)&&o}function fg(){const t=Hn(),o={initial:{opacity:0,y:"-28px",rotate:45},animate:{opacity:1,y:0,rotate:45,transition:t?Gt:{opacity:{delay:.4},default:ka}},exit:{opacity:0,y:"-28px",rotate:45,transition:t?Gt:{opacity:{delay:0},default:ka}}};return e.jsx(Z.div,{variants:o,initial:"initial",animate:"animate",exit:"exit",className:"border-token-border-xlight bg-token-main-surface-primary absolute start-1/2 top-full mt-[11px] h-2 w-2 -translate-x-1/2 transform rounded-se-[1px] rounded-es-[1px] border-s border-t dark:bg-[#303030]"})}const gg=({activeSystemHint:t,showHints:s,showContextChevron:n,onRemoveHint:o,lockSystemHint:a})=>{const r=K(),{popoverTriggerRef:i}=Mn(),d=()=>{requestAnimationFrame(()=>{i.current?.focus()})};if(t){const{logo:l,name:u}=t;return e.jsxs("div",{className:q("relative flex items-center justify-center",!a&&"-me-1"),children:[e.jsx(Kt,{className:"icon-md text-token-interactive-label-accent-default flex-1",svgString:l}),!a&&e.jsx(Si,{"data-remove-hint-button":!0,onClick:m=>{m.stopPropagation(),m.preventDefault(),o(),d()},"aria-label":r.formatMessage({id:"YQ7uOV",defaultMessage:"Remove {tool} from selection"},{tool:u})}),n&&e.jsx(fg,{})]})}return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-token-border-default ms-0.5 h-[16px] w-[1px]"}),e.jsx("div",{className:"text-token-text-tertiary hover:text-token-text-primary me-0.5 flex items-center",children:e.jsx(Ht,{className:"text-token-text-tertiary hover:text-token-text-primary pointer-events-auto! h-4 w-4"})})]}):e.jsx(xi,{"aria-label":r.formatMessage({id:"xosz07",defaultMessage:"View all tools"}),className:"text-token-text-secondary h-5 w-5"})},hg={source:{id:"SystemHintCategory.Sources",defaultMessage:"Sources",description:"Label on system hint menu for hints that act as data sources"},tool:{id:"SystemHintCategory.Tools",defaultMessage:"Tools",description:"Label on system hint menu for hints that act as tools"}},xg=({children:t,clientThreadId:s,layoutMode:n,lockSystemHint:o,composerController:a,onChangeSystemHint:r,systemHints:i,activeSystemHintType:d,recentSystemHintTypes:l,showHints:u,reasonItem:m=!1,gizmoId:c,isInReasonMode:p,type:x,...g})=>{const h=pg(),S=Hn(),y=K(),v=i.find(({systemHint:k})=>d===k),_=Mt(),P=l.map(k=>k===A.PictureV2&&!i.find(({systemHint:U})=>k===U)?i.find(({systemHint:U})=>U===A.Picture):i.find(({systemHint:U})=>k===U)).filter(k=>!!k),[R,M]=f.useState(null),w=(k,U)=>{U?M(k):r(k)},{selectedIndex:j,systemHintSuggestions:N,suggestorClosed:D,resetSelectedIndex:F}=sr({composerController:a,clientThreadId:s,onHintSelected:r}),z=D?i:N,b=[],I=tr(z);let G=0;for(const k of I){const U=k.systemHints;U.length!==0&&(b.push({...k.category?{message:hg[k.category]}:{},systemHints:U,indexOffset:G}),G=U.length)}const W=()=>{a.setReasonMode(!p),p?T.logEventWithStatsig("Composer Think Button Disabled","composer_think_button_disabled",{clientThreadId:s}):T.logEventWithStatsig("Composer Think Button Enabled","composer_think_button_enabled",{clientThreadId:s})};return e.jsxs("div",{className:q("flex items-center rounded-full",u&&"me-1 border",d!==void 0?"border-transparent":x==="toolpile_icon"?"border-token-border-default":"border-token-border-xlight"),children:[!v&&u&&e.jsx(td,{onChangeSystemHint:w,systemHints:P}),e.jsxs(eo,{layoutMode:n,forceOpen:!D,...g,children:[t?e.jsx(Wi,{children:t}):e.jsx(up,{transition:S?Gt:fs,shape:d?"rectangle":"round",spacing:"compact",isSelected:d!==void 0,"aria-label":y.formatMessage({id:"NLd5mV",defaultMessage:"Open tool menu"}),className:q(u&&"-mx-0.5",o&&"cursor-default!",x==="config_icon"&&"min-w-9",x==="toolpile_icon"&&"min-h-9"),onClick:k=>{if(o){k.stopPropagation(),k.preventDefault();return}},tooltipLabel:!d&&y.formatMessage({id:"xgQfBi",defaultMessage:"View all tools"}),disableHover:u&&!v||o,isLegacyStyle:x==="config_icon"||x==="toolpile_icon"&&!!d,borderVisible:x==="config_icon"||x==="toolpile_icon"&&!!d,children:e.jsx(gg,{activeSystemHint:v,showHints:u,showContextChevron:h||!1,onRemoveHint:()=>r(null),lockSystemHint:o})}),e.jsx(to,{onMouseDown:k=>{k.preventDefault()},align:"end",children:e.jsx(sd,{onChangeSystemHint:w,systemHintCategories:b,activeSystemHint:d,activeIndex:j,resetActiveIndex:F,reasonItem:m,gizmoId:c,clientThreadId:s,handleToggleReasonItem:W,isInReasonMode:p})})]}),!_||_.planType===Bm.FREE&&e.jsx(nd,{open:!!R,onOpenChange:()=>M(null),systemHint:R})]})},Oa="gpt-4o",Sg=({clientThreadId:t,composerController:s,pendingFiles:n,isUploadDisabled:o,highlightUploadTooltip:a,hasFiles:r,conversationMode:i,placeholder:d,isTemporaryChat:l,layoutMode:u,state:m,inputState:c,disableReason:p,gizmoId:x,currentModel:g,replyRegions:h,uploadButtonDisabledReason:S,keepExpanded:y=!1,getEditorGizmoId:v,onOauthRedirect:_,onSubmit:P,visualTreatment:R,legacyFooterActions:M,legacySuggestionsPopoverContent:w,isNewThread:j=!1,isInReasonMode:N,modelSupportedSystemHints:D,contextualAnswerUserConnectionData:F})=>{const{data:z}=$t(),[b,I]=da(!1),{updateSystemHint:G}=fe(),{configurationMenuType:W}=He(),k=W!=="none";ks();const U=qe.useState(({persistedSystemHints:$})=>$);od(t,R==="vanguard");const Y=Array.from(U)[0],L=qe.useState(({recentHints:$})=>$),{state:Q}=Ss(t),ie=Rt(!1),ye=De($=>$.threads[t]?.modelSelection),Ue=ye?.type===be.SPECIFIC,mt=De($=>$.setThreadModelSelection),Ne=R==="vanguard"&&g?.id!==Oa&&!Ue&&!b();Ci(f.useCallback(()=>{Ne&&(ie({location:"PromptTextarea",modelId:Oa}),vt(t,mt,{type:be.EFFORT_MODE,effortMode:Za.low}))},[Ne,ie,t,mt]));const{setIsOpen:Qe}=ad(),Xe=$=>{I(!0),G($,{clientThreadId:t}),$===A.Research?Qe(!0):Qe(!1),$&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{s.focus()})})},ve=!1,we=Q==="clarify"||ve,_e=f.useCallback(($,st)=>e.jsx(pi,{...st,isSmall:R==="vanguard",inputState:c,state:m,onSubmit:P,composerController:s,clientThreadId:t,gizmoId:x,disableReason:p,useStartButtonText:we,disableTooltip:$}),[c,m,P,s,t,x,p,we,R]),Je=$=>{b()&&($.preventDefault(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{s.focus()})}))},ge=id({inputState:c,state:m,composerController:s,clientThreadId:t}),{whisperControls:Be}=qi({composerController:s,renderInComposer:_e,composerType:R,composerRightButtonType:ge,layoutMode:u}),[ae=null,je,pt]=f.useMemo(()=>[In(g,i),On(g,i),Ln(g,i)],[g,i]);zn(t);const Ze=qe.useState(({availableHints:$})=>$),ce=qe.useState(({locked:$})=>$),ke=f.useMemo(()=>ye?.type===be.EFFORT_MODE?rd[ye.effortMode]:"low",[ye]),[ne,Re]=da(ke);f.useEffect(()=>{Re(ke)},[ke,Re]),Le(pe.ModelPickerMoved);const Ae=Rn(x);Q!=="disabled"||ve||(i?.kind,Oe.GizmoInteraction);const{pageType:Et}=yi(),ue=vi($=>$.selectedApps),ft=wi()&&ue.length>0,Me=r||ft,et=y||!!Y||h&&h.length>0||Me||Ze.length<3;gs(g,i,U);const O=zt(A.ContextualAnswers)&&!!j,{shouldShowResearchText:de}=Ss(t),gt=ld(),tt=cd({exposed:O})==="bigbox",Es=gt&&de||tt&&O;return e.jsxs(Cp,{isBigBoxModeActive:Es,isTemporaryChat:l,placeholder:d,visualTreatment:R,composerController:s,isExpandedByDefault:et,onSubmit:P,children:[h&&h.length>0&&e.jsx(Ra,{children:e.jsx(gi,{replyRegions:h})}),Me&&e.jsx(Ra,{children:e.jsx(un,{files:n,fullBleed:!0,selectedApps:ue,className:Vn("no-scrollbar -ms-1.5 flex flex-nowrap gap-2 overflow-x-auto",R==="composer-btn"?"horizontal-scroll-fade-mask py-1.5 ps-2 pe-4 [--edge-fade-distance:1rem]":"p-1.5")})}),[M?.map(($,st)=>e.jsx(yp,{children:$},`legacy-footer-action-${st}`))??[],(k&&e.jsx(Aa,{children:e.jsx(rg,{clientThreadId:t,composerController:s,systemHints:D})},"active-hint-tag"))??[],e.jsx(Aa,{children:e.jsx(cg,{clientThreadId:t,composerController:s,systemHints:D,connectionStatuses:F?.connection_statuses})},"sources-tag"),e.jsx(vp,{children:w},"legacy-suggestions-popover")],R==="vanguard"&&e.jsx(wp,{children:e.jsx(xg,{activeSystemHintType:Y,lockSystemHint:Et.type==="landing-page"||ce,systemHints:Ze,clientThreadId:t,composerController:s,onChangeSystemHint:Xe,layoutMode:u,recentSystemHintTypes:L,showHints:!j,isInReasonMode:N,restoreFocus:Je})},"system-hint-popover"),e.jsx(_p,{children:Be}),gt&&de?e.jsx(Ma,{children:e.jsx(jp,{composerController:s,visualTreatment:"vanguard"})}):tt&&O?e.jsx(Ma,{children:e.jsx(ud,{composerController:s,visualTreatment:"vanguard"})}):null]})},bg=$n(()=>Qn(()=>import("./jkshdeunw22wsq7a.js"),__vite__mapDeps([8,1,2,3,4,5,9,10,11,12,13,14])).then(t=>t.ImageGenComposer)),Cg=1,yg=3e3,vg=()=>null;function wg({onCreateNewCompletion:t,onContinueGenerating:s,account:n,currentModelId:o,currentModelConfig:a,disableDraftPersistence:r=!1,modelCategories:i,areModelsLoading:d,clientThreadId:l,isNewThread:u,isCompletionInProgress:m,className:c,disabled:p=!1,disabledReason:x,canPause:g=!1,canContinue:h=!1,isInteractableSharedThread:S,onComposerInput:y,onComposerChange:v,onAutocompleteSelect:_,headerClassName:P,hideHeader:R,onTaggingDropdownOpen:M,onTaggingDropdownClose:w,onlyAllowImageUploads:j}){ma.markStart("PromptTextarea"),ma.markRendered("PromptTextarea");const N=f.useContext(Hi),D=Im(N),F=Ke(),z=f.useRef(null),b=At(),I=ai(),G=Om(I.showUploadSuggestion$),W=dd(),k=n?.isTeam(),{isUnauthenticated:U}=Te(),Y=K(),L=$e(),Q=Pn(),ie=ks(),ye=md.useStore(),[Ue,mt,Ne]=le(l,C=>[te.getCurrentLeafId(C),te.getRequestId(C),te.findNode(C,V=>!!V.message.metadata?.b1de6e2_s)]),[Qe]=dl(),{gizmoEditorData:Xe,mode:ve,getGizmoId:we}=Bn(),_e=Dm(),Je=ys(),ge=Lm(),Be=pd(),ae=Fi(l),je=!!Mi(),pt=!!Kn(),Ze=fd.useIsEnabled(l),ce=!!Jn(),{setThreadSystemHintMode:ke}=fe(),ne=Wt(),{state:Re}=Ss(l),Ae=ne.has(A.Search),Et=ne.has(A.Think),ue=Le(pe.ModelPickerMoved),ft=ne.has(A.Research),{enabled:Me}=Zn(),{activeSystemHints:et}=zn(l),O=et.length>0,de=et.find(C=>C.systemHint===A.ContextualAnswers),gt=gd(),{connectionInstanceData:tt,isLoading:Es}=jn({skip:!gt}),{selectedSources:$}=ws(l),st=f.useRef(0),Ps=f.useRef(!1),cr=i?.find(C=>C.defaultModel===o),ur=vg();let X=js(l),Ts=X&&"gizmo"in X?X.gizmo:void 0;const dr=Fm(),nt=Ts?.gizmo.id??dr,Pt=Rn(nt),mr=hd(),ro=xd(),[he,Qt]=f.useState(null);he!==null&&(X={gizmo:he,gizmo_id:he.gizmo.id,kind:Oe.GizmoInteraction},Ts=he);const Tt=gs(a,X,ne),pr=Rs(),lo=Li(F).flags,Xt=lo?.includes(bs.NoAuthEnableFileUploads),{showLegacyReasoningSlider:ot,showReasoningSliderNux:fr,reasoningSliderType:gr,hideReasonInSystemHintOverflow:hr,hideSearchInSystemHintOverflow:xr,configurationMenuType:co}=He(),uo=co!=="none",Jt=De(C=>C.setThreadModelSelection),mo=De(C=>C.threads[l]?.modelSelection),po=mo?.type===be.EFFORT_MODE?mo.effortMode:null,fo=!!po&&po!=="default";Ci(f.useCallback(()=>{fo&&vt(l,Jt,{type:be.EFFORT_MODE,effortMode:"default"})},[fo,l,Jt])),hp({serverThreadId:ae,clientThreadId:l,composerController:b,currentModelId:o,account:n,getIsDisabled:f.useCallback(()=>!1,[]),onReset:()=>{vt(l,Jt,{type:be.EFFORT_MODE,effortMode:"default"})},onInfer:C=>{vt(l,Jt,{type:be.EFFORT_MODE,effortMode:C})},isInferEnabledForModel:a?.enableInfer});const go=!p&&(Tt!==it.None||d)&&(!U||Xt),Ge=On(a,X),Ns=Ln(a,X);let re=rn(C=>C.files);const[Zt]=f.useState(()=>Sd());ve==="magic"?re=re.filter(C=>C.gizmoId!=null):re=re.filter(C=>C.gizmoId==null);const ho=bd(),ze=re.length>0||ho,xo=rn(Xd.hasUploadInProgress),Bs=vi(C=>C.selectedApps),So=wi()&&Bs.length>0,Sr=ze||So,br=Cd(l),Is=b.useState(C=>{const V=yd(C);return typeof a?.maxTokens=="number"&&V>a.maxTokens}),bo=b.useState(C=>!C.isEmpty()),es=!Is&&!xo&&(bo||ze),Co=(Tt===it.Multimodal?Tn:Nn)-re.length,yo=Co<=0,Cr=vd(),yr=oe("3544641259")?.value,{selectedRepos:Os}=yn(l),vo=Cr&&yr&&$?.size===0,ht=es&&!p&&!ce&&(!m||ro)&&!vo,[wo,vr]=f.useState(!1),{value:wr}=oe("3780975974"),{targetedContent:_o,setTargetedContent:ts}=wd(),Ee=_o?.isFocusedViewContent&&!Be?void 0:_o;f.useEffect(()=>{requestAnimationFrame(()=>requestAnimationFrame(()=>b.focus()))},[Ee]);const jo=X==null||X?.kind===Oe.PrimaryAssistant||X?.kind===Oe.GizmoInteraction&&Pt,{getUpsellLabelType:_r,getUpsellShowsAttach:jr,getShowUpsellReason:kr}=fi(),Ds=O&&jo,[Rr,Ar]=f.useState(!1),Mr=!U&&jo&&(!k||!Es),xt=rt(b.store,C=>C.controlsDisabled);f.useEffect(()=>{if(!W?.id)return;const C=pa.getAndReset(W.id,ae);C&&b.setText(C.inputText)},[W?.id,ae,b]),f.useEffect(()=>{const C=Qe.get("prompt")??"";b.getCurrentText().length===0&&C.length>0&&b.setText(C)},[b,Qe]),f.useEffect(()=>{wo!==ht&&(vr(ht),ht&&Hm(!0).then(C=>{_d.startEnforcement(C),Um.startEnforcement(C)}))},[ht,wo,X?.kind,_e]);const ss=In(a,X),{handleFileAccepted:ko}=io(Y,gs(a,X,ne),Ge,"mouse",we,ss?.attachments),Er=f.useCallback((C,V)=>(requestAnimationFrame(()=>{requestAnimationFrame(()=>{b.focus()})}),ko(C,V)),[b,ko]),{getInputProps:Pr,open:Ls,inputRef:Ro}=no({disabled:p||!go||yo,noClick:!0,onDropAccepted:Er,onDropRejected:C=>ao(C,Y,L,Tt),multiple:!0,maxSize:Fn,maxFiles:Co,...Dn(U||j?Ge:Ns)}),Ao=rt(Zt),Mo=f.useCallback(()=>{b.eraseContent(),Ao.clearMessages(),b.resize(Cg),b.usedDictation=!1,b.dictationEdited=!1;for(const C of re)ms.remove(Q,C.tempId,"none");jd.markAllAsSent()},[b,Ao,re,Q]),Nt=rt(b.store,C=>C.isInReasonMode),Eo=f.useMemo(()=>Xs(Nt,b,ne)[0],[Nt,b,ne]),Po=async(C,V)=>{if(C.preventDefault(),p||!es||!X)return;const me=b.getContentToSend(),xe=Jd(me.content),at=Xs(Nt,b,ne),{content:Ys,attachments:Ks}=Zd(Q,xe,a,X,ne);mr(),t({sourceEvent:C,attachments:Ks,content:Ys,contentToSend:me,conversationMode:X,hasSelectedApps:So,isMessageFollowupsEnabled:Ze,selectedApps:Bs,selectedGizmoTag:he,selectedRepos:{selectedAllRepos:Os.selectedAllRepos,selectedRepos:Os.selectedRepos?[...Os.selectedRepos]:null},selectedSources:$,systemHints:at,usedDictation:b.usedDictation,dictationEdited:b.dictationEdited}),Ee?.onCreateCompletion?.({serverThreadId:ae,currentLeafId:Ue}),Ee?.shouldPersistAcrossMessages!==!0&&ts(void 0),fa.hideThreadHeader();for(const aa of re)aa.status===em.Ready&&ye.addFile(aa);Mo()},Tr=C=>{ts(C.targetedReply),C.targetedReply&&T.logEventWithStatsig("Targeted Reply Button Clicked","chatgpt_targeted_reply_button_clicked",{conversationId:ae,sourceMessageId:C.messageId})},{maybeSetWaitingForRealtimeOnAbort:To,isWatingForRealtimeStatusChange:Nr}=kd(l),Fs=f.useCallback(C=>{To(),Rd(C)},[To]),No=f.useCallback(()=>{Ee?.onCleared?.({serverThreadId:ae,currentLeafId:Ue}),ts(void 0),b.focus()},[Ue,ae,Ee,ts,b]),Bo={Enter:{validator:C=>{const V=C.isComposing||C.keyCode===229;return!(os&&Ps.current)&&(C.metaKey||(Je||Vm||qm())&&!C.shiftKey&&!V)},handler:C=>{if(!ht){Is&&L.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}C.preventDefault(),Po(C)}},Escape:{validator:C=>!C.isComposing,handler:C=>{g&&m&&(Fs(l),T.logEventWithStatsig("Pause Completion","chatgpt_pause_completion",{threadId:Lt(l),currentLeafId:te.getCurrentNode(Pe(l)).message.id,eventSource:"keyboard"})),C.target.value===""&&No()}}},Bt=f.useRef(Bo);Bt.current=Bo;const ns=Ad(a?.tags,X?.kind),{showTaggingDropdown:Hs,isFocused:Br,autocompletions:We,matchaData:Ir}=rt(b.store),os=Br&&We.length>0,St=ns&&Hs&&!Pt,Io=b.isReady();f.useEffect(()=>b.subscribe("keydown",C=>{b.acceptLegacyKeydown()&&Bt.current[C.key].validator(C)&&Bt.current[C.key].handler(C);const me=b.getCurrentText();if(C.key==="@"){const xe=b.getSelectionStart(),at=me.substring(0,xe);(!at||/\s$/.test(at)||xe===0)&&setTimeout(()=>b.setShowTaggingDropdown(!0),10)}else Hs&&b.setShowTaggingDropdown(!1);C.key==="Escape"&&(Qt(null),b.setAutocompletions([])),Ae&&C.key==="Escape"&&ke(A.Search,!1,{clientThreadId:l})}),[b,Io,Hs,ne,Ae,ke,l]),f.useEffect(()=>{const C=Object.fromEntries(Object.keys(Bt.current).map(V=>[V,xe=>{const at=Bt.current[V];if(!at||b.acceptLegacyKeydown())return!1;const{validator:Ys,handler:Ks}=at;return Ys(xe)?(Ks(xe),!0):!1}]));b.registerKeyHandlers(C),b.registerFileInput({openFileDialog:Ls,inputRef:Ro})},[b,Ls,Ro,Io]),f.useEffect(()=>b.subscribe("paste",C=>{Md({filePickerStore:Q,event:C,intl:Y,toaster:L,clientThreadId:l,conversationMode:X,currentModelConfig:a,getEditorGizmoId:we,modelSupportedImageMimeTypes:Ge,persistedSystemHints:ne})}),[Y,l,X,a,we,Ge,b,L,Q,ne]);const Oo=C=>{je||Qt(C),b.trimLeadingText("@"),an(),b.setShowTaggingDropdown(!1)},Or=Ed(l,Zt,Ge,ss?.attachments),Dr=f.useCallback(C=>{C.preventDefault(),Fs(l),T.logEventWithStatsig("Pause Completion","chatgpt_pause_completion",{threadId:Lt(l),currentLeafId:te.getCurrentNode(Pe(l)).message.id,eventSource:"mouse"}),an()},[l,Fs]),as=f.useCallback(()=>{pa.set(W?.id,ae,b.getCurrentText())},[ae,W?.id,b]);f.useEffect(()=>{Xe||Pd()||b.focus()},[b]),f.useEffect(()=>{if(Ge.length>0)for(const V of re)Td(V.fileSpec?.mimeType,Ns)||ms.remove(Q,V.tempId,"none");else ms.reset(Q)},[o,Q]),f.useEffect(()=>{(!ns&&he||je)&&Qt(null)},[ns,he,je]),f.useEffect(()=>{pt&&b.setReasonMode(!1)},[pt,b]);const{layer:Lr}=Ye("4031588851"),{layer:Do}=Ye("3637408529"),Fr=Do.get("is_in_composer_text_exp",!1),Hr=Do.get("composer_text","MESSAGE_CHATGPT"),Ur=Lr.get("composer_text","MESSAGE_CHATGPT"),Gr=Fr?Hr:Ur,[is,zr]=(()=>{switch(x){case"workspaceDisallowsGizmo":return[ee.disallowedByWorkspacePlaceholder,!0];case"noModelsAvailable":return[ee.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[ee.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[ee.loading,!0];case"noTestGizmoId":return[ee.noTestGizmoId,!0];default:{if(S)return[ee.placeholderWithName,!1];if(Ee?.placeholderTextOverride!=null)return[Ee.placeholderTextOverride,!1];if(Re==="initial"||Re==="recurrent")return[ee.deepResearchPlaceholder,!1];if(Re==="clarify")return[ee.researchSuggestionInitial,!1];if(Eo)switch(Eo){case A.Search:return[ee.searchPlaceholder,!1];case A.Think:return[ee.thinkPlaceholder,!1];case A.Research:return[ee.researchPlaceholder,!1];case A.Canvas:return[ee.canvasPlaceholder,!1];case A.Picture:return[ee.picturePlaceholder,!1];case A.PictureV2:return[ee.pictureV2Placeholder,!1];case A.ContextualAnswers:return[Nd.caSuggestionInitial,!1]}switch(Gr){case"BLANK":return[null,!1];case"ASK_ANYTHING":return[ee.placeholderAskAnythingVariant,!1];case"ASK_CHATGPT_ANYTHING":return[ee.placeholderAskNameAnythingVariant,!1];default:return[ee.placeholderWithName,!1]}}}})(),Us=Pt?u?Y.formatMessage(Bd.newChatInProject):is?Y.formatMessage(is,{name:"ChatGPT"}):"â€‹":is?Y.formatMessage(is,{name:Xe!=null?ve==="magic"?Id:Xe.name||"GPT":Ts?.gizmo.display.name??"ChatGPT"}):"â€‹";f.useEffect(()=>b.subscribe("input",()=>{Od.getState().isThreadHeaderVisible&&fa.hideThreadHeader()}),[b]),f.useEffect(()=>b.subscribe("input",()=>{st.current=performance.now(),y?.()}),[b,y]),f.useEffect(()=>{if(v)return b.subscribe("change",()=>{v()})},[b,v]);const Wr=wr||kr(),Lo=Dd()&&!!We.find(C=>!!C.requires_file_upload),Vr={clientThreadId:l,uploadType:Tt,modelAcceptedMimeTypes:Ns,modelSupportedImageMimeTypes:Ge,attachmentsProductFeature:ss?.attachments,getInputProps:Pr,openFileDialog:Ls,historyDisabled:ge,onOauthRedirect:as,highlightTooltip:Lo&&!ze},It=[],Fo=[],Ho=!p&&!yo&&(go||pr!=null)&&!Ae,Uo=jr(),qr=!U||Uo||Xt,Go=Tt===it.None?wt.ModelNotSupported:Et?wt.ThinkModeInUse:Ae?wt.SearchModeInUse:void 0;if(qr){const C=e.jsx("div",{"data-testid":"composer-action-file-upload",style:{viewTransitionName:"var(--vt-composer-attach-file-action)"},children:e.jsx(Qf,{...Vr,showGlowingBorder:G,showLabel:_r()==="all",showUpsell:Uo&&!Xt,showMenuForNoAuth:Xt,isDisabled:!Ho||xt,disabledReason:Go,currentModelName:a?.title??"",visualTreatment:uo?"composer-btn":"legacy"})},"file-upload-button");It.push(C),Fo.push(C)}const Ie=[],zo=Un(),Wo=De(C=>C.isVisuallyOverflowing)&&ot;let rs="bottom";zo?rs="bottom":u&&(rs="centered"),ot&&(X?.kind!==Oe.GizmoInteraction||Pt)&&Ie.push(e.jsx("div",{"data-testid":"composer-action-reasoning-level",className:"flex [--pill-color:var(--text-secondary)] [--pill-font-size:13px]",onPointerDown:C=>C.stopPropagation(),children:e.jsx(An,{announcementKey:pe.ModelPickerMoved,side:"bottom",show:ie&&fr&&!ue.isLoading&&ue.eligible,onDismiss:ue.markAsViewed,theme:"bright",badge:"none",dismissOnOutsideClick:!0,sideOffset:0,title:e.jsx(E,{id:"NGN4SW",defaultMessage:"Set how long ChatGPT should think or pick a different model"}),children:e.jsx(uf,{clientThreadId:l,layoutMode:rs,currentModel:a,category:cr,type:gr,mode:Pt?"model-picker-only":"default"})})},"reasoning-level")),xr||Ie.push(e.jsx(Jp,{account:n,clientBootstrapFlags:lo,features:_e,currentModelConfig:a,hasFiles:ze,isDisabled:xt||ze,clientThreadId:l,composerController:b,gizmoId:nt},"search"));const{value:Yr}=oe("1830177352");!ot&&!hr&&Ie.push(e.jsx($p,{clientThreadId:l,gizmoId:nt,composerController:b,isDisabled:xt},"reason")),Yr&&Ie.push(e.jsx(Yp,{clientThreadId:l,gizmoId:nt,showLabel:Wr,isDisabled:xt},"deep-research")),Wo||Ie.push(e.jsx(op,{clientThreadId:l,composerController:b,isDisabled:xt,currentModelConfig:a,currentModelConfigLoading:d,disableIfNoAccess:ot},"shiba")),_t(F,"3240576626");const Vo=Xn(F,"463092697")?.value,Kr=Vo?.enabled??!1;if((Vo?.enabledConnectors??[]).filter(C=>C!==J.GITHUB_CONNECTOR||Me),de&&!Wo&&(tt&&tt.connection_statuses.length>0||Kr)&&Ie.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-search-action)"},"data-testid":"composer-action-contextual-answers",children:e.jsx(ig,{composerController:b,systemHint:de,clientThreadId:l,connectionStatuses:tt?.connection_statuses??[]})},"contextual-answers")),Mr&&Ie.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-system-hint-action)"},"data-testid":"composer-action-system-hint-button",children:e.jsx(sg,{composerController:b,clientThreadId:l,disabled:xt,hideThinkButton:ot,disableIfNoAccess:ot})},"system-hint-button")),co==="none"){const C=Ie.filter(V=>D?V.key==="search":!0);It.push(...C)}else{const C=Ie.find(V=>V.key==="system-hint-button");C&&It.push(C)}const Gs=_t(F,"2007855518"),qo=Ne?.message.metadata?.async_task_id,zs=Ld(C=>qo?C.tasks[qo]:null),[$r,Yo]=f.useState(!1),Ws=zs?.status===Fd.RUNNING,Vs=zr||Nr?"disabled":"default",Ko=Hd(Lt(l)||l)?.value,Qr=Ko===_a.STREAMING,Xr=Ko===_a.REALTIME,$o=m&&g||Qr||Xr||Ws&&Gs,Jr=Gm(),Zr=!ht||Jr,qs=Kd(xo,bo,Is,br,!vo,Ws,Gs),bt=$o?"streaming":Zr?"disabled":"idle",Ot=f.useRef(null),Ct=f.useRef(null),{value:el}=oe("222560275"),tl=el||o&&!o.startsWith("o1")&&!o.startsWith("o3");f.useEffect(()=>{const C=()=>{Ot.current!=null&&Ym.addAction("composer_state_disabled",{threadId:Lt(l),disabledReason:Ot.current})};if(es&&bt==="disabled"){let V="unknown";p?V=x??"component_disabled_unknown":m?V="completion_in_progress":ce&&(V="thread_hard_blocked"),Ot.current!==V&&(Ct.current&&clearTimeout(Ct.current),Ct.current=setTimeout(C,yg)),Ot.current=V}else Ot.current=null;return()=>{Ct.current&&(clearTimeout(Ct.current),Ct.current=null)}},[l,es,bt,p,x,m,ce]);const ls=[];if(Ee?.label&&ls.push({type:Ee.type,value:Ee.label,onRemoveRegion:No}),he!==null){const C=!!he.gizmo.tags?.includes(vs.FirstParty);ls.push({type:"mention",value:he.gizmo.display.name,icon:e.jsx(Gi,{isFirstParty:C,src:he.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{Qt(null),b.focus()}})}f.useEffect(()=>{(!We||We.length===0||!os)&&(Ps.current=!1)},[We,os]);const sl=f.useCallback((C,V,me)=>{Ps.current=C>=0,V&&b.setText(me?`${me.title}${me.body}`:"")},[b]),Qo=os&&We&&We.length>0&&!St&&!ft&&!b.hasMultipleLines()&&b.canShowAutocompletion();f.useEffect(()=>{St?M?.():w?.()},[St,M,w]);const cs=C=>{if(C.preventDefault(),C.stopPropagation(),st.current>0){const V=performance.now()-st.current;Km.hist($m.DEFAULT,"final_user_input_to_submit_ms",[],V)}bt==="streaming"&&(!ro||b.isEmpty())?Ws&&Gs?Yo(!0):Dr(C):Po(C)},nl=Ud(a,Pi.Canvas),{value:ol}=oe("61299031"),al=Gd(),il=nl&&ol&&!al&&!ho&&!zo;f.useEffect(()=>{},[ur,b]),f.useEffect(()=>{const C=Lt(l),V=n?.normalizedAccountUserId;if(!V||r)return;const me=on(()=>{const xe=b.getContentToSend().content;xe===""?zm(C):Wm(C,xe,V)},1e3);return b.subscribe("change",me)},[n,l,b,r,ae]);const Xo=e.jsx(If,{canUseInlineTagging:ns,isDisabled:p,clientThreadId:l,currentLeafId:Ue,currentRequestId:mt,canContinue:h,composerController:b,isNewThread:u,onContinueGenerating:C=>s({event:C,conversationMode:Pe(l)?.mode,systemHints:Xs(Nt,b,ne)}),onResetState:Mo,conversationMode:X,isShowingAutocomplete:!!Qo}),Jo=!$o&&X!=null&&tl&&zd.includes(X.kind)&&e.jsx(Wd,{clientThreadId:l,onTargetedReply:Tr}),Zo=Qo&&e.jsx("div",{className:"bg-token-main-surface-primary absolute start-0 z-[-1] box-border w-full ps-0 max-lg:bottom-full lg:top-full",children:e.jsx(ap,{suggestions:We,composerController:b,onSelect:_,onChange:sl})}),ea=e.jsx(Qd,{composerController:b,parsedDocumentHandler:Or}),ta=!R&&e.jsx(Zi,{className:P}),sa=e.jsx(Vd,{modelSupportedImageMimeTypes:Ge,uploadType:it.Multimodal,attachmentsProductFeature:ss?.attachments}),rl=e.jsxs(e.Fragment,{children:[St&&e.jsx(Ea,{onClick:C=>Oo(C),onClose:()=>{b.setShowTaggingDropdown(!1),b.focus()}}),Ds&&e.jsx(Ba,{composerController:b,clientThreadId:l})]}),{isImageGenEditor:na}=qd(),oa=_t(F,"3760395675");return na?e.jsxs(ga.Provider,{value:Zt,children:[e.jsx(xa,{onOauthRedirect:as,children:e.jsx(ha,{defaultOpen:oa,children:e.jsx("form",{id:"prompt",className:c,onSubmit:cs,children:e.jsxs("div",{className:"relative z-1 flex h-full max-w-full flex-1 flex-col",children:[ta,e.jsxs("div",{className:"group relative z-1 flex w-full items-center",style:{"--force-hide-label":Rr?"none":"block"},children:[e.jsxs(vn,{open:St||Ds,children:[e.jsx(qa,{className:"w-full",children:na?e.jsx(bg,{type:ge?"temporary":"default",ref:z,placeholder:Us,inputState:Vs,composerController:b,leftSideActions:Fo,state:bt,onSubmit:cs,renderFiles:ze&&e.jsxs(e.Fragment,{children:[ve==="magic"&&e.jsx("div",{className:"bg-token-main-surface-secondary text-token-text-secondary m-2 mb-0 rounded-lg p-2 text-xs",children:e.jsx(E,{...ee.gizmoKnowledgeWarning})}),e.jsx(un,{files:re,className:"-ms-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),clientThreadId:l,gizmoId:nt,disableReason:qs,modelId:o}):e.jsx(Xf,{type:ge?"temporary":"default",ref:z,replyRegions:ls,placeholder:Us,inputState:Vs,setIsComposerOverflowing:Ar,composerController:b,matchaData:Ir,leftSideActions:It,topRightAction:il&&e.jsx($d,{composerRef:z,composerController:b,clientThreadId:l}),state:bt,onSubmit:cs,renderFiles:Sr&&e.jsxs(e.Fragment,{children:[ve==="magic"&&e.jsx("div",{className:"bg-token-main-surface-secondary text-token-text-secondary m-2 mb-0 rounded-lg p-2 text-xs",children:e.jsx(E,{...ee.gizmoKnowledgeWarning})}),e.jsx(un,{files:re,selectedApps:Bs,className:"-ms-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),clientThreadId:l,gizmoId:nt,disableReason:qs,modelId:o})}),e.jsx(wn,{children:e.jsxs(_n,{side:"bottom",align:"start",sideOffset:12,onOpenAutoFocus:C=>C.preventDefault(),children:[St&&e.jsx(Ea,{onClick:C=>Oo(C),onClose:()=>{b.setShowTaggingDropdown(!1),b.focus()}}),Ds&&e.jsx(Ba,{composerController:b,clientThreadId:l})]})})]}),Zo]}),ea,sa]})})})}),Xo,Jo]}):e.jsx(ga.Provider,{value:Zt,children:e.jsxs(ha,{defaultOpen:oa,children:[e.jsx(xa,{onOauthRedirect:as,children:e.jsxs("div",{className:q("max-xs:[--force-hide-label:none] relative z-1 flex h-full max-w-full flex-1 flex-col",ot&&!ie&&"[--force-hide-label:none]"),children:[ta,zs&&$r&&e.jsx(Yd,{taskId:zs.taskId,clientThreadId:l,onClose:()=>Yo(!1)}),e.jsx(Sg,{visualTreatment:uo?"composer-btn":"legacy",hasFiles:ze,pendingFiles:re,isUploadDisabled:!Ho,isNewThread:u,clientThreadId:l,getEditorGizmoId:we,highlightUploadTooltip:Lo&&!ze,disableReason:qs,uploadButtonDisabledReason:Go,currentModel:a,layoutMode:rs,conversationMode:X,onOauthRedirect:as,state:bt,inputState:Vs,gizmoId:nt,isTemporaryChat:ge,placeholder:Us,composerController:b,onSubmit:cs,replyRegions:ls,keepExpanded:!0,legacyFooterActions:It,legacySuggestionsPopoverContent:rl,isInReasonMode:Nt,modelSupportedSystemHints:et,contextualAnswerUserConnectionData:tt}),Zo]})}),ea,Xo,Jo,sa]})})}function Da({clientThreadId:t,onClick:s}){f.useEffect(()=>{om(t)},[t]);const n=K();return e.jsx(Z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(_i,{onClick:()=>{am(t),s()},label:n.formatMessage(Ag.moreStarterPrompts)})})}function _g({starterPrompt:t,starterPrompts:s,index:n,disabled:o,onSelectStarterPrompt:a}){const r=t.theme??t.title,i=np(),{mutate:d}=sm(),l=t.category==="onboarding"?u=>{d({key:pe.hasUsedConversationalOnboardingStarterPrompt}),i(u,t,s,n)}:u=>a?.(u,t,s,n);return e.jsx(_i,{disabled:o,onClick:l,icon:e.jsx(nm,{category:t.category,useV2Colors:!0}),label:r})}const jg=5,kg=3;function lr({starterPrompts:t,onSelectStarterPrompt:s,disabled:n,clientThreadId:o,onExpand:a,mobileLayout:r=!1}){const i=r?kg:jg,[d,l]=f.useState(i),[u,m]=f.useState(!1),c=f.useRef(null),p=t.length<=d;f.useEffect(()=>{Sa(t.slice(0,i),o)},[o]),f.useEffect(()=>{if(!u&&!p&&c.current){const g=c.current,h=g.getBoundingClientRect(),S=h.width,y=Array.from(g.children);let v=0;for(let _=0;_<y.length&&y[_].getBoundingClientRect().right-h.left<=S;_++)v++;l(v),m(!0)}},[t,p,u]);const x=()=>{const g=t.slice(d,t.length).map(h=>({...h,isAdditional:!0}));g.length>0&&Sa(g,o),l(t.length),a()};return e.jsxs("div",{"data-testid":"starter-prompt-chips",className:q("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",u&&t.length>0?"opacity-100":"opacity-[0.01]",r?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:q("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",p||r?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:c,children:[t.slice(0,d).map((g,h)=>e.jsx(Z.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:e.jsx(_g,{starterPrompt:g,starterPrompts:t,index:h,disabled:n,onSelectStarterPrompt:s})},g.id??h)),r&&t.length>d&&e.jsx(Da,{clientThreadId:o,onClick:x})]}),!r&&t.length>d&&e.jsx(Da,{clientThreadId:o,onClick:x})]})}const Jg=({clientThreadId:t,currentModelId:s,isModelLoaded:n})=>{const[o,a]=f.useState(!1),r=Jn(),{prospectiveModelId:i}=_s(t),d=n?s:i??"auto",{promptStarters:l,shouldShowStarterPrompts:u,onSelectStarterPrompt:m}=Ui({isModelLoaded:n,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:t,limit:8,modelSlug:d});return e.jsx(Z.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:q(!o&&"h-[116px]"),children:u&&l&&e.jsx(lr,{starterPrompts:l,onSelectStarterPrompt:m,disabled:r,clientThreadId:t,onExpand:()=>a(!0),mobileLayout:!0})})},Rg=({currentModelId:t,clientThreadId:s,isModelLoaded:n})=>{const{isUnauthenticated:o}=Te(),[a,r]=f.useState(!1),i=tm(),d=Jn(),{prospectiveModelId:l}=_s(s),u=n?t:l??"auto",{promptStarters:m,shouldShowStarterPrompts:c,onSelectStarterPrompt:p}=Ui({isModelLoaded:n,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:s,limit:8,modelSlug:u});return e.jsx(Z.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:q("hidden min-h-[108px] max-w-full",i?"@lg/thread:block":"lg:block",o&&a?"":"h-[70px]"),children:c&&m&&e.jsx(lr,{starterPrompts:m,onSelectStarterPrompt:p,disabled:d,clientThreadId:s,onExpand:()=>r(!0)})})},Ag=Fe({moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),La=qn.div`m-8 flex flex-col items-center`;function Fa(t){return e.jsx(Z.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function Mg({clientThreadId:t}){const n=le(t,a=>a?.promptGptRating)?.gizmoId,{data:o}=ji(n);return n==null||o==null||!im(o)?null:e.jsx(Eg,{gizmoId:n})}function Eg({gizmoId:t}){const[s,n]=f.useState(!1),[o,a]=f.useState(!1),r=rm(t),i=async l=>{n(!0),setTimeout(()=>{a(!0)},5e3),T.logEvent("Submit Inline Rating",{gizmo_id:t,rating:l}),await r.mutateAsync({rating:l})},d=async()=>{a(!0),T.logEvent("Dismiss Inline Rating",{gizmo_id:t}),await r.mutateAsync({})};return f.useEffect(()=>{o||T.logEvent("Show Inline Rating",{gizmo_id:t})},[o,t]),o?null:s?e.jsx(La,{children:e.jsxs(Fa,{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"border-token-border-heavy rounded-lg border p-4",children:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(E,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),e.jsx(ja,{onClick:()=>{a(!0)}})]})}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(E,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):e.jsx(La,{children:e.jsxs(Fa,{className:"border-token-border-heavy flex flex-col items-center gap-4 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(E,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),e.jsx(ja,{onClick:d})]}),e.jsx(lm,{rating:void 0,onRating:i})]})})}const Zg=({clientThreadId:t,isNewThread:s,isGizmoThread:n,isProjectThread:o,isModelLoaded:a,currentModelId:r,onRequestCompletion:i,shouldUseUnifiedComposer:d,onlyAllowImageUploads:l})=>{const u=At(),{pageType:m}=yi(),c=m?.type==="landing-page",p=f.useContext(Hi),x=Jm(p),g=Un();Mt(),fm(u);const h=async _=>{if(Pe(t)?.isLoading!==!1)return;const P=await hm(_);i(P)},S=f.useCallback(_=>{T.logEvent("Continue Completion"),i(gm(_))},[i]),y=e.jsxs(e.Fragment,{children:[e.jsx(Mg,{clientThreadId:t}),e.jsx(Js,{verticalMargin:"none",verticalPadding:x?"last-standard":"none",horizontalPadding:"standard",children:e.jsx(Zs,{children:e.jsx(Pg,{clientThreadId:t,currentModelId:r,isNewThread:s,hideHeader:s,onRequestCompletion:h,onContinueGenerating:S,onAutocompleteSelect:u.onAutocompleteSelect,onlyAllowImageUploads:l})})})]}),v=s&&e.jsx("div",{className:q("[display:var(--display-hidden-until-loaded,block)] md:absolute md:start-0 md:bottom-6 md:w-full"),children:e.jsx(Js,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(Zs,{children:e.jsx(Zi,{className:"block flex-1"})})})});return d?e.jsxs(e.Fragment,{children:[g&&v,e.jsx("div",{id:"thread-bottom",children:y}),!g&&v,s&&!c&&!n&&!o&&e.jsx(Js,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(Zs,{children:e.jsx(Rg,{clientThreadId:t,currentModelId:r,isModelLoaded:a})})})]}):y};function Pg({clientThreadId:t,currentModelId:s,disableDraftPersistence:n=!1,isNewThread:o,onRequestCompletion:a,onContinueGenerating:r,onComposerInput:i,onComposerChange:d,onAutocompleteSelect:l,headerClassName:u,hideHeader:m,onTaggingDropdownClose:c,onTaggingDropdownOpen:p,onlyAllowImageUploads:x}){const{data:g,isLoading:h}=$t(),[S,y,v,_]=le(t,Y=>{const L=te.getCurrentNode(Y);return[L.message.clientMetadata?.errType!=null&&L.message.clientMetadata.errType!=="info",Zm(te.getCurrentNode(Y).message),Y?.mode,Y?.continuingFromSharedConversationId!=null]}),P=Mt(),R=At(),M=Qm({clientThreadId:t}),{isOpen:w,onClose:j}=cm({type:"just-hit-rate-limit"}),N=f.useMemo(()=>M?!1:!S&&y,[S,y,M]),D=M,F=Oi(t),z=ji(F).data,b=Xm(),I=z?.gizmo.tags?.includes(vs.WorkspaceDisabled)&&!b?"workspaceDisallowsGizmo":g?.models.size===0?"noModelsAvailable":v?.kind===Oe.GizmoTest&&v.gizmo_id==null?"noTestGizmoId":null,G=ml(),W=um(),k=G.action==="moderate",{value:U}=oe("1860647109");return e.jsxs(e.Fragment,{children:[e.jsx(dm,{composerController:R,clientThreadId:t,currentModelId:s,isCompletionInProgress:M}),e.jsx("div",{className:"flex justify-center empty:hidden",children:W&&k&&U?e.jsx(mm,{}):null}),w?e.jsx(pm,{onClose:j}):null,e.jsx(wg,{clientThreadId:t,disableDraftPersistence:n,onCreateNewCompletion:a,onContinueGenerating:r,currentModelId:s,account:P,modelCategories:g?.categories,currentModelConfig:ii(g?.models,s),areModelsLoading:h,isNewThread:o,isCompletionInProgress:M,className:"w-full",canContinue:N,disabled:!!I,disabledReason:I??void 0,canPause:D,isInteractableSharedThread:_,onComposerInput:i,onComposerChange:d,onAutocompleteSelect:l,headerClassName:u,hideHeader:m,onTaggingDropdownClose:c,onTaggingDropdownOpen:p,onlyAllowImageUploads:x},t)]})}export{zf as D,Xg as F,bg as I,Jg as M,Pg as P,Zg as T,Gf as g,ao as h};
//# sourceMappingURL=jbvbchjopufbzcer.js.map
